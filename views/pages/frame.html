<!doctype html>
<html>
  <head>
    <title>{{mask}}{{Holy Unblocker LTS}}</title>
    {{ifSEO}}{{
    <meta
      name="description"
      content="Holy Unblocker is a secure web proxy service with support for many sites. Bypass filters and freely enjoy a safer private browsing experience or unblock websites on devices such as Chromebooks and at places like school or work without downloading anything."
    />
    }}
    <!--HEAD-CONTENT-->
    <script src="{{route}}{{/scram/scramjet.all.js}}"></script>
    <script src="{{route}}{{/baremux/index.js}}"></script>
    <script src="{{route}}{{/uv/uv.bundle.js}}"></script>
    <script src="{{route}}{{/uv/uv.config.js}}"></script>
    <script src="{{route}}{{/assets/js/register-sw.js}}"></script>
  </head>

  <body>
    <!-- IMPORTANT-HUCOOKINGINSERT-DONOTDELETE -->
    <div class="loader loader-active">
      <div class="loader-w"></div>
    </div>
    <div class="omnibar" id="pr-sj">
      <div class="logo" role="img" aria-label="Holy Unblocker Logo"></div>
      <button title="Back"><i class="fas fa-arrow-left"></i></button>
      <button title="Forward"><i class="fas fa-arrow-right"></i></button>
      <input
        class="glowbutton"
        id="search-input"
        type="text"
        placeholder="Type a URL or search..."
        spellcheck="false"
        autocomplete="off"
      />
      <div title="Settings" class="dropdown-parent">
        <a href="#"><i class="fas fa-cog pulse" aria-hidden="true"></i></a>
        <div
          class="dropdown-settings"
          tabindex="0"
          role="menu"
          aria-label="Settings menu"
        >
          <div id="csel">
            <!--SETTINGS-->
          </div>
        </div>
      </div>
      <button id="omnibar-toggle" title="Hide Bar">
        <i class="fas fa-chevron-up"></i>
      </button>
    </div>
    <iframe id="frame" allow="fullscreen" autofocus></iframe>
    <script>
      // Display the window.
      const windowFrame = document.getElementById('frame');
      windowFrame.src = localStorage.getItem('hu-lts-frame-url');

      // Functionality for the omnibox.
      const omnibar = document.getElementById('pr-sj');
      const toggle = document.getElementById('omnibar-toggle');
      const backArrow = omnibar.querySelector("[title='Back' i]");
      const forwardArrow = omnibar.querySelector("[title='Forward' i]");
      let hidden = false;

      toggle.addEventListener('click', () => {
        hidden = !hidden;
        omnibar.classList.toggle('omnibar-hidden', hidden);
        toggle.classList.toggle('omnibar-s', hidden);
        toggle.innerHTML = `<i class="fas fa-chevron-${hidden ? 'down' : 'up'}"></i>`;
        (hidden ? document.body : omnibar).appendChild(toggle);
        toggle.title = hidden ? 'Show Bar' : 'Hide Bar';
      });

      backArrow.addEventListener('click', () => {
        history.back();
      });
      forwardArrow.addEventListener('click', () => {
        history.forward();
      });

      let statusObject = { isLoading: true, timesErrored: 0 };

      // Remove the loading screen if it takes too long.
      const loaderTimeout = (timeout) => {
        statusObject.isLoading = true;
        setTimeout(() => {
          if (statusObject.isLoading)
            loader.classList.toggle('loader-active', false);
        }, timeout);
      };

      // Refresh the IFrame if the error page has displayed up to 5 time(s) before.
      const errorRefresh = () => {
        const shouldRefresh =
          statusObject.timesErrored <= 5 &&
          windowFrame.contentWindow.document.head.querySelector(
            "meta[itemprop='http-status'][content='404']"
          );
        if (shouldRefresh) {
          statusObject.timesErrored++;
          windowFrame.contentWindow.location.reload();
        } else statusObject.timesErrored = 0;
        return shouldRefresh;
      };

      // Display loading screen.
      const loader = document.getElementsByClassName('loader')[0];
      const updateLoader = () => {
        // Ignore about:blank pages that IFrames load prior to the actual URL.
        if (windowFrame.contentWindow.location.href === 'about:blank') return;

        statusObject.isLoading =
          windowFrame.contentWindow.document.readyState === 'loading';

        // Do not remove the loading screen if the page is an error page
        // and should be reloaded.
        if (!statusObject.isLoading && errorRefresh())
          return (statusObject.isLoading = true);

        // Display the loading screen if statusObject.isLoading is true.
        loader.classList.toggle('loader-active', statusObject.isLoading);

        // Remove the loading screen if it takes longer than 5 seconds.
        if (statusObject.isLoading) loaderTimeout(5000);
      };

      // Reattach load events whenever the content window has changed.
      const loadHandler = () => {
        setTimeout(() => {
          windowFrame.contentWindow.addEventListener('beforeunload', () => {
            loader.classList.toggle('loader-active', true);
            loaderTimeout(5000);
          });
          windowFrame.contentWindow.addEventListener('unload', loadHandler);
          windowFrame.contentWindow.addEventListener(
            'readystatechange',
            updateLoader
          );
          updateLoader();
        });
      };

      // The IFrame load event is a backup in case the main load handler fails.
      windowFrame.addEventListener('load', updateLoader);
      loadHandler();
    </script>
    <script src="{{route}}{{assets/js/common.js}}"></script>
    <script src="{{route}}{{assets/js/csel.js}}"></script>
  </body>
</html>
