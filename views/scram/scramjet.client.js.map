{"version":3,"file":"scramjet.client.js","sources":["webpack://@mercuryworkshop/scramjet//home/runner/work/scramjet/scramjet/src/clientsync/^\\.\\/.*$/","webpack://@mercuryworkshop/scramjet/./src/client/client.ts","webpack://@mercuryworkshop/scramjet/./src/client/document.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/attr.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/beacon.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/cookie.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/css.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/document.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/element.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/fontface.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/history.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/navigation.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/open.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/origin.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/performance.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/protocol.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/serviceworker.ts","webpack://@mercuryworkshop/scramjet/./src/client/dom/storage.ts","webpack://@mercuryworkshop/scramjet/./src/client/events.ts","webpack://@mercuryworkshop/scramjet/./src/client/global.ts","webpack://@mercuryworkshop/scramjet/./src/client/helpers.ts","webpack://@mercuryworkshop/scramjet/./src/client/index.ts","webpack://@mercuryworkshop/scramjet/./src/client/location.ts","webpack://@mercuryworkshop/scramjet/./src/client/natives.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/antiantidebugger.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/blob.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/caches.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/err.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/error.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/eval.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/event.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/function.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/import.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/indexeddb.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/opfs.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/postmessage.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/realm.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/eventsource.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/fetch.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/websocket.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/requests/xmlhttprequest.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/sourcemaps.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/trustedTypes.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/unproxy.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/worker.ts","webpack://@mercuryworkshop/scramjet/./src/client/shared/wrap.ts","webpack://@mercuryworkshop/scramjet/./src/client/swruntime.ts","webpack://@mercuryworkshop/scramjet/./src/client/worker/importScripts.ts","webpack://@mercuryworkshop/scramjet/./src/log.ts","webpack://@mercuryworkshop/scramjet/./src/scramjet.ts","webpack://@mercuryworkshop/scramjet/./src/shared.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/js.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/url.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/wasm.ts","webpack://@mercuryworkshop/scramjet/./src/symbols.ts","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/snippets/wasm-4b0f351a8e6eeb46/inline0.js","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/snippets/wasm-4b0f351a8e6eeb46/inline1.js","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/wasm.js","webpack://@mercuryworkshop/scramjet/webpack/runtime/define_property_getters","webpack://@mercuryworkshop/scramjet/webpack/runtime/has_own_property","webpack://@mercuryworkshop/scramjet/webpack/runtime/make_namespace_object"],"sourcesContent":["var map = {\n  \"./\": \"6707\",\n  \"./client\": \"2712\",\n  \"./client.ts\": \"2712\",\n  \"./document\": \"5974\",\n  \"./document.ts\": \"5974\",\n  \"./dom/attr\": \"8959\",\n  \"./dom/attr.ts\": \"8959\",\n  \"./dom/beacon\": \"2863\",\n  \"./dom/beacon.ts\": \"2863\",\n  \"./dom/cookie\": \"1197\",\n  \"./dom/cookie.ts\": \"1197\",\n  \"./dom/css\": \"7339\",\n  \"./dom/css.ts\": \"7339\",\n  \"./dom/document\": \"1938\",\n  \"./dom/document.ts\": \"1938\",\n  \"./dom/element\": \"2439\",\n  \"./dom/element.ts\": \"2439\",\n  \"./dom/fontface\": \"6643\",\n  \"./dom/fontface.ts\": \"6643\",\n  \"./dom/history\": \"461\",\n  \"./dom/history.ts\": \"461\",\n  \"./dom/navigation\": \"2410\",\n  \"./dom/navigation.ts\": \"2410\",\n  \"./dom/open\": \"8805\",\n  \"./dom/open.ts\": \"8805\",\n  \"./dom/origin\": \"3261\",\n  \"./dom/origin.ts\": \"3261\",\n  \"./dom/performance\": \"4475\",\n  \"./dom/performance.ts\": \"4475\",\n  \"./dom/protocol\": \"6101\",\n  \"./dom/protocol.ts\": \"6101\",\n  \"./dom/serviceworker\": \"5707\",\n  \"./dom/serviceworker.ts\": \"5707\",\n  \"./dom/storage\": \"9227\",\n  \"./dom/storage.ts\": \"9227\",\n  \"./events\": \"5008\",\n  \"./events.ts\": \"5008\",\n  \"./global\": \"2237\",\n  \"./global.ts\": \"2237\",\n  \"./helpers\": \"7932\",\n  \"./helpers.ts\": \"7932\",\n  \"./index\": \"6707\",\n  \"./index.ts\": \"6707\",\n  \"./location\": \"8971\",\n  \"./location.ts\": \"8971\",\n  \"./natives\": \"3498\",\n  \"./natives.ts\": \"3498\",\n  \"./shared/antiantidebugger\": \"8278\",\n  \"./shared/antiantidebugger.ts\": \"8278\",\n  \"./shared/blob\": \"9447\",\n  \"./shared/blob.ts\": \"9447\",\n  \"./shared/caches\": \"4169\",\n  \"./shared/caches.ts\": \"4169\",\n  \"./shared/err\": \"5146\",\n  \"./shared/err.ts\": \"5146\",\n  \"./shared/error\": \"7651\",\n  \"./shared/error.ts\": \"7651\",\n  \"./shared/eval\": \"4423\",\n  \"./shared/eval.ts\": \"4423\",\n  \"./shared/event\": \"8231\",\n  \"./shared/event.ts\": \"8231\",\n  \"./shared/function\": \"7636\",\n  \"./shared/function.ts\": \"7636\",\n  \"./shared/import\": \"4636\",\n  \"./shared/import.ts\": \"4636\",\n  \"./shared/indexeddb\": \"2930\",\n  \"./shared/indexeddb.ts\": \"2930\",\n  \"./shared/opfs\": \"6970\",\n  \"./shared/opfs.ts\": \"6970\",\n  \"./shared/postmessage\": \"2625\",\n  \"./shared/postmessage.ts\": \"2625\",\n  \"./shared/realm\": \"6594\",\n  \"./shared/realm.ts\": \"6594\",\n  \"./shared/requests/eventsource\": \"2738\",\n  \"./shared/requests/eventsource.ts\": \"2738\",\n  \"./shared/requests/fetch\": \"106\",\n  \"./shared/requests/fetch.ts\": \"106\",\n  \"./shared/requests/websocket\": \"7219\",\n  \"./shared/requests/websocket.ts\": \"7219\",\n  \"./shared/requests/xmlhttprequest\": \"7481\",\n  \"./shared/requests/xmlhttprequest.ts\": \"7481\",\n  \"./shared/sourcemaps\": \"6321\",\n  \"./shared/sourcemaps.ts\": \"6321\",\n  \"./shared/trustedTypes\": \"1587\",\n  \"./shared/trustedTypes.ts\": \"1587\",\n  \"./shared/unproxy\": \"2370\",\n  \"./shared/unproxy.ts\": \"2370\",\n  \"./shared/worker\": \"8475\",\n  \"./shared/worker.ts\": \"8475\",\n  \"./shared/wrap\": \"7706\",\n  \"./shared/wrap.ts\": \"7706\",\n  \"./swruntime\": \"633\",\n  \"./swruntime.ts\": \"633\",\n  \"./worker/importScripts\": \"5425\",\n  \"./worker/importScripts.ts\": \"5425\"\n};\n\n\nfunction webpackContext(req) {\n  var id = webpackContextResolve(req);\n  return __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n  if(!__webpack_require__.o(map, req)) {\n    var e = new Error(\"Cannot find module '\" + req + \"'\");\n    e.code = 'MODULE_NOT_FOUND';\n    throw e;\n  }\n  return map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n  return Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 5831;\n","import { iswindow } from \".\";\nimport { ScramjetFrame } from \"../controller/frame\";\nimport { SCRAMJETCLIENT, SCRAMJETFRAME } from \"../symbols\";\nimport { createDocumentProxy } from \"./document\";\nimport { createGlobalProxy } from \"./global\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\nimport { createLocationProxy } from \"./location\";\nimport { nativeGetOwnPropertyDescriptor } from \"./natives\";\nimport {\n\tBareClient,\n\tCookieStore,\n\tconfig,\n\tunrewriteUrl,\n\trewriteUrl,\n} from \"../shared\";\nimport type { BareClient as BareClientType } from \"@mercuryworkshop/bare-mux\";\nimport { createWrapFn } from \"./shared/wrap\";\nimport { NavigateEvent } from \"./events\";\nimport type { URLMeta } from \"../shared/rewriters/url\";\nimport { SourceMaps } from \"./shared/sourcemaps\";\n\ntype NativeStore = {\n\tstore: Record<string, any>;\n\tcall: (target: string, that: any, ...args) => any;\n\tconstruct: (target: string, ...args) => any;\n};\ntype DescriptorStore = {\n\tstore: Record<string, PropertyDescriptor>;\n\tget: (target: string, that: any) => any;\n\tset: (target: string, that: any, value: any) => void;\n};\n//eslint-disable-next-line\nexport type AnyFunction = Function;\n\nexport type ScramjetModule = {\n\tenabled: (client: ScramjetClient) => boolean | undefined;\n\tdisabled: (\n\t\tclient: ScramjetClient,\n\t\tself: typeof globalThis\n\t) => void | undefined;\n\torder: number | undefined;\n\tdefault: (client: ScramjetClient, self: typeof globalThis) => void;\n};\n\nexport type ProxyCtx = {\n\tfn: AnyFunction;\n\tthis: any;\n\targs: any[];\n\tnewTarget: AnyFunction;\n\treturn: (r: any) => void;\n\tcall: () => any;\n};\nexport type Proxy = {\n\tconstruct?(ctx: ProxyCtx): any;\n\tapply?(ctx: ProxyCtx): any;\n};\n\nexport type TrapCtx<T> = {\n\tthis: any;\n\tget: () => T;\n\tset: (v: T) => void;\n};\nexport type Trap<T> = {\n\twritable?: boolean;\n\tvalue?: any;\n\tenumerable?: boolean;\n\tconfigurable?: boolean;\n\tget?: (ctx: TrapCtx<T>) => T;\n\tset?: (ctx: TrapCtx<T>, v: T) => void;\n};\n\nexport class ScramjetClient {\n\tdocumentProxy: any;\n\tglobalProxy: any;\n\tlocationProxy: any;\n\tserviceWorker: ServiceWorkerContainer;\n\tbare: BareClientType;\n\n\tnatives: NativeStore;\n\tdescriptors: DescriptorStore;\n\tsourcemaps: SourceMaps;\n\twrapfn: (i: any, ...args: any) => any;\n\n\tcookieStore = new CookieStore();\n\n\teventcallbacks: Map<\n\t\tany,\n\t\t[\n\t\t\t{\n\t\t\t\tevent: string;\n\t\t\t\toriginalCallback: AnyFunction;\n\t\t\t\tproxiedCallback: AnyFunction;\n\t\t\t},\n\t\t]\n\t> = new Map();\n\n\tmeta: URLMeta;\n\n\tconstructor(public global: typeof globalThis) {\n\t\tif (SCRAMJETCLIENT in global) {\n\t\t\tconsole.error(\n\t\t\t\t\"attempted to initialize a scramjet client, but one is already loaded - this is very bad\"\n\t\t\t);\n\t\t\tthrow new Error();\n\t\t}\n\n\t\tif (iswindow) {\n\t\t\tthis.bare = new BareClient();\n\t\t} else {\n\t\t\tthis.bare = new BareClient(\n\t\t\t\tnew Promise((resolve) => {\n\t\t\t\t\taddEventListener(\"message\", ({ data }) => {\n\t\t\t\t\t\tif (typeof data !== \"object\") return;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\"$scramjet$type\" in data &&\n\t\t\t\t\t\t\tdata.$scramjet$type === \"baremuxinit\"\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresolve(data.port);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tthis.serviceWorker = this.global.navigator.serviceWorker;\n\n\t\tif (iswindow) {\n\t\t\tthis.documentProxy = createDocumentProxy(this, global);\n\n\t\t\tglobal.document[SCRAMJETCLIENT] = this;\n\t\t}\n\n\t\tthis.locationProxy = createLocationProxy(this, global);\n\t\tthis.globalProxy = createGlobalProxy(this, global);\n\t\tthis.wrapfn = createWrapFn(this, global);\n\t\tthis.sourcemaps = {};\n\t\tthis.natives = {\n\t\t\tstore: new Proxy(\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tget: (target, prop: string) => {\n\t\t\t\t\t\tif (prop in target) {\n\t\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst split = prop.split(\".\");\n\t\t\t\t\t\tconst realProp = split.pop();\n\t\t\t\t\t\tconst realTarget = split.reduce((a, b) => a?.[b], this.global);\n\n\t\t\t\t\t\tif (!realTarget) return;\n\n\t\t\t\t\t\tconst original = Reflect.get(realTarget, realProp);\n\t\t\t\t\t\ttarget[prop] = original;\n\n\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t),\n\t\t\tconstruct(target: string, ...args) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\treturn new original(...args);\n\t\t\t},\n\t\t\tcall(target: string, that: any, ...args) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\treturn original.call(that, ...args);\n\t\t\t},\n\t\t};\n\t\tthis.descriptors = {\n\t\t\tstore: new Proxy(\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tget: (target, prop: string) => {\n\t\t\t\t\t\tif (prop in target) {\n\t\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst split = prop.split(\".\");\n\t\t\t\t\t\tconst realProp = split.pop();\n\t\t\t\t\t\tconst realTarget = split.reduce((a, b) => a?.[b], this.global);\n\n\t\t\t\t\t\tif (!realTarget) return;\n\n\t\t\t\t\t\tconst original = nativeGetOwnPropertyDescriptor(\n\t\t\t\t\t\t\trealTarget,\n\t\t\t\t\t\t\trealProp\n\t\t\t\t\t\t);\n\t\t\t\t\t\ttarget[prop] = original;\n\n\t\t\t\t\t\treturn target[prop];\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t),\n\t\t\tget(target: string, that: any) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\treturn original.get.call(that);\n\t\t\t},\n\t\t\tset(target: string, that: any, value: any) {\n\t\t\t\tconst original = this.store[target];\n\t\t\t\tif (!original) return null;\n\n\t\t\t\toriginal.set.call(that, value);\n\t\t\t},\n\t\t};\n\t\t// eslint-disable-next-line @typescript-eslint/no-this-alias\n\t\tconst client = this;\n\t\tthis.meta = {\n\t\t\tget origin() {\n\t\t\t\treturn client.url;\n\t\t\t},\n\t\t\tget base() {\n\t\t\t\tif (iswindow) {\n\t\t\t\t\tconst base = client.natives.call(\n\t\t\t\t\t\t\"Document.prototype.querySelector\",\n\t\t\t\t\t\tclient.global.document,\n\t\t\t\t\t\t\"base\"\n\t\t\t\t\t);\n\t\t\t\t\tif (base) {\n\t\t\t\t\t\tlet url = base.getAttribute(\"href\");\n\t\t\t\t\t\tconst frag = url.indexOf(\"#\");\n\t\t\t\t\t\turl = url.substring(0, frag === -1 ? undefined : frag);\n\t\t\t\t\t\tif (!url) return client.url;\n\n\t\t\t\t\t\treturn new URL(url, client.url.origin);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn client.url;\n\t\t\t},\n\t\t\tget topFrameName() {\n\t\t\t\tif (!iswindow)\n\t\t\t\t\tthrow new Error(\"topFrameName was called from a worker?\");\n\n\t\t\t\tlet currentWin = client.global;\n\t\t\t\tif (currentWin.parent.window == currentWin.window) {\n\t\t\t\t\t// we're top level & we don't have a frame name\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\t// find the topmost frame that's controlled by scramjet, stopping before the real top frame\n\t\t\t\twhile (currentWin.parent.window !== currentWin.window) {\n\t\t\t\t\tif (!currentWin.parent.window[SCRAMJETCLIENT]) break;\n\t\t\t\t\tcurrentWin = currentWin.parent.window;\n\t\t\t\t}\n\n\t\t\t\tconst curclient = currentWin[SCRAMJETCLIENT];\n\t\t\t\tconst frame = curclient.descriptors.get(\n\t\t\t\t\t\"window.frameElement\",\n\t\t\t\t\tcurrentWin\n\t\t\t\t);\n\t\t\t\tif (!frame) {\n\t\t\t\t\t// we're inside an iframe, but the top frame is scramjet-controlled and top level, so we can't get a top frame name\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t\tif (!frame.name) {\n\t\t\t\t\t// the top frame is scramjet-controlled, but it has no name. this is user error\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\"YOU NEED TO USE `new ScramjetFrame()`! DIRECT IFRAMES WILL NOT WORK\"\n\t\t\t\t\t);\n\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\treturn frame.name;\n\t\t\t},\n\t\t\tget parentFrameName() {\n\t\t\t\tif (!iswindow)\n\t\t\t\t\tthrow new Error(\"parentFrameName was called from a worker?\");\n\t\t\t\tif (client.global.parent.window == client.global.window) {\n\t\t\t\t\t// we're top level & we don't have a frame name\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t\tlet parentWin = client.global.parent.window;\n\t\t\t\tif (parentWin[SCRAMJETCLIENT]) {\n\t\t\t\t\t// we're inside an iframe, and the parent is scramjet-controlled\n\t\t\t\t\tconst parentClient = parentWin[SCRAMJETCLIENT];\n\t\t\t\t\tconst frame = parentClient.descriptors.get(\n\t\t\t\t\t\t\"window.frameElement\",\n\t\t\t\t\t\tparentWin\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!frame) {\n\t\t\t\t\t\t// parent is scramjet controlled and top-level. there is no parent frame name\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!frame.name) {\n\t\t\t\t\t\t// the parent frame is scramjet-controlled, but it has no name. this is user error\n\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\"YOU NEED TO USE `new ScramjetFrame()`! DIRECT IFRAMES WILL NOT WORK\"\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn frame.name;\n\t\t\t\t} else {\n\t\t\t\t\t// we're inside an iframe, and the parent is not scramjet-controlled\n\t\t\t\t\t// return our own frame name\n\t\t\t\t\tconst frame = client.descriptors.get(\n\t\t\t\t\t\t\"window.frameElement\",\n\t\t\t\t\t\tclient.global\n\t\t\t\t\t);\n\t\t\t\t\tif (!frame.name) {\n\t\t\t\t\t\t// the parent frame is not scramjet-controlled, so we can't get a parent frame name\n\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\"YOU NEED TO USE `new ScramjetFrame()`! DIRECT IFRAMES WILL NOT WORK\"\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn frame.name;\n\t\t\t\t}\n\t\t\t},\n\t\t};\n\n\t\tglobal[SCRAMJETCLIENT] = this;\n\t}\n\n\tget frame(): ScramjetFrame | null {\n\t\tif (!iswindow) return null;\n\t\tconst frame = this.descriptors.get(\"window.frameElement\", this.global);\n\n\t\tif (!frame) return null; // we're top level\n\t\tconst sframe = frame[SCRAMJETFRAME];\n\n\t\tif (!sframe) {\n\t\t\t// we're in a subframe, recurse upward until we find one\n\t\t\tlet currentwin = this.global.window;\n\t\t\twhile (currentwin.parent !== currentwin) {\n\t\t\t\tlet currentclient = currentwin[SCRAMJETCLIENT];\n\t\t\t\tlet currentFrame = currentclient.descriptors.get(\n\t\t\t\t\t\"window.frameElement\",\n\t\t\t\t\tcurrentwin\n\t\t\t\t);\n\t\t\t\tif (!currentFrame) return null; // ??\n\t\t\t\tif (currentFrame && currentFrame[SCRAMJETFRAME]) {\n\t\t\t\t\treturn currentFrame[SCRAMJETFRAME];\n\t\t\t\t}\n\t\t\t\tcurrentwin = currentwin.parent.window;\n\t\t\t}\n\t\t}\n\n\t\treturn sframe;\n\t}\n\tget isSubframe(): boolean {\n\t\tif (!iswindow) return false;\n\t\tconst frame = this.descriptors.get(\"window.frameElement\", this.global);\n\n\t\tif (!frame) return false; // we're top level\n\t\tconst sframe = frame[SCRAMJETFRAME];\n\t\tif (!sframe) return true;\n\n\t\treturn false;\n\t}\n\tloadcookies(cookiestr: string) {\n\t\tthis.cookieStore.load(cookiestr);\n\t}\n\n\thook() {\n\t\t// @ts-ignore\n\t\tconst context = import.meta.webpackContext(\".\", {\n\t\t\trecursive: true,\n\t\t});\n\n\t\tconst modules: ScramjetModule[] = [];\n\n\t\tfor (const key of context.keys()) {\n\t\t\tconst module: ScramjetModule = context(key);\n\t\t\tif (!key.endsWith(\".ts\")) continue;\n\t\t\tif (\n\t\t\t\t(key.startsWith(\"./dom/\") && \"window\" in this.global) ||\n\t\t\t\t(key.startsWith(\"./worker/\") && \"WorkerGlobalScope\" in this.global) ||\n\t\t\t\tkey.startsWith(\"./shared/\")\n\t\t\t) {\n\t\t\t\tmodules.push(module);\n\t\t\t}\n\t\t}\n\n\t\tmodules.sort((a, b) => {\n\t\t\tconst aorder = a.order || 0;\n\t\t\tconst border = b.order || 0;\n\n\t\t\treturn aorder - border;\n\t\t});\n\n\t\tfor (const module of modules) {\n\t\t\tif (!module.enabled || module.enabled(this))\n\t\t\t\tmodule.default(this, this.global);\n\t\t\telse if (module.disabled) module.disabled(this, this.global);\n\t\t}\n\t}\n\n\tget url(): URL {\n\t\treturn new URL(unrewriteUrl(this.global.location.href));\n\t}\n\n\tset url(url: URL | string) {\n\t\tif (url instanceof URL) url = url.toString();\n\n\t\tconst ev = new NavigateEvent(url);\n\t\tif (this.frame) {\n\t\t\tthis.frame.dispatchEvent(ev);\n\t\t}\n\t\tif (ev.defaultPrevented) return;\n\n\t\tthis.global.location.href = rewriteUrl(ev.url, this.meta);\n\t}\n\n\t// below are the utilities for proxying and trapping dom APIs\n\t// you don't have to understand this it just makes the rest easier\n\t// i'll document it eventually\n\n\tProxy(name: string | string[], handler: Proxy) {\n\t\tif (Array.isArray(name)) {\n\t\t\tfor (const n of name) {\n\t\t\t\tthis.Proxy(n, handler);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst split = name.split(\".\");\n\t\tconst prop = split.pop();\n\t\tconst target = split.reduce((a, b) => a?.[b], this.global);\n\t\tif (!target) return;\n\n\t\tconst original = Reflect.get(target, prop);\n\t\tthis.natives.store[name] = original;\n\n\t\tthis.RawProxy(target, prop, handler);\n\t}\n\tRawProxy(target: any, prop: string, handler: Proxy) {\n\t\tif (!target) return;\n\t\tif (!prop) return;\n\t\tif (!Reflect.has(target, prop)) return;\n\n\t\tconst value = Reflect.get(target, prop);\n\t\tdelete target[prop];\n\n\t\tconst h: ProxyHandler<any> = {};\n\n\t\tif (handler.construct) {\n\t\t\th.construct = function (\n\t\t\t\tconstructor: any,\n\t\t\t\targs: any[],\n\t\t\t\tnewTarget: AnyFunction\n\t\t\t) {\n\t\t\t\tlet returnValue: any = undefined;\n\t\t\t\tlet earlyreturn = false;\n\n\t\t\t\tconst ctx: ProxyCtx = {\n\t\t\t\t\tfn: constructor,\n\t\t\t\t\tthis: null,\n\t\t\t\t\targs,\n\t\t\t\t\tnewTarget: newTarget,\n\t\t\t\t\treturn: (r: any) => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = r;\n\t\t\t\t\t},\n\t\t\t\t\tcall: () => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = Reflect.construct(ctx.fn, ctx.args, ctx.newTarget);\n\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\thandler.construct(ctx);\n\n\t\t\t\tif (earlyreturn) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.construct(ctx.fn, ctx.args, ctx.newTarget);\n\t\t\t};\n\t\t}\n\n\t\tif (handler.apply) {\n\t\t\th.apply = function (fn: any, that: any, args: any[]) {\n\t\t\t\tlet returnValue: any = undefined;\n\t\t\t\tlet earlyreturn = false;\n\n\t\t\t\tconst ctx: ProxyCtx = {\n\t\t\t\t\tfn,\n\t\t\t\t\tthis: that,\n\t\t\t\t\targs,\n\t\t\t\t\tnewTarget: null,\n\t\t\t\t\treturn: (r: any) => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = r;\n\t\t\t\t\t},\n\t\t\t\t\tcall: () => {\n\t\t\t\t\t\tearlyreturn = true;\n\t\t\t\t\t\treturnValue = Reflect.apply(ctx.fn, ctx.this, ctx.args);\n\n\t\t\t\t\t\treturn returnValue;\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tconst pst = Error.prepareStackTrace;\n\n\t\t\t\tError.prepareStackTrace = function (err, s) {\n\t\t\t\t\tif (\n\t\t\t\t\t\ts[0].getFileName() &&\n\t\t\t\t\t\t!s[0].getFileName().startsWith(location.origin + config.prefix)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn { stack: err.stack };\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\thandler.apply(ctx);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tif (err instanceof Error) {\n\t\t\t\t\t\tif ((err.stack as any) instanceof Object) {\n\t\t\t\t\t\t\t//@ts-expect-error i'm not going to explain this\n\t\t\t\t\t\t\terr.stack = err.stack.stack;\n\t\t\t\t\t\t\tconsole.error(\"ERROR FROM SCRAMJET INTERNALS\", err);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow err;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow err;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tError.prepareStackTrace = pst;\n\n\t\t\t\tif (earlyreturn) {\n\t\t\t\t\treturn returnValue;\n\t\t\t\t}\n\n\t\t\t\treturn Reflect.apply(ctx.fn, ctx.this, ctx.args);\n\t\t\t};\n\t\t}\n\n\t\th.getOwnPropertyDescriptor = getOwnPropertyDescriptorHandler;\n\t\ttarget[prop] = new Proxy(value, h);\n\t}\n\tTrap<T>(name: string | string[], descriptor: Trap<T>): PropertyDescriptor {\n\t\tif (Array.isArray(name)) {\n\t\t\tfor (const n of name) {\n\t\t\t\tthis.Trap(n, descriptor);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst split = name.split(\".\");\n\t\tconst prop = split.pop();\n\t\tconst target = split.reduce((a, b) => a?.[b], this.global);\n\t\tif (!target) return;\n\n\t\tconst original = nativeGetOwnPropertyDescriptor(target, prop);\n\t\tthis.descriptors.store[name] = original;\n\n\t\treturn this.RawTrap(target, prop, descriptor);\n\t}\n\tRawTrap<T>(\n\t\ttarget: any,\n\t\tprop: string,\n\t\tdescriptor: Trap<T>\n\t): PropertyDescriptor {\n\t\tif (!target) return;\n\t\tif (!prop) return;\n\t\tif (!Reflect.has(target, prop)) return;\n\n\t\tconst oldDescriptor = nativeGetOwnPropertyDescriptor(target, prop);\n\n\t\tconst ctx: TrapCtx<T> = {\n\t\t\tthis: null,\n\t\t\tget: function () {\n\t\t\t\treturn oldDescriptor && oldDescriptor.get.call(this.this);\n\t\t\t},\n\t\t\tset: function (v: T) {\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/no-unused-expressions\n\t\t\t\toldDescriptor && oldDescriptor.set.call(this.this, v);\n\t\t\t},\n\t\t};\n\n\t\tdelete target[prop];\n\n\t\tconst desc: PropertyDescriptor = {};\n\n\t\tif (descriptor.get) {\n\t\t\tdesc.get = function () {\n\t\t\t\tctx.this = this;\n\n\t\t\t\treturn descriptor.get(ctx);\n\t\t\t};\n\t\t} else if (oldDescriptor?.get) {\n\t\t\tdesc.get = oldDescriptor.get;\n\t\t}\n\n\t\tif (descriptor.set) {\n\t\t\tdesc.set = function (v: T) {\n\t\t\t\tctx.this = this;\n\n\t\t\t\tdescriptor.set(ctx, v);\n\t\t\t};\n\t\t} else if (oldDescriptor?.set) {\n\t\t\tdesc.set = oldDescriptor.set;\n\t\t}\n\n\t\tif (descriptor.enumerable) desc.enumerable = descriptor.enumerable;\n\t\telse if (oldDescriptor?.enumerable)\n\t\t\tdesc.enumerable = oldDescriptor.enumerable;\n\t\tif (descriptor.configurable) desc.configurable = descriptor.configurable;\n\t\telse if (oldDescriptor?.configurable)\n\t\t\tdesc.configurable = oldDescriptor.configurable;\n\n\t\tObject.defineProperty(target, prop, desc);\n\n\t\treturn oldDescriptor;\n\t}\n}\n","import { rewriteUrl } from \"../shared\";\nimport { ScramjetClient } from \"./client\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\n\nexport function createDocumentProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n) {\n\treturn new Proxy(self.document, {\n\t\tget(target, prop) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\treturn client.locationProxy;\n\t\t\t}\n\n\t\t\tif (prop === \"defaultView\") {\n\t\t\t\treturn client.globalProxy;\n\t\t\t}\n\n\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\treturn value;\n\t\t},\n\t\tset(target, prop, newValue) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\tlocation.href = rewriteUrl(newValue, client.meta);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn Reflect.set(target, prop, newValue);\n\t\t},\n\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: typeof window) {\n\tclient.Trap(\"Element.prototype.attributes\", {\n\t\tget(ctx) {\n\t\t\tconst map = ctx.get() as NamedNodeMap;\n\t\t\tconst proxy = new Proxy(map, {\n\t\t\t\tget(target, prop, _receiver) {\n\t\t\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\t\t\tif (prop === \"length\") {\n\t\t\t\t\t\treturn Object.keys(proxy).length;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop === \"getNamedItem\") {\n\t\t\t\t\t\treturn (name: string) => proxy[name];\n\t\t\t\t\t}\n\t\t\t\t\tif (prop === \"getNamedItemNS\") {\n\t\t\t\t\t\treturn (namespace: string, name: string) =>\n\t\t\t\t\t\t\tproxy[`${namespace}:${name}`];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop in NamedNodeMap.prototype && typeof value === \"function\") {\n\t\t\t\t\t\treturn new Proxy(value, {\n\t\t\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t\t\tif (that === proxy) {\n\t\t\t\t\t\t\t\t\treturn Reflect.apply(target, map, args);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn Reflect.apply(target, that, args);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\t(typeof prop === \"string\" || typeof prop === \"number\") &&\n\t\t\t\t\t\t!isNaN(Number(prop))\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst position = Object.keys(proxy)[prop];\n\n\t\t\t\t\t\treturn map[position];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.has(target, prop)) return undefined;\n\n\t\t\t\t\treturn value;\n\t\t\t\t},\n\t\t\t\townKeys(target) {\n\t\t\t\t\tconst keys = Reflect.ownKeys(target);\n\n\t\t\t\t\treturn keys.filter((key) => this.has(target, key));\n\t\t\t\t},\n\t\t\t\thas(target, prop) {\n\t\t\t\t\tif (typeof prop === \"symbol\") return Reflect.has(target, prop);\n\t\t\t\t\tif (prop.startsWith(\"scramjet-attr-\")) return false;\n\t\t\t\t\tif (map[prop]?.name?.startsWith(\"scramjet-attr-\")) return false;\n\n\t\t\t\t\treturn Reflect.has(target, prop);\n\t\t\t\t},\n\t\t\t});\n\n\t\t\treturn proxy;\n\t\t},\n\t});\n\n\tclient.Trap(\"Attr.prototype.value\", {\n\t\tget(ctx) {\n\t\t\tif (ctx.this?.ownerElement) {\n\t\t\t\treturn ctx.this.ownerElement.getAttribute(ctx.this.name);\n\t\t\t}\n\n\t\t\treturn ctx.get();\n\t\t},\n\t\tset(ctx, value) {\n\t\t\tif (ctx.this?.ownerElement) {\n\t\t\t\treturn ctx.this.ownerElement.setAttribute(ctx.this.name, value);\n\t\t\t}\n\n\t\t\treturn ctx.set(value);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"Navigator.prototype.sendBeacon\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n}\n","import type { MessageC2W, MessageW2C } from \"../../worker\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tclient.serviceWorker.addEventListener(\n\t\t\"message\",\n\t\t({ data }: { data: MessageW2C }) => {\n\t\t\tif (!(\"scramjet$type\" in data)) return;\n\n\t\t\tif (data.scramjet$type === \"cookie\") {\n\t\t\t\tclient.cookieStore.setCookies([data.cookie], new URL(data.url));\n\t\t\t\tconst msg = {\n\t\t\t\t\tscramjet$token: data.scramjet$token,\n\t\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\t};\n\t\t\t\tclient.serviceWorker.controller.postMessage(msg);\n\t\t\t}\n\t\t}\n\t);\n\n\tclient.Trap(\"Document.prototype.cookie\", {\n\t\tget() {\n\t\t\treturn client.cookieStore.getCookies(client.url, true);\n\t\t},\n\t\tset(ctx, value: string) {\n\t\t\tclient.cookieStore.setCookies([value], client.url);\n\t\t\tconst controller = client.descriptors.get(\n\t\t\t\t\"ServiceWorkerContainer.prototype.controller\",\n\t\t\t\tclient.serviceWorker\n\t\t\t);\n\t\t\tif (controller) {\n\t\t\t\tclient.natives.call(\"ServiceWorker.prototype.postMessage\", controller, {\n\t\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\t\tcookie: value,\n\t\t\t\t\turl: client.url.href,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t});\n\n\t// @ts-ignore\n\tdelete self.cookieStore;\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteCss, unrewriteCss } from \"../../shared\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"CSSStyleDeclaration.prototype.setProperty\", {\n\t\tapply(ctx) {\n\t\t\tif (!ctx.args[1]) return;\n\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleDeclaration.prototype.getPropertyValue\", {\n\t\tapply(ctx) {\n\t\t\tconst v = ctx.call();\n\t\t\tif (!v) return v;\n\t\t\tctx.return(unrewriteCss(v));\n\t\t},\n\t});\n\n\tclient.Trap(\"CSSStyleDeclaration.prototype.cssText\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteCss(value, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteCss(ctx.get());\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleSheet.prototype.insertRule\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = rewriteCss(ctx.args[0], client.meta);\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleSheet.prototype.replace\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = rewriteCss(ctx.args[0], client.meta);\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleSheet.prototype.replaceSync\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = rewriteCss(ctx.args[0], client.meta);\n\t\t},\n\t});\n\n\tclient.Trap(\"CSSRule.prototype.cssText\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteCss(value, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteCss(ctx.get());\n\t\t},\n\t});\n\n\tclient.Proxy(\"CSSStyleValue.parse\", {\n\t\tapply(ctx) {\n\t\t\tif (!ctx.args[1]) return;\n\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n\n\tclient.Trap(\"HTMLElement.prototype.style\", {\n\t\tget(ctx) {\n\t\t\t// unfortunate and dumb hack. we have to trap every property of this\n\t\t\t// since the prototype chain is fucked\n\n\t\t\tconst style = ctx.get() as CSSStyleDeclaration;\n\n\t\t\treturn new Proxy(style, {\n\t\t\t\tget(target, prop) {\n\t\t\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\t\t\tif (typeof value === \"function\") {\n\t\t\t\t\t\treturn new Proxy(value, {\n\t\t\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t\t\treturn Reflect.apply(target, style, args);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop in CSSStyleDeclaration.prototype) return value;\n\t\t\t\t\tif (!value) return value;\n\n\t\t\t\t\treturn unrewriteCss(value);\n\t\t\t\t},\n\t\t\t\tset(target, prop, value) {\n\t\t\t\t\tif (prop == \"cssText\" || value == \"\" || typeof value !== \"string\") {\n\t\t\t\t\t\treturn Reflect.set(target, prop, value);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn Reflect.set(target, prop, rewriteCss(value, client.meta));\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t\tset(ctx, value: string) {\n\t\t\t// this will actually run the trap for cssText. don't rewrite it here\n\t\t\tctx.set(value);\n\t\t},\n\t});\n}\n","import { rewriteHtml } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\n\t\t[\"Document.prototype.querySelector\", \"Document.prototype.querySelectorAll\"],\n\t\t{\n\t\t\tapply(ctx) {\n\t\t\t\tctx.args[0] = (ctx.args[0] as string).replace(\n\t\t\t\t\t/((?:^|\\s)\\b\\w+\\[(?:src|href|data-href))[\\^]?(=['\"]?(?:https?[:])?\\/\\/)/,\n\t\t\t\t\t\"$1*$2\"\n\t\t\t\t);\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Proxy(\"Document.prototype.write\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.writeln\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.parseHTMLUnsafe\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n}\n","import { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { nativeGetOwnPropertyDescriptor } from \"../natives\";\nimport {\n\tunrewriteUrl,\n\trewriteUrl,\n\thtmlRules,\n\tunrewriteHtml,\n} from \"../../shared\";\nimport { unrewriteCss, rewriteCss, rewriteHtml, rewriteJs } from \"../../shared\";\n\nconst encoder = new TextEncoder();\nfunction bytesToBase64(bytes: Uint8Array) {\n\tconst binString = Array.from(bytes, (byte) =>\n\t\tString.fromCodePoint(byte)\n\t).join(\"\");\n\n\treturn btoa(binString);\n}\nexport default function (client: ScramjetClient, self: typeof window) {\n\tconst attrObject = {\n\t\tnonce: [self.HTMLElement],\n\t\tintegrity: [self.HTMLScriptElement, self.HTMLLinkElement],\n\t\tcsp: [self.HTMLIFrameElement],\n\t\tcredentialless: [self.HTMLIFrameElement],\n\t\tsrc: [\n\t\t\tself.HTMLImageElement,\n\t\t\tself.HTMLMediaElement,\n\t\t\tself.HTMLIFrameElement,\n\t\t\tself.HTMLFrameElement,\n\t\t\tself.HTMLEmbedElement,\n\t\t\tself.HTMLScriptElement,\n\t\t\tself.HTMLSourceElement,\n\t\t],\n\t\thref: [\n\t\t\tself.HTMLAnchorElement,\n\t\t\tself.HTMLLinkElement,\n\t\t\tself.SVGUseElement,\n\t\t\tself.SVGImageElement,\n\t\t],\n\t\tdata: [self.HTMLObjectElement],\n\t\taction: [self.HTMLFormElement],\n\t\tformaction: [self.HTMLButtonElement, self.HTMLInputElement],\n\t\tsrcdoc: [self.HTMLIFrameElement],\n\t\tsrcset: [self.HTMLImageElement, self.HTMLSourceElement],\n\t\tposter: [self.HTMLVideoElement],\n\t\timagesrcset: [self.HTMLLinkElement],\n\t};\n\n\tconst urlinterfaces = [\n\t\tself.HTMLAnchorElement.prototype,\n\t\tself.HTMLAreaElement.prototype,\n\t];\n\tconst originalhrefs = [\n\t\tnativeGetOwnPropertyDescriptor(self.HTMLAnchorElement.prototype, \"href\"),\n\t\tnativeGetOwnPropertyDescriptor(self.HTMLAreaElement.prototype, \"href\"),\n\t];\n\n\tconst attrs = Object.keys(attrObject);\n\n\tfor (const attr of attrs) {\n\t\tfor (const element of attrObject[attr]) {\n\t\t\tconst descriptor = nativeGetOwnPropertyDescriptor(\n\t\t\t\telement.prototype,\n\t\t\t\tattr\n\t\t\t);\n\t\t\tObject.defineProperty(element.prototype, attr, {\n\t\t\t\tget() {\n\t\t\t\t\tif ([\"src\", \"data\", \"href\", \"action\", \"formaction\"].includes(attr)) {\n\t\t\t\t\t\treturn unrewriteUrl(descriptor.get.call(this));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn descriptor.get.call(this);\n\t\t\t\t},\n\n\t\t\t\tset(value) {\n\t\t\t\t\treturn this.setAttribute(attr, value);\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t// note that href is not here\n\tconst urlprops = [\n\t\t\"protocol\",\n\t\t\"hash\",\n\t\t\"host\",\n\t\t\"hostname\",\n\t\t\"origin\",\n\t\t\"pathname\",\n\t\t\"port\",\n\t\t\"search\",\n\t];\n\tfor (const prop of urlprops) {\n\t\tfor (const i in urlinterfaces) {\n\t\t\tconst target = urlinterfaces[i];\n\t\t\tconst desc = originalhrefs[i];\n\t\t\tclient.RawTrap(target, prop, {\n\t\t\t\tget(ctx) {\n\t\t\t\t\tconst href = desc.get.call(ctx.this);\n\t\t\t\t\tif (!href) return href;\n\n\t\t\t\t\tconst url = new URL(unrewriteUrl(href));\n\n\t\t\t\t\treturn url[prop];\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\tclient.Trap(\"Node.prototype.baseURI\", {\n\t\tget(ctx) {\n\t\t\tconst node = ctx.this as Node;\n\t\t\tlet base = node.ownerDocument?.querySelector(\"base\");\n\t\t\tif (node instanceof Document) base = node.querySelector(\"base\");\n\n\t\t\tif (base) {\n\t\t\t\treturn new URL(base.href, client.url.origin).href;\n\t\t\t}\n\n\t\t\treturn client.url.origin;\n\t\t},\n\t\tset(ctx, v) {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttribute\", {\n\t\tapply(ctx) {\n\t\t\tconst [name] = ctx.args;\n\n\t\t\tif (name.startsWith(\"scramjet-attr\")) {\n\t\t\t\treturn ctx.return(null);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.hasAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t`scramjet-attr-${name}`\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tconst attrib = ctx.fn.call(ctx.this, `scramjet-attr-${name}`);\n\t\t\t\tif (attrib === null) return ctx.return(\"\");\n\n\t\t\t\treturn ctx.return(attrib);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttributeNames\", {\n\t\tapply(ctx) {\n\t\t\tconst attrNames = ctx.call() as string[];\n\t\t\tconst cleaned = attrNames.filter(\n\t\t\t\t(attr) => !attr.startsWith(\"scramjet-attr\")\n\t\t\t);\n\n\t\t\tctx.return(cleaned);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getAttributeNode\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(null);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.hasAttribute\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(false);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setAttribute\", {\n\t\tapply(ctx) {\n\t\t\tconst [name, value] = ctx.args;\n\n\t\t\tconst ruleList = htmlRules.find((rule) => {\n\t\t\t\tconst r = rule[name.toLowerCase()];\n\t\t\t\tif (!r) return false;\n\t\t\t\tif (r === \"*\") return true;\n\t\t\t\tif (typeof r === \"function\") return false; // this can't happen but ts\n\n\t\t\t\treturn r.includes(ctx.this.tagName.toLowerCase());\n\t\t\t});\n\n\t\t\tif (ruleList) {\n\t\t\t\tctx.args[1] = ruleList.fn(value, client.meta, client.cookieStore);\n\t\t\t\tctx.fn.call(ctx.this, `scramjet-attr-${ctx.args[0]}`, value);\n\t\t\t}\n\t\t},\n\t});\n\n\t// i actually need to do something with this\n\tclient.Proxy(\"Element.prototype.setAttributeNode\", {\n\t\tapply(_ctx) {},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setAttributeNS\", {\n\t\tapply(ctx) {\n\t\t\tconst [_namespace, name, value] = ctx.args;\n\n\t\t\tconst ruleList = htmlRules.find((rule) => {\n\t\t\t\tconst r = rule[name.toLowerCase()];\n\t\t\t\tif (!r) return false;\n\t\t\t\tif (r === \"*\") return true;\n\t\t\t\tif (typeof r === \"function\") return false; // this can't happen but ts\n\n\t\t\t\treturn r.includes(ctx.this.tagName.toLowerCase());\n\t\t\t});\n\n\t\t\tif (ruleList) {\n\t\t\t\tctx.args[2] = ruleList.fn(value, client.meta, client.cookieStore);\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.setAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t`scramjet-attr-${ctx.args[1]}`,\n\t\t\t\t\tvalue\n\t\t\t\t);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.removeAttribute\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(undefined);\n\t\t\tif (\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.hasAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\tctx.args[0]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tctx.fn.call(ctx.this, `scramjet-attr-${ctx.args[0]}`);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.toggleAttribute\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0].startsWith(\"scramjet-attr\")) return ctx.return(false);\n\t\t\tif (\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.hasAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\tctx.args[0]\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tctx.fn.call(ctx.this, `scramjet-attr-${ctx.args[0]}`);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Element.prototype.innerHTML\", {\n\t\tset(ctx, value: string) {\n\t\t\tlet newval;\n\t\t\tif (ctx.this instanceof self.HTMLScriptElement) {\n\t\t\t\tnewval = rewriteJs(value, \"(anonymous script element)\", client.meta);\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Element.prototype.setAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t\"scramjet-attr-script-source-src\",\n\t\t\t\t\tbytesToBase64(encoder.encode(newval))\n\t\t\t\t);\n\t\t\t} else if (ctx.this instanceof self.HTMLStyleElement) {\n\t\t\t\tnewval = rewriteCss(value, client.meta);\n\t\t\t} else {\n\t\t\t\ttry {\n\t\t\t\t\tnewval = rewriteHtml(value, client.cookieStore, client.meta);\n\t\t\t\t} catch {\n\t\t\t\t\tnewval = value;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tctx.set(newval);\n\t\t},\n\t\tget(ctx) {\n\t\t\tif (ctx.this instanceof self.HTMLScriptElement) {\n\t\t\t\tconst scriptSource = client.natives.call(\n\t\t\t\t\t\"Element.prototype.getAttribute\",\n\t\t\t\t\tctx.this,\n\t\t\t\t\t\"scramjet-attr-script-source-src\"\n\t\t\t\t);\n\n\t\t\t\tif (scriptSource) {\n\t\t\t\t\treturn atob(scriptSource);\n\t\t\t\t}\n\n\t\t\t\treturn ctx.get();\n\t\t\t}\n\t\t\tif (ctx.this instanceof self.HTMLStyleElement) {\n\t\t\t\treturn ctx.get();\n\t\t\t}\n\n\t\t\treturn unrewriteHtml(ctx.get());\n\t\t},\n\t});\n\n\tclient.Trap(\"Element.prototype.outerHTML\", {\n\t\tset(ctx, value: string) {\n\t\t\tctx.set(rewriteHtml(value, client.cookieStore, client.meta));\n\t\t},\n\t\tget(ctx) {\n\t\t\treturn unrewriteHtml(ctx.get());\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.setHTMLUnsafe\", {\n\t\tapply(ctx) {\n\t\t\ttry {\n\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\tctx.args[0],\n\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\tclient.meta,\n\t\t\t\t\tfalse\n\t\t\t\t);\n\t\t\t} catch {}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.getHTML\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(unrewriteHtml(ctx.call()));\n\t\t},\n\t});\n\n\tclient.Proxy(\"Element.prototype.insertAdjacentHTML\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1])\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[1] = rewriteHtml(\n\t\t\t\t\t\tctx.args[1],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t},\n\t});\n\tclient.Proxy(\"Audio\", {\n\t\tconstruct(ctx) {\n\t\t\tif (ctx.args[0]) ctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n\tclient.Proxy(\"Text.prototype.appendData\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.this.parentElement?.tagName === \"STYLE\") {\n\t\t\t\tctx.args[0] = rewriteCss(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Text.prototype.insertData\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.this.parentElement?.tagName === \"STYLE\") {\n\t\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Text.prototype.replaceData\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.this.parentElement?.tagName === \"STYLE\") {\n\t\t\t\tctx.args[2] = rewriteCss(ctx.args[2], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Text.prototype.wholeText\", {\n\t\tget(ctx) {\n\t\t\tif (ctx.this.parentElement?.tagName === \"STYLE\") {\n\t\t\t\treturn unrewriteCss(ctx.get() as string);\n\t\t\t}\n\n\t\t\treturn ctx.get();\n\t\t},\n\t\tset(ctx, v) {\n\t\t\tif (ctx.this.parentElement?.tagName === \"STYLE\") {\n\t\t\t\treturn ctx.set(rewriteCss(v as string, client.meta));\n\t\t\t}\n\n\t\t\treturn ctx.set(v);\n\t\t},\n\t});\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"HTMLIFrameElement.prototype.contentWindow\",\n\t\t\t\"HTMLFrameElement.prototype.contentWindow\",\n\t\t\t\"HTMLObjectElement.prototype.contentWindow\",\n\t\t\t\"HTMLEmbedElement.prototype.contentWindow\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst realwin = ctx.get() as Window;\n\t\t\t\tif (!realwin) return realwin;\n\n\t\t\t\tif (SCRAMJETCLIENT in realwin) {\n\t\t\t\t\treturn realwin[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t} else {\n\t\t\t\t\t// hook the iframe\n\t\t\t\t\tconst newclient = new ScramjetClient(realwin);\n\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\treturn newclient.globalProxy;\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"HTMLIFrameElement.prototype.contentDocument\",\n\t\t\t\"HTMLFrameElement.prototype.contentDocument\",\n\t\t\t\"HTMLObjectElement.prototype.contentDocument\",\n\t\t\t\"HTMLEmbedElement.prototype.contentDocument\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst realwin = client.descriptors.get(\n\t\t\t\t\t`${ctx.this.constructor.name}.prototype.contentWindow`,\n\t\t\t\t\tctx.this\n\t\t\t\t);\n\t\t\t\tif (!realwin) return realwin;\n\n\t\t\t\tif (SCRAMJETCLIENT in realwin) {\n\t\t\t\t\treturn realwin[SCRAMJETCLIENT].documentProxy;\n\t\t\t\t} else {\n\t\t\t\t\tconst newclient = new ScramjetClient(realwin);\n\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\treturn newclient.documentProxy;\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Proxy(\n\t\t[\n\t\t\t\"HTMLIFrameElement.prototype.getSVGDocument\",\n\t\t\t\"HTMLObjectElement.prototype.getSVGDocument\",\n\t\t\t\"HTMLEmbedElement.prototype.getSVGDocument\",\n\t\t],\n\t\t{\n\t\t\tapply(ctx) {\n\t\t\t\tconst doc = ctx.call();\n\t\t\t\tif (doc) {\n\t\t\t\t\t// we trap the contentDocument, this is really the scramjet version\n\t\t\t\t\treturn ctx.return(ctx.this.contentDocument);\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t);\n\n\tclient.Trap(\"TreeWalker.prototype.currentNode\", {\n\t\tget(ctx) {\n\t\t\treturn ctx.get();\n\t\t},\n\t\tset(ctx, value) {\n\t\t\tif (value === client.documentProxy) {\n\t\t\t\treturn ctx.set(self.document);\n\t\t\t}\n\n\t\t\treturn ctx.set(value);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Document.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tconst doc = ctx.call() as Document;\n\n\t\t\tconst scram: ScramjetClient = doc[SCRAMJETCLIENT];\n\t\t\tif (!scram) return ctx.return(doc); // ??\n\n\t\t\treturn ctx.return(scram.documentProxy);\n\t\t},\n\t});\n\n\tclient.Trap(\"Node.prototype.ownerDocument\", {\n\t\tget(ctx) {\n\t\t\tconst doc = ctx.get() as Document | null;\n\t\t\tif (!doc) return null;\n\n\t\t\tconst scram: ScramjetClient = doc[SCRAMJETCLIENT];\n\t\t\tif (!scram) return doc; // ??\n\n\t\t\treturn scram.documentProxy;\n\t\t},\n\t});\n\n\tclient.Trap(\n\t\t[\n\t\t\t\"Node.prototype.parentNode\",\n\t\t\t\"Node.prototype.parentElement\",\n\t\t\t\"Node.prototype.previousSibling\",\n\t\t\t\"Node.prototype.nextSibling\",\n\t\t\t\"Range.prototype.commonAncestorContainer\",\n\t\t\t\"AbstractRange.prototype.endContainer\",\n\t\t\t\"AbstractRange.prototype.startContainer\",\n\t\t],\n\t\t{\n\t\t\tget(ctx) {\n\t\t\t\tconst n = ctx.get() as Node;\n\t\t\t\tif (!(n instanceof Document)) return n;\n\n\t\t\t\tconst scram: ScramjetClient = n[SCRAMJETCLIENT];\n\t\t\t\tif (!scram) return n; // ??\n\n\t\t\t\treturn scram.documentProxy;\n\t\t\t},\n\t\t}\n\t);\n\tclient.Proxy(\"Node.prototype.getRootNode\", {\n\t\tapply(ctx) {\n\t\t\tconst n = ctx.call() as Node;\n\t\t\tif (!(n instanceof Document)) return ctx.return(n);\n\n\t\t\tconst scram: ScramjetClient = n[SCRAMJETCLIENT];\n\t\t\tif (!scram) return ctx.return(n); // ??\n\n\t\t\treturn ctx.return(scram.documentProxy);\n\t\t},\n\t});\n\n\tclient.Proxy(\"DOMParser.prototype.parseFromString\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1] === \"text/html\") {\n\t\t\t\ttry {\n\t\t\t\t\tctx.args[0] = rewriteHtml(\n\t\t\t\t\t\tctx.args[0],\n\t\t\t\t\t\tclient.cookieStore,\n\t\t\t\t\t\tclient.meta,\n\t\t\t\t\t\tfalse\n\t\t\t\t\t);\n\t\t\t\t} catch {}\n\t\t\t}\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteCss } from \"../../shared\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"FontFace\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[1] = rewriteCss(ctx.args[1], client.meta);\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { rewriteUrl } from \"../../shared\";\nimport { UrlChangeEvent } from \"../events\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"History.prototype.pushState\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[2] || ctx.args[2] === \"\")\n\t\t\t\tctx.args[2] = rewriteUrl(ctx.args[2], client.meta);\n\t\t\tctx.call();\n\n\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(ev);\n\t\t},\n\t});\n\n\tclient.Proxy(\"History.prototype.replaceState\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[2] || ctx.args[2] === \"\")\n\t\t\t\tctx.args[2] = rewriteUrl(ctx.args[2], client.meta);\n\t\t\tctx.call();\n\n\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(ev);\n\t\t},\n\t});\n}\n","export default function (client, self: Self) {\n\t// @ts-ignore\n\tdelete self.navigation;\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"window.open\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0]) ctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\tif (ctx.args[1] === \"_top\" || ctx.args[1] === \"_unfencedTop\")\n\t\t\t\tctx.args[1] = client.meta.topFrameName;\n\t\t\tif (ctx.args[1] === \"_parent\") ctx.args[1] = client.meta.parentFrameName;\n\n\t\t\tconst realwin = ctx.call();\n\n\t\t\tif (!realwin) return ctx.return(realwin);\n\n\t\t\tif (SCRAMJETCLIENT in realwin) {\n\t\t\t\treturn ctx.return(realwin[SCRAMJETCLIENT].globalProxy);\n\t\t\t} else {\n\t\t\t\tconst newclient = new ScramjetClient(realwin);\n\t\t\t\t// hook the opened window\n\t\t\t\tnewclient.hook();\n\n\t\t\t\treturn ctx.return(newclient.globalProxy);\n\t\t\t}\n\t\t},\n\t});\n\n\t// opener will refer to the real window if it was opened by window.open\n\tclient.Trap(\"opener\", {\n\t\tget(ctx) {\n\t\t\tconst realwin = ctx.get() as Window;\n\n\t\t\tif (realwin && SCRAMJETCLIENT in realwin) {\n\t\t\t\treturn realwin[SCRAMJETCLIENT].globalProxy;\n\t\t\t} else {\n\t\t\t\t// the opener has to have been already hooked, so if we reach here then it's a real window\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"window.frameElement\", {\n\t\tget(ctx) {\n\t\t\tconst f = ctx.get() as HTMLIFrameElement | null;\n\t\t\tif (!f) return f;\n\n\t\t\tconst win = f.ownerDocument.defaultView;\n\t\t\tif (win[SCRAMJETCLIENT]) {\n\t\t\t\t// then this is a subframe in a scramjet context, and it's safe to pass back the real iframe\n\t\t\t\treturn f;\n\t\t\t} else {\n\t\t\t\t// no, the top frame is outside the sandbox\n\t\t\t\treturn null;\n\t\t\t}\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Trap(\"origin\", {\n\t\tget() {\n\t\t\t// this isn't right!!\n\t\t\treturn client.url.origin;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"Document.prototype.URL\", {\n\t\tget() {\n\t\t\treturn client.url.href;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"Document.prototype.documentURI\", {\n\t\tget() {\n\t\t\treturn client.url.href;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n\n\tclient.Trap(\"Document.prototype.domain\", {\n\t\tget() {\n\t\t\treturn client.url.hostname;\n\t\t},\n\t\tset() {\n\t\t\treturn false;\n\t\t},\n\t});\n}\n","import { unrewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Trap(\"PerformanceEntry.prototype.name\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tclient.Proxy(\"Navigator.prototype.registerProtocolHandler\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[1] = rewriteUrl(ctx.args[1], client.meta);\n\t\t},\n\t});\n\tclient.Proxy(\"Navigator.prototype.unregisterProtocolHandler\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[1] = rewriteUrl(ctx.args[1], client.meta);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nimport { type MessageC2W } from \"../../worker\";\nimport { flagEnabled } from \"../../scramjet\";\n\n// we need a late order because we're mangling with addEventListener at a higher level\nexport const order = 2;\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"serviceworkers\", client.url);\n\nexport function disabled(_client: ScramjetClient, _self: Self) {\n\tReflect.deleteProperty(Navigator.prototype, \"serviceWorker\");\n}\n\ntype FakeRegistrationState = {\n\tscope: string;\n\tactive: ServiceWorker;\n};\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tconst registrationmap: WeakMap<\n\t\tServiceWorkerRegistration,\n\t\tFakeRegistrationState\n\t> = new WeakMap();\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tif (registrationmap.get(ctx.this)) {\n\t\t\t\t// do nothing\n\t\t\t\tctx.return(undefined);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tif (registrationmap.get(ctx.this)) {\n\t\t\t\t// do nothing\n\t\t\t\tctx.return(undefined);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"ServiceWorkerContainer.prototype.getRegistration\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(new Promise((resolve) => resolve(registration)));\n\t\t},\n\t});\n\n\tclient.Proxy(\"ServiceWorkerContainer.prototype.getRegistrations\", {\n\t\tapply(ctx) {\n\t\t\tctx.return(new Promise((resolve) => resolve([registration])));\n\t\t},\n\t});\n\n\tclient.Trap(\"ServiceWorkerContainer.prototype.ready\", {\n\t\tget(_ctx) {\n\t\t\treturn new Promise((resolve) => resolve(registration));\n\t\t},\n\t});\n\n\tclient.Trap(\"ServiceWorkerContainer.prototype.controller\", {\n\t\tget(ctx) {\n\t\t\treturn registration?.active;\n\t\t},\n\t});\n\n\tclient.Proxy(\"ServiceWorkerContainer.prototype.register\", {\n\t\tapply(ctx) {\n\t\t\tconst fakeRegistration = new EventTarget() as ServiceWorkerRegistration;\n\t\t\tObject.setPrototypeOf(\n\t\t\t\tfakeRegistration,\n\t\t\t\tself.ServiceWorkerRegistration.prototype\n\t\t\t);\n\t\t\tfakeRegistration.constructor = ctx.fn;\n\t\t\tlet url = rewriteUrl(ctx.args[0], client.meta) + \"?dest=serviceworker\";\n\t\t\tif (ctx.args[1] && ctx.args[1].type === \"module\") {\n\t\t\t\turl += \"&type=module\";\n\t\t\t}\n\n\t\t\tconst worker = client.natives.construct(\"SharedWorker\", url);\n\t\t\tconst handle = worker.port;\n\t\t\tconst state: FakeRegistrationState = {\n\t\t\t\tscope: ctx.args[0],\n\t\t\t\tactive: handle as ServiceWorker,\n\t\t\t};\n\t\t\tconst controller = client.descriptors.get(\n\t\t\t\t\"ServiceWorkerContainer.prototype.controller\",\n\t\t\t\tclient.serviceWorker\n\t\t\t);\n\n\t\t\tclient.natives.call(\n\t\t\t\t\"ServiceWorker.prototype.postMessage\",\n\t\t\t\tcontroller,\n\t\t\t\t{\n\t\t\t\t\tscramjet$type: \"registerServiceWorker\",\n\t\t\t\t\tport: handle,\n\t\t\t\t\torigin: client.url.origin,\n\t\t\t\t} as MessageC2W,\n\t\t\t\t[handle]\n\t\t\t);\n\n\t\t\tregistrationmap.set(fakeRegistration, state);\n\t\t\tctx.return(new Promise((resolve) => resolve(fakeRegistration)));\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\tconst handler: ProxyHandler<Storage> = {\n\t\tget(target, prop) {\n\t\t\tswitch (prop) {\n\t\t\t\tcase \"getItem\":\n\t\t\t\t\treturn (key: string) => {\n\t\t\t\t\t\treturn target.getItem(client.url.host + \"@\" + key);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"setItem\":\n\t\t\t\t\treturn (key: string, value: string) => {\n\t\t\t\t\t\treturn target.setItem(client.url.host + \"@\" + key, value);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"removeItem\":\n\t\t\t\t\treturn (key: string) => {\n\t\t\t\t\t\treturn target.removeItem(client.url.host + \"@\" + key);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"clear\":\n\t\t\t\t\treturn () => {\n\t\t\t\t\t\tfor (const key in Object.keys(target)) {\n\t\t\t\t\t\t\tif (key.startsWith(client.url.host)) {\n\t\t\t\t\t\t\t\ttarget.removeItem(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\tcase \"key\":\n\t\t\t\t\treturn (index: number) => {\n\t\t\t\t\t\tconst keys = Object.keys(target).filter((key) =>\n\t\t\t\t\t\t\tkey.startsWith(client.url.host)\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn target.getItem(keys[index]);\n\t\t\t\t\t};\n\n\t\t\t\tcase \"length\":\n\t\t\t\t\treturn Object.keys(target).filter((key) =>\n\t\t\t\t\t\tkey.startsWith(client.url.host)\n\t\t\t\t\t).length;\n\n\t\t\t\tdefault:\n\t\t\t\t\tif (prop in Object.prototype || typeof prop === \"symbol\") {\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.log(\"GET\", prop, target == realLocalStorage);\n\n\t\t\t\t\treturn target.getItem(client.url.host + \"@\" + (prop as string));\n\t\t\t}\n\t\t},\n\n\t\tset(target, prop, value) {\n\t\t\tif (target == realLocalStorage)\n\t\t\t\tconsole.log(\"SET\", prop, value, target === realLocalStorage);\n\t\t\ttarget.setItem(client.url.host + \"@\" + (prop as string), value);\n\n\t\t\treturn true;\n\t\t},\n\n\t\townKeys(target) {\n\t\t\treturn Reflect.ownKeys(target)\n\t\t\t\t.filter((f) => typeof f === \"string\" && f.startsWith(client.url.host))\n\t\t\t\t.map((f) =>\n\t\t\t\t\ttypeof f === \"string\" ? f.substring(client.url.host.length + 1) : f\n\t\t\t\t);\n\t\t},\n\n\t\tgetOwnPropertyDescriptor(target, property) {\n\t\t\treturn {\n\t\t\t\tvalue: target.getItem(client.url.host + \"@\" + (property as string)),\n\t\t\t\tenumerable: true,\n\t\t\t\tconfigurable: true,\n\t\t\t\twritable: true,\n\t\t\t};\n\t\t},\n\n\t\tdefineProperty(target, property, attributes) {\n\t\t\ttarget.setItem(\n\t\t\t\tclient.url.host + \"@\" + (property as string),\n\t\t\t\tattributes.value\n\t\t\t);\n\n\t\t\treturn true;\n\t\t},\n\t};\n\n\tconst realLocalStorage = self.localStorage;\n\n\tconst localStorageProxy = new Proxy(self.localStorage, handler);\n\tconst sessionStorageProxy = new Proxy(self.sessionStorage, handler);\n\n\tdelete self.localStorage;\n\tdelete self.sessionStorage;\n\n\tself.localStorage = localStorageProxy;\n\tself.sessionStorage = sessionStorageProxy;\n}\n","import { ScramjetClient } from \"./client\";\n\nexport type ScramjetEvent =\n\t| NavigateEvent\n\t| UrlChangeEvent\n\t| ScramjetContextEvent;\nexport type ScramjetEvents = {\n\tnavigate: NavigateEvent;\n\turlchange: UrlChangeEvent;\n\tcontextInit: ScramjetContextEvent;\n};\n\nexport class NavigateEvent extends Event {\n\tconstructor(public url: string) {\n\t\tsuper(\"navigate\");\n\t}\n}\n\nexport class UrlChangeEvent extends Event {\n\tconstructor(public url: string) {\n\t\tsuper(\"urlchange\");\n\t}\n}\n\nexport class ScramjetContextEvent extends Event {\n\tconstructor(\n\t\tpublic window: Self,\n\t\tpublic client: ScramjetClient\n\t) {\n\t\tsuper(\"contextInit\");\n\t}\n}\n","// import { encodeUrl } from \"../shared\";\nimport { iswindow } from \".\";\nimport { SCRAMJETCLIENT } from \"../symbols\";\nimport { ScramjetClient } from \"./client\";\n// import { config } from \"../shared\";\nimport { getOwnPropertyDescriptorHandler } from \"./helpers\";\n\nexport const UNSAFE_GLOBALS = [\n\t\"window\",\n\t\"self\",\n\t\"globalThis\",\n\t\"this\",\n\t\"parent\",\n\t\"top\",\n\t\"location\",\n\t\"document\",\n\t\"eval\",\n\t\"frames\",\n];\n\nexport function createGlobalProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n): typeof globalThis {\n\treturn new Proxy(self, {\n\t\tget(target, prop) {\n\t\t\tconst value = Reflect.get(target, prop);\n\n\t\t\tif (\n\t\t\t\tiswindow &&\n\t\t\t\t(typeof prop === \"string\" || typeof prop === \"number\") &&\n\t\t\t\t!isNaN(Number(prop)) &&\n\t\t\t\tvalue\n\t\t\t) {\n\t\t\t\tconst win: Self = value.self;\n\t\t\t\t// indexing into window gives you the contentWindow of the subframes for some reason\n\t\t\t\t// you can't *set* it so this should always be the right value\n\t\t\t\tif (win) {\n\t\t\t\t\tif (SCRAMJETCLIENT in win) {\n\t\t\t\t\t\t// then we've already hooked this frame and we can just send over its proxy\n\t\t\t\t\t\treturn win[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// this can happen if it's an about:blank iframe that we've never gotten the chance to inject into\n\t\t\t\t\t\t// just make a new client for it and inject\n\t\t\t\t\t\tconst newclient = new ScramjetClient(win);\n\t\t\t\t\t\tnewclient.hook();\n\n\t\t\t\t\t\treturn newclient.globalProxy;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (prop === \"$scramjet\") return undefined;\n\n\t\t\tif (typeof prop === \"string\" && UNSAFE_GLOBALS.includes(prop)) {\n\t\t\t\t// TODO strict mode detect\n\t\t\t\treturn client.wrapfn(value, true);\n\t\t\t}\n\n\t\t\treturn value;\n\t\t},\n\n\t\tset(target, prop, value) {\n\t\t\tif (prop === \"location\") {\n\t\t\t\tclient.url = value;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn Reflect.set(target, prop, value);\n\t\t},\n\t\thas(target, prop) {\n\t\t\tif (prop === \"$scramjet\") return false;\n\n\t\t\treturn Reflect.has(target, prop);\n\t\t},\n\t\townKeys(target) {\n\t\t\treturn Reflect.ownKeys(target).filter((key) => key !== \"$scramjet\");\n\t\t},\n\t\tdefineProperty(target, property, attributes) {\n\t\t\tif (!attributes.get && !attributes.set) {\n\t\t\t\tattributes.writable = true;\n\t\t\t}\n\t\t\tattributes.configurable = true;\n\n\t\t\treturn Reflect.defineProperty(target, property, attributes);\n\t\t},\n\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t});\n}\n","export function getOwnPropertyDescriptorHandler(target, prop) {\n\tconst realDescriptor = Reflect.getOwnPropertyDescriptor(target, prop);\n\n\treturn realDescriptor;\n}\n","// entrypoint for scramjet.client.js\n\nimport { loadCodecs } from \"../scramjet\";\nimport { SCRAMJETCLIENT } from \"../symbols\";\nimport { ScramjetClient } from \"./client\";\nimport { ScramjetContextEvent, UrlChangeEvent } from \"./events\";\nimport { ScramjetServiceWorkerRuntime } from \"./swruntime\";\n\nexport const iswindow = \"window\" in self && window instanceof Window;\nexport const isworker = \"WorkerGlobalScope\" in self;\nexport const issw = \"ServiceWorkerGlobalScope\" in self;\nexport const isdedicated = \"DedicatedWorkerGlobalScope\" in self;\nexport const isshared = \"SharedWorkerGlobalScope\" in self;\nexport const isemulatedsw =\n\tnew URL(self.location.href).searchParams.get(\"dest\") === \"serviceworker\";\n\nfunction createFrameId() {\n\treturn `${Array(8)\n\t\t.fill(0)\n\t\t.map(() => Math.floor(Math.random() * 36).toString(36))\n\t\t.join(\"\")}`;\n}\n\ndbg.log(\"initializing scramjet client\");\n// if it already exists, that means the handlers have probably already been setup by the parent document\nif (!(SCRAMJETCLIENT in <Partial<typeof self>>self)) {\n\tloadCodecs();\n\n\tconst client = new ScramjetClient(self);\n\tconst frame: HTMLIFrameElement = self.frameElement as HTMLIFrameElement;\n\tif (frame && !frame.name) {\n\t\t// all frames need to be named for our logic to work\n\t\tframe.name = createFrameId();\n\t}\n\n\tif (self.COOKIE) client.loadcookies(self.COOKIE);\n\n\tclient.hook();\n\n\tif (isemulatedsw) {\n\t\tconst runtime = new ScramjetServiceWorkerRuntime(client);\n\t\truntime.hook();\n\t}\n\n\tconst contextev = new ScramjetContextEvent(client.global.window, client);\n\tclient.frame?.dispatchEvent(contextev);\n\tconst urlchangeev = new UrlChangeEvent(client.url.href);\n\tif (!client.isSubframe) client.frame?.dispatchEvent(urlchangeev);\n}\n\nReflect.deleteProperty(self, \"WASM\");\nReflect.deleteProperty(self, \"COOKIE\");\nif (\"document\" in self && document?.currentScript) {\n\tdocument.currentScript.remove();\n}\n","// @ts-nocheck\nimport { ScramjetClient } from \"./client\";\nimport { nativeGetOwnPropertyDescriptor } from \"./natives\";\nimport { rewriteUrl } from \"../shared\";\nimport { UrlChangeEvent } from \"./events\";\nimport { iswindow } from \".\";\n\nexport function createLocationProxy(\n\tclient: ScramjetClient,\n\tself: typeof globalThis\n) {\n\tconst Location = iswindow ? self.Location : self.WorkerLocation;\n\t// location cannot be Proxy()d\n\tconst fakeLocation = {};\n\tObject.setPrototypeOf(fakeLocation, Location.prototype);\n\tfakeLocation.constructor = Location;\n\n\t// for some reason it's on the object for Location and on the prototype for WorkerLocation??\n\tconst descriptorSource = iswindow ? self.location : Location.prototype;\n\tconst urlprops = [\n\t\t\"protocol\",\n\t\t\"hash\",\n\t\t\"host\",\n\t\t\"hostname\",\n\t\t\"href\",\n\t\t\"origin\",\n\t\t\"pathname\",\n\t\t\"port\",\n\t\t\"search\",\n\t];\n\tfor (const prop of urlprops) {\n\t\tconst native = nativeGetOwnPropertyDescriptor(descriptorSource, prop);\n\t\tif (!native) continue;\n\n\t\tconst desc = {\n\t\t\tconfigurable: true,\n\t\t\tenumerable: true,\n\t\t};\n\t\tif (native.get) {\n\t\t\tdesc.get = new Proxy(native.get, {\n\t\t\t\tapply() {\n\t\t\t\t\treturn client.url[prop];\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tif (native.set) {\n\t\t\tdesc.set = new Proxy(native.set, {\n\t\t\t\tapply(target, that, args) {\n\t\t\t\t\tif (prop === \"href\") {\n\t\t\t\t\t\t// special case\n\t\t\t\t\t\tclient.url = args[0];\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (prop === \"hash\") {\n\t\t\t\t\t\tself.location.hash = args[0];\n\t\t\t\t\t\tconst ev = new UrlChangeEvent(client.url.href);\n\t\t\t\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(ev);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tconst url = new URL(client.url.href);\n\t\t\t\t\turl[prop] = args[0];\n\t\t\t\t\tclient.url = url;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\tObject.defineProperty(fakeLocation, prop, desc);\n\t}\n\n\t// functions\n\tfakeLocation.toString = new Proxy(self.location.toString, {\n\t\tapply() {\n\t\t\treturn client.url.href;\n\t\t},\n\t});\n\n\tif (self.location.valueOf)\n\t\tfakeLocation.valueOf = new Proxy(self.location.valueOf, {\n\t\t\tapply() {\n\t\t\t\treturn client.url.href;\n\t\t\t},\n\t\t});\n\tif (self.location.assign)\n\t\tfakeLocation.assign = new Proxy(self.location.assign, {\n\t\t\tapply(target, that, args) {\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta);\n\t\t\t\tReflect.apply(target, self.location, args);\n\n\t\t\t\tconst urlchangeev = new UrlChangeEvent(client.url.href);\n\t\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(urlchangeev);\n\t\t\t},\n\t\t});\n\tif (self.location.reload)\n\t\tfakeLocation.reload = new Proxy(self.location.reload, {\n\t\t\tapply(target, that, args) {\n\t\t\t\tReflect.apply(target, self.location, args);\n\t\t\t},\n\t\t});\n\tif (self.location.replace)\n\t\tfakeLocation.replace = new Proxy(self.location.replace, {\n\t\t\tapply(target, that, args) {\n\t\t\t\targs[0] = rewriteUrl(args[0], client.meta);\n\t\t\t\tReflect.apply(target, self.location, args);\n\n\t\t\t\tconst urlchangeev = new UrlChangeEvent(client.url.href);\n\t\t\t\tif (!client.isSubframe) client.frame?.dispatchEvent(urlchangeev);\n\t\t\t},\n\t\t});\n\n\treturn fakeLocation;\n}\n","export const nativeFunction = self.Function;\nexport const nativeGetOwnPropertyDescriptor =\n\tself.Object.getOwnPropertyDescriptor;\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"console.clear\", {\n\t\tapply(ctx) {\n\t\t\t// fuck you\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tconst log = console.log;\n\tclient.Trap(\"console.log\", {\n\t\tset(_ctx, _v) {\n\t\t\t// is there a legitimate reason to let sites do this?\n\t\t},\n\t\tget(_ctx) {\n\t\t\treturn log;\n\t\t},\n\t});\n}\n","import { rewriteBlob, unrewriteBlob } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\nexport default function (client: ScramjetClient) {\n\t// hide the origin from object urls from the page\n\tclient.Proxy(\"URL.createObjectURL\", {\n\t\tapply(ctx) {\n\t\t\tconst url: string = ctx.call();\n\t\t\tif (url.startsWith(\"blob:\")) {\n\t\t\t\tctx.return(rewriteBlob(url, client.meta));\n\t\t\t} else {\n\t\t\t\tctx.return(url);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"URL.revokeObjectURL\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = unrewriteBlob(ctx.args[0]);\n\t\t},\n\t});\n}\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tclient.Proxy(\"CacheStorage.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Proxy(\"CacheStorage.prototype.has\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Proxy(\"CacheStorage.prototype.match\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"CacheStorage.prototype.delete\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.add\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.addAll\", {\n\t\tapply(ctx) {\n\t\t\tfor (let i = 0; i < ctx.args[0].length; i++) {\n\t\t\t\tif (\n\t\t\t\t\ttypeof ctx.args[0][i] === \"string\" ||\n\t\t\t\t\tctx.args[0][i] instanceof URL\n\t\t\t\t) {\n\t\t\t\t\tctx.args[0][i] = rewriteUrl(ctx.args[0][i], client.meta);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.put\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.match\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.matchAll\", {\n\t\tapply(ctx) {\n\t\t\tif (\n\t\t\t\t(ctx.args[0] && typeof ctx.args[0] === \"string\") ||\n\t\t\t\t(ctx.args[0] && ctx.args[0] instanceof URL)\n\t\t\t) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.keys\", {\n\t\tapply(ctx) {\n\t\t\tif (\n\t\t\t\t(ctx.args[0] && typeof ctx.args[0] === \"string\") ||\n\t\t\t\t(ctx.args[0] && ctx.args[0] instanceof URL)\n\t\t\t) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Cache.prototype.delete\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t\t}\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { ScramjetClient } from \"../client\";\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"captureErrors\", client.url);\nexport function argdbg(arg, recurse = []) {\n\tswitch (typeof arg) {\n\t\tcase \"string\":\n\t\t\tbreak;\n\t\tcase \"object\":\n\t\t\tif (\n\t\t\t\targ &&\n\t\t\t\targ[Symbol.iterator] &&\n\t\t\t\ttypeof arg[Symbol.iterator] === \"function\"\n\t\t\t)\n\t\t\t\tfor (const prop in arg) {\n\t\t\t\t\t// make sure it's not a getter\n\t\t\t\t\tconst desc = Object.getOwnPropertyDescriptor(arg, prop);\n\t\t\t\t\tif (desc && desc.get) continue;\n\n\t\t\t\t\tconst ar = arg[prop];\n\t\t\t\t\tif (recurse.includes(ar)) continue;\n\t\t\t\t\trecurse.push(ar);\n\t\t\t\t\targdbg(ar, recurse);\n\t\t\t\t}\n\t\t\tbreak;\n\t}\n}\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tself.$scramerr = function scramerr(e) {\n\t\tconsole.warn(\"CAUGHT ERROR\", e);\n\t};\n\n\tself.$scramdbg = function scramdbg(args, t) {\n\t\tif (args && typeof args === \"object\" && args.length > 0) argdbg(args);\n\t\targdbg(t);\n\n\t\treturn t;\n\t};\n\n\tclient.Proxy(\"Promise.prototype.catch\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\tctx.args[0] = new Proxy(ctx.args[0], {\n\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t// console.warn(\"CAUGHT PROMISE REJECTION\", args);\n\t\t\t\t\t\tReflect.apply(target, that, args);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { config, unrewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"cleanErrors\", client.url);\n\nexport default function (client: ScramjetClient, _self: Self) {\n\t// v8 only. all we need to do is clean the scramjet urls from stack traces\n\tconst closure = (error, stack) => {\n\t\tlet newstack = error.stack;\n\n\t\tfor (let i = 0; i < stack.length; i++) {\n\t\t\tconst url = stack[i].getFileName();\n\n\t\t\tif (url.endsWith(config.files.client)) {\n\t\t\t\t// strip stack frames including scramjet handlers from the trace\n\t\t\t\tconst lines = newstack.split(\"\\n\");\n\t\t\t\tconst line = lines.find((l) => l.includes(url));\n\t\t\t\tlines.splice(line, 1);\n\t\t\t\tnewstack = lines.join(\"\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tnewstack = newstack.replaceAll(url, unrewriteUrl(url));\n\t\t\t} catch {}\n\t\t}\n\n\t\treturn newstack;\n\t};\n\tclient.Trap(\"Error.prepareStackTrace\", {\n\t\tget(_ctx) {\n\t\t\t// this is a funny js quirk. the getter is ran every time you type something in console\n\t\t\treturn closure;\n\t\t},\n\t\tset(_value) {\n\t\t\t// just ignore it if a site tries setting their own. not much we can really do\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { config, rewriteJs } from \"../../shared\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\t// used for proxying *direct eval*\n\t// eval(\"...\") -> eval($scramjet$rewrite(\"...\"))\n\tObject.defineProperty(self, config.globals.rewritefn, {\n\t\tvalue: function (js: any) {\n\t\t\tif (typeof js !== \"string\") return js;\n\n\t\t\tconst rewritten = rewriteJs(js, \"(direct eval proxy)\", client.meta);\n\n\t\t\treturn rewritten;\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n}\n\nexport function indirectEval(this: ScramjetClient, strict: boolean, js: any) {\n\t// > If the argument of eval() is not a string, eval() returns the argument unchanged\n\tif (typeof js !== \"string\") return js;\n\n\tlet indirection: typeof eval;\n\tif (this.url.hostname === \"accounts.google.com\") {\n\t\tconsole.log(\"USING STRICT EVAL - BOTGUARD\");\n\t\tindirection = new Function(`\n\t\t\t\"use strict\";\n\t\t\treturn eval;\n\t\t`) as typeof eval;\n\t} else {\n\t\tindirection = this.global.eval;\n\t}\n\n\treturn indirection(\n\t\trewriteJs(js, \"(indirect eval proxy)\", this.meta) as string\n\t);\n}\n","import { iswindow } from \"..\";\nimport { unrewriteUrl } from \"../../shared\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { getOwnPropertyDescriptorHandler } from \"../helpers\";\nimport { nativeGetOwnPropertyDescriptor } from \"../natives\";\nimport { unproxy } from \"./unproxy\";\n\nconst realOnEvent = Symbol.for(\"scramjet original onevent function\");\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst handlers = {\n\t\tmessage: {\n\t\t\t_init() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$type\" in this.data) {\n\t\t\t\t\t// this is a ctl message\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tports() {\n\t\t\t\t// don't know why i have to do this?\n\t\t\t\treturn this.ports;\n\t\t\t},\n\t\t\tsource() {\n\t\t\t\tif (this.source === null) return null;\n\n\t\t\t\tconst scram: ScramjetClient = this.source[SCRAMJETCLIENT];\n\n\t\t\t\tif (scram) return scram.globalProxy;\n\n\t\t\t\treturn this.source;\n\t\t\t},\n\t\t\torigin() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$origin\" in this.data)\n\t\t\t\t\treturn this.data.$scramjet$origin;\n\n\t\t\t\treturn client.url.origin;\n\t\t\t},\n\t\t\tdata() {\n\t\t\t\tif (typeof this.data === \"object\" && \"$scramjet$data\" in this.data)\n\t\t\t\t\treturn this.data.$scramjet$data;\n\n\t\t\t\treturn this.data;\n\t\t\t},\n\t\t},\n\t\thashchange: {\n\t\t\toldURL() {\n\t\t\t\treturn unrewriteUrl(this.oldURL);\n\t\t\t},\n\t\t\tnewURL() {\n\t\t\t\treturn unrewriteUrl(this.newURL);\n\t\t\t},\n\t\t},\n\t\tstorage: {\n\t\t\t_init() {\n\t\t\t\treturn this.key.startsWith(client.url.host + \"@\");\n\t\t\t},\n\t\t\tkey() {\n\t\t\t\treturn this.key.substring(this.key.indexOf(\"@\") + 1);\n\t\t\t},\n\t\t\turl() {\n\t\t\t\treturn unrewriteUrl(this.url);\n\t\t\t},\n\t\t},\n\t};\n\n\tfunction wraplistener(listener: (...args: any) => any) {\n\t\treturn new Proxy(listener, {\n\t\t\tapply(target, that, args) {\n\t\t\t\tconst realEvent: Event = args[0];\n\n\t\t\t\t// we only need to handle events dispatched from the browser\n\t\t\t\tif (realEvent.isTrusted) {\n\t\t\t\t\tconst type = realEvent.type;\n\n\t\t\t\t\tif (type in handlers) {\n\t\t\t\t\t\tconst handler = handlers[type];\n\n\t\t\t\t\t\tif (handler._init) {\n\t\t\t\t\t\t\tif (handler._init.call(realEvent) === false) return;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\targs[0] = new Proxy(realEvent, {\n\t\t\t\t\t\t\tget(target, prop, reciever) {\n\t\t\t\t\t\t\t\tconst value = Reflect.get(target, prop);\n\t\t\t\t\t\t\t\tif (prop in handler) {\n\t\t\t\t\t\t\t\t\treturn handler[prop].call(target);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (typeof value === \"function\") {\n\t\t\t\t\t\t\t\t\treturn new Proxy(value, {\n\t\t\t\t\t\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\t\t\t\t\t\tif (that === reciever) {\n\t\t\t\t\t\t\t\t\t\t\t\treturn Reflect.apply(target, realEvent, args);\n\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\treturn Reflect.apply(target, that, args);\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn value;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!self.event) {\n\t\t\t\t\tObject.defineProperty(self, \"event\", {\n\t\t\t\t\t\tget() {\n\t\t\t\t\t\t\treturn args[0];\n\t\t\t\t\t\t},\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tconst rv = Reflect.apply(target, that, args);\n\n\t\t\t\treturn rv;\n\t\t\t},\n\t\t\tgetOwnPropertyDescriptor: getOwnPropertyDescriptorHandler,\n\t\t});\n\t}\n\n\tclient.Proxy(\"EventTarget.prototype.addEventListener\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] !== \"function\") return;\n\n\t\t\tconst origlistener = ctx.args[1];\n\t\t\tconst proxylistener = wraplistener(origlistener);\n\n\t\t\tctx.args[1] = proxylistener;\n\n\t\t\tlet arr = client.eventcallbacks.get(ctx.this);\n\t\t\tarr ||= [] as any;\n\t\t\tarr.push({\n\t\t\t\tevent: ctx.args[0] as string,\n\t\t\t\toriginalCallback: origlistener,\n\t\t\t\tproxiedCallback: proxylistener,\n\t\t\t});\n\t\t\tclient.eventcallbacks.set(ctx.this, arr);\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.removeEventListener\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] !== \"function\") return;\n\n\t\t\tconst arr = client.eventcallbacks.get(ctx.this);\n\t\t\tif (!arr) return;\n\n\t\t\tconst i = arr.findIndex(\n\t\t\t\t(e) => e.event === ctx.args[0] && e.originalCallback === ctx.args[1]\n\t\t\t);\n\t\t\tif (i === -1) return;\n\n\t\t\tconst r = arr.splice(i, 1);\n\t\t\tclient.eventcallbacks.set(ctx.this, arr);\n\n\t\t\tctx.args[1] = r[0].proxiedCallback;\n\t\t},\n\t});\n\n\tclient.Proxy(\"EventTarget.prototype.dispatchEvent\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t},\n\t});\n\n\tconst targets = [self.self, self.MessagePort.prototype] as Array<any>;\n\tif (iswindow) targets.push(self.HTMLElement.prototype);\n\tif (self.Worker) targets.push(self.Worker.prototype);\n\n\tfor (const target of targets) {\n\t\tconst keys = Reflect.ownKeys(target);\n\n\t\tfor (const key of keys) {\n\t\t\tif (\n\t\t\t\ttypeof key === \"string\" &&\n\t\t\t\tkey.startsWith(\"on\") &&\n\t\t\t\thandlers[key.slice(2)]\n\t\t\t) {\n\t\t\t\tconst descriptor = nativeGetOwnPropertyDescriptor(target, key);\n\t\t\t\tif (!descriptor.get || !descriptor.set || !descriptor.configurable)\n\t\t\t\t\tcontinue;\n\n\t\t\t\t// these are the `onmessage`, `onclick`, etc. properties\n\t\t\t\tclient.RawTrap(target, key, {\n\t\t\t\t\tget(ctx) {\n\t\t\t\t\t\tif (this[realOnEvent]) return this[realOnEvent];\n\n\t\t\t\t\t\treturn ctx.get();\n\t\t\t\t\t},\n\t\t\t\t\tset(ctx, value: any) {\n\t\t\t\t\t\tthis[realOnEvent] = value;\n\n\t\t\t\t\t\tif (typeof value !== \"function\") return ctx.set(value);\n\n\t\t\t\t\t\tctx.set(wraplistener(value));\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n","import { ScramjetClient, ProxyCtx, Proxy } from \"../client\";\nimport { rewriteJs } from \"../../shared\";\n\nfunction rewriteFunction(ctx: ProxyCtx, client: ScramjetClient) {\n\tconst stringifiedFunction = ctx.call().toString();\n\n\tconst content = rewriteJs(\n\t\tstringifiedFunction,\n\t\t\"(function proxy)\",\n\t\tclient.meta\n\t);\n\tctx.return(ctx.fn(`return ${content}`)());\n}\n\nexport default function (client: ScramjetClient, _self: Self) {\n\tconst handler: Proxy = {\n\t\tapply(ctx: ProxyCtx) {\n\t\t\trewriteFunction(ctx, client);\n\t\t},\n\t\tconstruct(ctx) {\n\t\t\trewriteFunction(ctx, client);\n\t\t},\n\t};\n\n\tclient.Proxy(\"Function\", handler);\n\t/*\n\t// god i love javascript\n\tclient.RawProxy(function () {}.constructor.prototype, \"constructor\", handler);\n\tclient.RawProxy(\n\t\tasync function () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\tclient.RawProxy(\n\t\tfunction* () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\tclient.RawProxy(\n\t\tasync function* () {}.constructor.prototype,\n\t\t\"constructor\",\n\t\thandler\n\t);\n\t*/\n}\n","import { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\nimport { rewriteUrl } from \"../../shared/rewriters/url\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tconst Function = client.natives.store[\"Function\"];\n\n\tself[config.globals.importfn] = function (base: string, url: string) {\n\t\tconst resolved = new URL(url, base).href;\n\n\t\treturn Function(\n\t\t\t`return import(\"${rewriteUrl(resolved, client.meta)}?type=module\")`\n\t\t)();\n\t};\n\n\tself[config.globals.metafn] = function (base: string) {\n\t\treturn {\n\t\t\turl: base,\n\t\t\tresolve: function (url: string) {\n\t\t\t\treturn new URL(url, base).href;\n\t\t\t},\n\t\t};\n\t};\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"IDBFactory.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tctx.args[0] = `${client.url.origin}@${ctx.args[0]}`;\n\t\t},\n\t});\n\n\tclient.Trap(\"IDBDatabase.prototype.name\", {\n\t\tget(ctx) {\n\t\t\tconst name = ctx.get() as string;\n\n\t\t\treturn name.substring(name.indexOf(\"@\") + 1);\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"StorageManager.prototype.getDirectory\", {\n\t\tapply(ctx) {\n\t\t\tconst rootPromise = ctx.call() as Promise<FileSystemDirectoryHandle>;\n\t\t\tctx.return(\n\t\t\t\t(async () => {\n\t\t\t\t\tconst root = await rootPromise;\n\t\t\t\t\tconst directory = await root.getDirectoryHandle(\n\t\t\t\t\t\t`${client.url.origin.replace(/\\/|\\s|\\./g, \"-\")}`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcreate: true,\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tObject.defineProperty(directory, \"name\", {\n\t\t\t\t\t\tvalue: \"\",\n\t\t\t\t\t\twritable: false,\n\t\t\t\t\t});\n\n\t\t\t\t\treturn directory;\n\t\t\t\t})()\n\t\t\t);\n\t\t},\n\t});\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { POLLUTANT } from \"../shared/realm\";\n\nexport default function (client: ScramjetClient) {\n\tif (iswindow)\n\t\tclient.Proxy(\"window.postMessage\", {\n\t\t\tapply(ctx) {\n\t\t\t\t// so we need to send the real origin here, since the recieving window can't possibly know.\n\t\t\t\t// except, remember that this code is being ran in a different realm than the invoker, so if we ask our `client` it may give us the wrong origin\n\t\t\t\t// if we were given any object that came from the real realm we can use that to get the real origin\n\t\t\t\t// and this works in every case EXCEPT for the fact that all three arguments can be strings which are copied instead of cloned\n\t\t\t\t// so we have to use `$setrealm` which will pollute this with an object from the real realm\n\n\t\t\t\tlet pollutant;\n\n\t\t\t\tif (typeof ctx.args[0] === \"object\" && ctx.args[0] !== null) {\n\t\t\t\t\tpollutant = ctx.args[0]; // try to use the first object we can find because it's more reliable\n\t\t\t\t} else if (typeof ctx.args[2] === \"object\" && ctx.args[2] !== null) {\n\t\t\t\t\tpollutant = ctx.args[2]; // next try to use transfer\n\t\t\t\t} else if (\n\t\t\t\t\tctx.this &&\n\t\t\t\t\tPOLLUTANT in ctx.this &&\n\t\t\t\t\ttypeof ctx.this[POLLUTANT] === \"object\" &&\n\t\t\t\t\tctx.this[POLLUTANT] !== null\n\t\t\t\t) {\n\t\t\t\t\tpollutant = ctx.this[POLLUTANT]; // lastly try to use the object from $setrealm\n\t\t\t\t} else {\n\t\t\t\t\tpollutant = {}; // give up\n\t\t\t\t}\n\n\t\t\t\t// and now we can steal Function from the caller's realm\n\t\t\t\tconst {\n\t\t\t\t\tconstructor: { constructor: Function },\n\t\t\t\t} = pollutant;\n\n\t\t\t\t// invoking stolen function will give us the caller's globalThis, remember scramjet has already proxied it!!!\n\t\t\t\tconst callerGlobalThisProxied: Self = Function(\"return globalThis\")();\n\t\t\t\tconst callerClient = callerGlobalThisProxied[SCRAMJETCLIENT];\n\n\t\t\t\t// this WOULD be enough but the source argument of MessageEvent has to return the caller's window\n\t\t\t\t// and if we just call it normally it would be coming from here, which WILL NOT BE THE CALLER'S because the accessor is from the parent\n\t\t\t\t// so with the stolen function we wrap postmessage so the source will truly be the caller's window (remember that function is scramjet's!!!)\n\t\t\t\tconst wrappedPostMessage = Function(\"...args\", \"this(...args)\");\n\n\t\t\t\tctx.args[0] = {\n\t\t\t\t\t$scramjet$messagetype: \"window\",\n\t\t\t\t\t$scramjet$origin: callerClient.url.origin,\n\t\t\t\t\t$scramjet$data: ctx.args[0],\n\t\t\t\t};\n\n\t\t\t\t// * origin because obviously\n\t\t\t\tif (typeof ctx.args[1] === \"string\") ctx.args[1] = \"*\";\n\t\t\t\tif (typeof ctx.args[1] === \"object\") ctx.args[1].targetOrigin = \"*\";\n\n\t\t\t\tctx.return(wrappedPostMessage.call(ctx.fn, ...ctx.args));\n\t\t\t},\n\t\t});\n\n\tconst toproxy = [\"MessagePort.prototype.postMessage\"];\n\n\tif (self.Worker) toproxy.push(\"Worker.prototype.postMessage\");\n\tif (!iswindow) toproxy.push(\"self.postMessage\"); // only do the generic version if we're in a worker\n\n\tclient.Proxy(toproxy, {\n\t\tapply(ctx) {\n\t\t\t// origin/source doesn't need to be preserved - it's null in the message event\n\n\t\t\tctx.args[0] = {\n\t\t\t\t$scramjet$messagetype: \"worker\",\n\t\t\t\t$scramjet$data: ctx.args[0],\n\t\t\t};\n\t\t},\n\t});\n}\n","import { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\n\nexport const POLLUTANT = Symbol.for(\"scramjet realm pollutant\");\n\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\t// object.$setrealm({}).postMessage(...)\n\t// the empty object is the \"pollutant\" which can reconstruct the real realm\n\t// i explain more in postmessage.ts\n\tObject.defineProperty(self.Object.prototype, config.globals.setrealmfn, {\n\t\tvalue(pollution: object) {\n\t\t\t// this is bad!! sites could detect this\n\t\t\tObject.defineProperty(this, POLLUTANT, {\n\t\t\t\tvalue: pollution,\n\t\t\t\twritable: false,\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: false,\n\t\t\t});\n\n\t\t\treturn this;\n\t\t},\n\t\twritable: true,\n\t\tconfigurable: true,\n\t\tenumerable: false,\n\t});\n}\n","import { unrewriteUrl, rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"EventSource\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\t\t},\n\t});\n\n\tclient.Trap(\"EventSource.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tunrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","// ts throws an error if you dont do window.fetch\n\nimport { isemulatedsw } from \"../..\";\nimport { unrewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\nimport { rewriteUrl } from \"../../../shared\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"fetch\", {\n\t\tapply(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\t\tif (isemulatedsw) ctx.args[0] += \"?from=swruntime\";\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Proxy(\"Request\", {\n\t\tconstruct(ctx) {\n\t\t\tif (typeof ctx.args[0] === \"string\" || ctx.args[0] instanceof URL) {\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta);\n\n\t\t\t\tif (isemulatedsw) ctx.args[0] += \"?from=swruntime\";\n\t\t\t}\n\t\t},\n\t});\n\n\tclient.Trap(\"Response.prototype.url\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n\n\tclient.Trap(\"Request.prototype.url\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { type BareWebSocket } from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetClient } from \"../../client\";\n\ntype FakeWebSocketState = {\n\textensions: string;\n\tprotocol: string;\n\turl: string;\n\tbinaryType: string;\n\tbarews: BareWebSocket;\n\n\tonclose?: (ev: CloseEvent) => any;\n\tonerror?: (ev: Event) => any;\n\tonmessage?: (ev: MessageEvent) => any;\n\tonopen?: (ev: Event) => any;\n};\ntype FakeWebSocketStreamState = {\n\textensions: string;\n\tprotocol: string;\n\turl: string;\n\tbarews: BareWebSocket;\n\n\topened: any;\n\tclosed: any;\n\treadable: ReadableStream;\n\twritable: WritableStream;\n};\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\tconst socketmap: WeakMap<WebSocket, FakeWebSocketState> = new WeakMap();\n\tconst socketstreammap: WeakMap<object, FakeWebSocketStreamState> =\n\t\tnew WeakMap();\n\tclient.Proxy(\"WebSocket\", {\n\t\tconstruct(ctx) {\n\t\t\tconst fakeWebSocket = new EventTarget() as WebSocket;\n\t\t\tObject.setPrototypeOf(fakeWebSocket, ctx.fn.prototype);\n\t\t\tfakeWebSocket.constructor = ctx.fn;\n\n\t\t\tconst trustEvent = (ev: Event) =>\n\t\t\t\tnew Proxy(ev, {\n\t\t\t\t\tget(target, prop) {\n\t\t\t\t\t\tif (prop === \"isTrusted\") return true;\n\n\t\t\t\t\t\treturn Reflect.get(target, prop);\n\t\t\t\t\t},\n\t\t\t\t});\n\n\t\t\tconst barews = client.bare.createWebSocket(\n\t\t\t\tctx.args[0],\n\t\t\t\tctx.args[1],\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\t\"User-Agent\": self.navigator.userAgent,\n\t\t\t\t\tOrigin: client.url.origin,\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tconst state: FakeWebSocketState = {\n\t\t\t\textensions: \"\",\n\t\t\t\tprotocol: \"\",\n\t\t\t\turl: ctx.args[0],\n\t\t\t\tbinaryType: \"blob\",\n\t\t\t\tbarews,\n\n\t\t\t\tonclose: null,\n\t\t\t\tonerror: null,\n\t\t\t\tonmessage: null,\n\t\t\t\tonopen: null,\n\t\t\t};\n\n\t\t\tfunction fakeEventSend(fakeev: Event) {\n\t\t\t\tstate[\"on\" + fakeev.type]?.(trustEvent(fakeev));\n\t\t\t\tfakeWebSocket.dispatchEvent(fakeev);\n\t\t\t}\n\n\t\t\tbarews.addEventListener(\"open\", () => {\n\t\t\t\tfakeEventSend(new Event(\"open\"));\n\t\t\t});\n\t\t\tbarews.addEventListener(\"close\", (ev) => {\n\t\t\t\tfakeEventSend(new CloseEvent(\"close\", ev));\n\t\t\t});\n\t\t\tbarews.addEventListener(\"message\", async (ev) => {\n\t\t\t\tlet payload = ev.data;\n\t\t\t\tif (typeof payload === \"string\") {\n\t\t\t\t\t// DO NOTHING\n\t\t\t\t} else if (\"byteLength\" in payload) {\n\t\t\t\t\t// arraybuffer, convert to blob if needed or set the proper prototype\n\t\t\t\t\tif (state.binaryType === \"blob\") {\n\t\t\t\t\t\tpayload = new Blob([payload]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t}\n\t\t\t\t} else if (\"arrayBuffer\" in payload) {\n\t\t\t\t\t// blob, convert to arraybuffer if neccesary.\n\t\t\t\t\tif (state.binaryType === \"arraybuffer\") {\n\t\t\t\t\t\tpayload = await payload.arrayBuffer();\n\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst fakeev = new MessageEvent(\"message\", {\n\t\t\t\t\tdata: payload,\n\t\t\t\t\torigin: ev.origin,\n\t\t\t\t\tlastEventId: ev.lastEventId,\n\t\t\t\t\tsource: ev.source,\n\t\t\t\t\tports: ev.ports,\n\t\t\t\t});\n\n\t\t\t\tfakeEventSend(fakeev);\n\t\t\t});\n\t\t\tbarews.addEventListener(\"error\", () => {\n\t\t\t\tfakeEventSend(new Event(\"error\"));\n\t\t\t});\n\n\t\t\tsocketmap.set(fakeWebSocket, state);\n\t\t\tctx.return(fakeWebSocket);\n\t\t},\n\t});\n\tclient.Trap(\"WebSocket.prototype.binaryType\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.binaryType;\n\t\t},\n\t\tset(ctx, v: string) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (v === \"blob\" || v === \"arraybuffer\") ws.binaryType = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.bufferedAmount\", {\n\t\tget() {\n\t\t\treturn 0;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.extensions\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.extensions;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onclose\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onclose;\n\t\t},\n\t\tset(ctx, v: (ev: CloseEvent) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onclose = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onerror\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onerror;\n\t\t},\n\t\tset(ctx, v: (ev: Event) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onerror = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onmessage\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onmessage;\n\t\t},\n\t\tset(ctx, v: (ev: MessageEvent) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onmessage = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.onopen\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.onopen;\n\t\t},\n\t\tset(ctx, v: (ev: Event) => any) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tws.onopen = v;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.url;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.protocol\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.protocol;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocket.prototype.readyState\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\treturn ws.barews.readyState;\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocket.prototype.send\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\n\t\t\tctx.return(ws.barews.send(ctx.args[0]));\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocket.prototype.close\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketmap.get(ctx.this);\n\t\t\tif (ctx.args[0] === undefined) ctx.args[0] = 1000;\n\t\t\tif (ctx.args[1] === undefined) ctx.args[1] = \"\";\n\t\t\tctx.return(ws.barews.close(ctx.args[0], ctx.args[1]));\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocketStream\", {\n\t\tconstruct(ctx) {\n\t\t\tconst fakeWebSocket = {};\n\t\t\tObject.setPrototypeOf(fakeWebSocket, ctx.fn.prototype);\n\t\t\tfakeWebSocket.constructor = ctx.fn;\n\n\t\t\tconst barews = client.bare.createWebSocket(\n\t\t\t\tctx.args[0],\n\t\t\t\tctx.args[1],\n\t\t\t\tnull,\n\t\t\t\t{\n\t\t\t\t\t\"User-Agent\": self.navigator.userAgent,\n\t\t\t\t\tOrigin: client.url.origin,\n\t\t\t\t}\n\t\t\t);\n\t\t\tctx.args[1]?.signal.addEventListener(\"abort\", () => {\n\t\t\t\tbarews.close(1000, \"\");\n\t\t\t});\n\t\t\tlet openResolver, closeResolver;\n\t\t\tlet openRejector;\n\t\t\tconst state: FakeWebSocketStreamState = {\n\t\t\t\textensions: \"\",\n\t\t\t\tprotocol: \"\",\n\t\t\t\turl: ctx.args[0],\n\t\t\t\tbarews,\n\n\t\t\t\topened: new Promise((resolve, reject) => {\n\t\t\t\t\topenResolver = resolve;\n\t\t\t\t\topenRejector = reject;\n\t\t\t\t}),\n\t\t\t\tclosed: new Promise((resolve) => {\n\t\t\t\t\tcloseResolver = resolve;\n\t\t\t\t}),\n\t\t\t\treadable: new ReadableStream({\n\t\t\t\t\tstart(controller) {\n\t\t\t\t\t\tbarews.addEventListener(\"message\", async (ev: MessageEvent) => {\n\t\t\t\t\t\t\tlet payload = ev.data;\n\t\t\t\t\t\t\tif (typeof payload === \"string\") {\n\t\t\t\t\t\t\t\t// DO NOTHING\n\t\t\t\t\t\t\t} else if (\"byteLength\" in payload) {\n\t\t\t\t\t\t\t\t// arraybuffer, set the realms prototype so its recognized\n\t\t\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t\t\t} else if (\"arrayBuffer\" in payload) {\n\t\t\t\t\t\t\t\t// blob, convert to arraybuffer\n\t\t\t\t\t\t\t\tpayload = await payload.arrayBuffer();\n\t\t\t\t\t\t\t\tObject.setPrototypeOf(payload, ArrayBuffer.prototype);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcontroller.enqueue(payload);\n\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t\twritable: new WritableStream({\n\t\t\t\t\twrite(chunk) {\n\t\t\t\t\t\tbarews.send(chunk);\n\t\t\t\t\t},\n\t\t\t\t}),\n\t\t\t};\n\t\t\tbarews.addEventListener(\"open\", () => {\n\t\t\t\topenResolver({\n\t\t\t\t\treadable: state.readable,\n\t\t\t\t\twritable: state.writable,\n\t\t\t\t\textensions: state.extensions,\n\t\t\t\t\tprotocol: state.protocol,\n\t\t\t\t});\n\t\t\t});\n\t\t\tbarews.addEventListener(\"close\", (ev: CloseEvent) => {\n\t\t\t\tcloseResolver({ code: ev.code, reason: ev.reason });\n\t\t\t});\n\n\t\t\tbarews.addEventListener(\"error\", (ev: Event) => {\n\t\t\t\topenRejector(ev);\n\t\t\t});\n\n\t\t\tsocketstreammap.set(fakeWebSocket, state);\n\t\t\tctx.return(fakeWebSocket);\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocketStream.prototype.closed\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\n\t\t\treturn ws.closed;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocketStream.prototype.opened\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\n\t\t\treturn ws.opened;\n\t\t},\n\t});\n\n\tclient.Trap(\"WebSocketStream.prototype.url\", {\n\t\tget(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\n\t\t\treturn ws.url;\n\t\t},\n\t});\n\n\tclient.Proxy(\"WebSocketStream.prototype.close\", {\n\t\tapply(ctx) {\n\t\t\tconst ws = socketstreammap.get(ctx.this);\n\t\t\tif (ctx.args[0]) {\n\t\t\t\tif (ctx.args[0].closeCode === undefined) ctx.args[0].closeCode = 1000;\n\t\t\t\tif (ctx.args[0].reason === undefined) ctx.args[0].reason = \"\";\n\n\t\t\t\treturn ctx.return(\n\t\t\t\t\tws.barews.close(ctx.args[0].closeCode, ctx.args[0].reason)\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn ctx.return(ws.barews.close(1000, \"\"));\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../../scramjet\";\nimport { config, unrewriteUrl, rewriteUrl } from \"../../../shared\";\nimport { ScramjetClient } from \"../../client\";\n\nexport default function (client: ScramjetClient, self: Self) {\n\tlet worker;\n\tif (self.Worker && flagEnabled(\"syncxhr\", client.url)) {\n\t\tworker = client.natives.construct(\"Worker\", config.files.sync);\n\t}\n\tconst ARGS = Symbol(\"xhr original args\");\n\tconst HEADERS = Symbol(\"xhr headers\");\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.open\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[1]) ctx.args[1] = rewriteUrl(ctx.args[1], client.meta);\n\t\t\tif (ctx.args[2] === undefined) ctx.args[2] = true;\n\t\t\tctx.this[ARGS] = ctx.args;\n\t\t},\n\t});\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.setRequestHeader\", {\n\t\tapply(ctx) {\n\t\t\tconst headers = ctx.this[HEADERS] || (ctx.this[HEADERS] = {});\n\t\t\theaders[ctx.args[0]] = ctx.args[1];\n\t\t},\n\t});\n\n\tclient.Proxy(\"XMLHttpRequest.prototype.send\", {\n\t\tapply(ctx) {\n\t\t\tconst args = ctx.this[ARGS];\n\t\t\tif (!args || args[2]) return;\n\n\t\t\tif (!flagEnabled(\"syncxhr\", client.url)) {\n\t\t\t\tconsole.warn(\"ignoring request - sync xhr disabled in flags\");\n\n\t\t\t\treturn ctx.return(undefined);\n\t\t\t}\n\n\t\t\t// it's a sync request\n\t\t\t// sync xhr to service worker is not supported\n\t\t\t// there's a nice way of polyfilling this though, we can spin on an atomic using sharedarraybuffer. this will maintain the sync behavior\n\n\t\t\t//@ts-ignore\n\t\t\tconst sab = new SharedArrayBuffer(1024, { maxByteLength: 2147483647 });\n\t\t\tconst view = new DataView(sab);\n\n\t\t\tclient.natives.call(\"Worker.prototype.postMessage\", worker, {\n\t\t\t\tsab,\n\t\t\t\targs,\n\t\t\t\theaders: ctx.this[HEADERS],\n\t\t\t\tbody: ctx.args[0],\n\t\t\t});\n\n\t\t\tconst now = performance.now();\n\t\t\twhile (view.getUint8(0) === 0) {\n\t\t\t\tif (performance.now() - now > 1000) {\n\t\t\t\t\tthrow new Error(\"xhr timeout\");\n\t\t\t\t}\n\t\t\t\t/* spin */\n\t\t\t}\n\n\t\t\tconst status = view.getUint16(1);\n\t\t\tconst headersLength = view.getUint32(3);\n\n\t\t\tconst headersab = new Uint8Array(headersLength);\n\t\t\theadersab.set(new Uint8Array(sab.slice(7, 7 + headersLength)));\n\t\t\tconst headers = new TextDecoder().decode(headersab);\n\n\t\t\tconst bodyLength = view.getUint32(7 + headersLength);\n\t\t\tconst bodyab = new Uint8Array(bodyLength);\n\t\t\tbodyab.set(\n\t\t\t\tnew Uint8Array(\n\t\t\t\t\tsab.slice(11 + headersLength, 11 + headersLength + bodyLength)\n\t\t\t\t)\n\t\t\t);\n\t\t\tconst body = new TextDecoder().decode(bodyab);\n\n\t\t\t// these should be using proxies to not leak scram strings but who cares\n\t\t\tclient.RawTrap(ctx.this, \"status\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn status;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"responseText\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn body;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"response\", {\n\t\t\t\tget() {\n\t\t\t\t\tif (ctx.this.responseType === \"arraybuffer\") return bodyab.buffer;\n\n\t\t\t\t\treturn body;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"responseXML\", {\n\t\t\t\tget() {\n\t\t\t\t\tconst parser = new DOMParser();\n\n\t\t\t\t\treturn parser.parseFromString(body, \"text/xml\");\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"getAllResponseHeaders\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn () => headers;\n\t\t\t\t},\n\t\t\t});\n\t\t\tclient.RawTrap(ctx.this, \"getResponseHeader\", {\n\t\t\t\tget() {\n\t\t\t\t\treturn (header: string) => {\n\t\t\t\t\t\tconst re = new RegExp(`^${header}: (.*)$`, \"m\");\n\t\t\t\t\t\tconst match = re.exec(headers);\n\n\t\t\t\t\t\treturn match ? match[1] : null;\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t});\n\n\t\t\t// send has no return value right\n\t\t\tctx.return(undefined);\n\t\t},\n\t});\n\n\tclient.Trap(\"XMLHttpRequest.prototype.responseURL\", {\n\t\tget(ctx) {\n\t\t\treturn unrewriteUrl(ctx.get() as string);\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"../../scramjet\";\nimport { SCRAMJETCLIENT, SCRAMJETCLIENTNAME } from \"../../symbols\";\nimport { ProxyCtx, ScramjetClient } from \"../client\";\n\nenum RewriteType {\n\tInsert = 0,\n\tReplace = 1,\n}\n\ntype Rewrite = {\n\tstart: number;\n} & (\n\t| {\n\t\t\ttype: RewriteType.Insert;\n\t\t\tsize: number;\n\t  }\n\t| {\n\t\t\ttype: RewriteType.Replace;\n\t\t\tend: number;\n\t\t\tstr: string;\n\t  }\n);\n\nexport type SourceMaps = Record<string, Rewrite[]>;\n\nfunction getEnd(rewrite: Rewrite): number {\n\tif (rewrite.type === RewriteType.Insert) {\n\t\treturn rewrite.start + rewrite.size;\n\t} else if (rewrite.type === RewriteType.Replace) {\n\t\treturn rewrite.end;\n\t}\n\tthrow \"unreachable\";\n}\n\n// some sites like to steal funcs from frames and then unrewrite them\nfunction searchRewrites(tag: string): Rewrite[] | undefined {\n\tfunction searchFrame(globalThis: Self) {\n\t\tconst SCRAMJETCLIENT = globalThis.Symbol.for(SCRAMJETCLIENTNAME);\n\t\tif (\n\t\t\tglobalThis[SCRAMJETCLIENT] &&\n\t\t\tglobalThis[SCRAMJETCLIENT].sourcemaps &&\n\t\t\tglobalThis[SCRAMJETCLIENT].sourcemaps[tag]\n\t\t)\n\t\t\treturn globalThis[SCRAMJETCLIENT].sourcemaps[tag];\n\n\t\t// no enhanced for :frowning2:\n\t\tfor (let i = 0; i < globalThis.frames.length; i++) {\n\t\t\tconst rewrites = searchFrame(globalThis.frames[i].self);\n\t\t\tif (rewrites) return rewrites;\n\t\t}\n\t}\n\n\tlet globalThis = self;\n\tlet rewrites = searchFrame(globalThis);\n\tif (rewrites) return rewrites;\n\twhile (globalThis.parent && globalThis.parent !== globalThis.window) {\n\t\tglobalThis = globalThis.parent.self;\n\t\tlet rewrites = searchFrame(globalThis);\n\t\tif (rewrites) return rewrites;\n\t}\n}\n\nfunction registerRewrites(buf: Array<number>, tag: string) {\n\tconst sourcemap = Uint8Array.from(buf);\n\tconst view = new DataView(sourcemap.buffer);\n\tconst decoder = new TextDecoder(\"utf-8\");\n\n\tconst rewrites: Rewrite[] = [];\n\n\tconst rewritelen = view.getUint32(0, true);\n\tlet cursor = 4;\n\tfor (let i = 0; i < rewritelen; i++) {\n\t\tconst start = view.getUint32(cursor, true);\n\t\tcursor += 4;\n\t\tconst size = view.getUint32(cursor, true);\n\t\tcursor += 4;\n\n\t\tconst type = view.getUint8(cursor) as RewriteType;\n\t\tcursor += 1;\n\n\t\tif (type == RewriteType.Insert) {\n\t\t\trewrites.push({ type, start, size });\n\t\t} else if (type == RewriteType.Replace) {\n\t\t\tconst end = start + size;\n\n\t\t\tconst oldLen = view.getUint32(cursor, true);\n\t\t\tcursor += 4;\n\n\t\t\tconst oldStr = decoder.decode(\n\t\t\t\tsourcemap.subarray(cursor, cursor + oldLen)\n\t\t\t);\n\n\t\t\trewrites.push({ type, start, end, str: oldStr });\n\t\t}\n\t}\n\n\tself[SCRAMJETCLIENT].sourcemaps[tag] = rewrites;\n}\n\nconst SCRAMTAG = \"/*scramtag \";\n\nfunction extractTag(fn: string): [string, number, number] | null {\n\t// every function rewritten will have a scramtag comment\n\t// it will look like this:\n\t// function name()[possible whitespace]/*scramtag [index] [tag]*/[possible whitespace]{ ... }\n\n\tlet start = fn.indexOf(SCRAMTAG);\n\t// no scramtag, probably native function or stolen from scramjet\n\tif (start === -1) return null;\n\n\tconst end = fn.indexOf(\"*/\", start);\n\tif (end === -1) {\n\t\tconsole.log(fn, start, end);\n\t\tthrow new Error(\"unreachable\");\n\t}\n\n\tlet tag = fn.substring(start + 2, end).split(\" \");\n\n\tif (\n\t\ttag.length !== 3 ||\n\t\ttag[0] !== \"scramtag\" ||\n\t\t!Number.isSafeInteger(+tag[1])\n\t) {\n\t\tconsole.log(fn, start, end, tag);\n\t\tthrow new Error(\"invalid tag\");\n\t}\n\n\treturn [tag[2], start, +tag[1]];\n}\n\nfunction doUnrewrite(ctx: ProxyCtx) {\n\tlet stringified: string = ctx.fn.call(ctx.this);\n\n\tlet extracted = extractTag(stringified);\n\tif (!extracted) return ctx.return(stringified);\n\tlet [tag, tagOffset, tagStart] = extracted;\n\n\tlet fnStart = tagStart - tagOffset;\n\tlet fnEnd = fnStart + stringified.length;\n\tconst rewrites = searchRewrites(tag);\n\n\tif (!rewrites) {\n\t\tconsole.warn(\"failed to get rewrites for tag\", tag);\n\t\treturn ctx.return(stringified);\n\t}\n\n\tlet i = 0;\n\t// skip all rewrites in the file before the fn\n\twhile (i < rewrites.length) {\n\t\tif (rewrites[i].start < fnStart) i++;\n\t\telse break;\n\t}\n\n\tlet end = i;\n\twhile (end < rewrites.length) {\n\t\tif (getEnd(rewrites[end]) < fnEnd) end++;\n\t\telse break;\n\t}\n\tconst fnrewrites = rewrites.slice(i, end);\n\n\tlet newString = \"\";\n\tlet lastpos = 0;\n\n\tfor (const rewrite of fnrewrites) {\n\t\tnewString += stringified.slice(lastpos, rewrite.start - fnStart);\n\n\t\tif (rewrite.type === RewriteType.Insert) {\n\t\t\tlastpos = rewrite.start + rewrite.size - fnStart;\n\t\t} else if (rewrite.type === RewriteType.Replace) {\n\t\t\tnewString += rewrite.str;\n\t\t\tlastpos = rewrite.end - fnStart;\n\t\t} else {\n\t\t\tthrow \"unreachable\";\n\t\t}\n\t}\n\n\tnewString += stringified.slice(lastpos);\n\n\treturn ctx.return(newString);\n}\n\nexport const enabled = (client: ScramjetClient) =>\n\tflagEnabled(\"sourcemaps\", client.url);\n\nexport default function (client: ScramjetClient, self: Self) {\n\t// every script will push a sourcemap\n\tObject.defineProperty(\n\t\tself,\n\t\tglobalThis.$scramjet.config.globals.pushsourcemapfn,\n\t\t{\n\t\t\tvalue: (buf: Array<number>, tag: string) => {\n\t\t\t\tconst before = performance.now();\n\t\t\t\tregisterRewrites(buf, tag);\n\t\t\t\tdbg.time(client.meta, before, `scramtag parse for ${tag}`);\n\t\t\t},\n\t\t\tenumerable: false,\n\t\t\twritable: false,\n\t\t\tconfigurable: false,\n\t\t}\n\t);\n\n\t// when we rewrite javascript it will make function.toString leak internals\n\t// this can lead to double rewrites which is bad\n\tclient.Proxy(\"Function.prototype.toString\", {\n\t\tapply(ctx) {\n\t\t\tconst before = performance.now();\n\t\t\tdoUnrewrite(ctx);\n\t\t\t// dbg.time(client.meta, before, `scramtag unrewrite for ${ctx.fn.name}`);\n\t\t},\n\t});\n}\n","export default function (client, self) {\n\tdelete self.TrustedHTML;\n\tdelete self.TrustedScript;\n\tdelete self.TrustedScriptURL;\n\tdelete self.TrustedTypePolicy;\n\tdelete self.TrustedTypePolicyFactory;\n\tself.__defineGetter__(\"trustedTypes\", () => undefined);\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ProxyCtx, ScramjetClient } from \"../client\";\n\n// we don't want to end up overriding a property on window that's derived from a prototype until we've proxied the prototype\nexport const order = 3;\n\nexport default function (client: ScramjetClient, self: typeof window) {\n\t// an automated approach to cleaning the documentProxy from dom functions\n\t// it will trigger an illegal invocation if you pass the proxy to c++ code, we gotta hotswap it out with the real one\n\t// admittedly this is pretty slow. worth investigating if there's ways to get back some of the lost performance\n\n\tfor (const target of [self]) {\n\t\tfor (const prop in target) {\n\t\t\ttry {\n\t\t\t\tconst value = target[prop];\n\t\t\t\tif (typeof value === \"function\") {\n\t\t\t\t\tclient.RawProxy(target, prop, {\n\t\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\tif (!iswindow) return;\n\n\tfor (const target of [\n\t\tself.Node.prototype,\n\t\tself.MutationObserver.prototype,\n\t\tself.document,\n\t\tself.MouseEvent.prototype,\n\t\tself.Range.prototype,\n\t]) {\n\t\tfor (const prop in target) {\n\t\t\ttry {\n\t\t\t\tconst value = target[prop];\n\t\t\t\tif (typeof value === \"function\") {\n\t\t\t\t\tclient.RawProxy(target, prop, {\n\t\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch {}\n\t\t}\n\t}\n\n\tclient.Proxy(\"IntersectionObserver\", {\n\t\tconstruct(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t\tif (typeof ctx.args[1] === \"object\" && \"root\" in ctx.args[1])\n\t\t\t\tif (ctx.args[1].root === client.documentProxy)\n\t\t\t\t\tctx.args[1].root = self.document;\n\t\t},\n\t});\n\n\t// this is probably not how stuff should be done but you cant run defineProperty on the window proxy so...\n\tclient.Proxy(\"Object.defineProperty\", {\n\t\tapply(ctx) {\n\t\t\tunproxy(ctx, client);\n\t\t},\n\t});\n\n\tclient.Proxy(\"Object.getOwnPropertyDescriptor\", {\n\t\tapply(ctx) {\n\t\t\tconst desc = ctx.call();\n\n\t\t\tif (!desc) return;\n\n\t\t\tif (desc.get) {\n\t\t\t\tclient.RawProxy(desc, \"get\", {\n\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\t// value of this in the getter needs to be corrected\n\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (desc.set) {\n\t\t\t\tclient.RawProxy(desc, \"set\", {\n\t\t\t\t\tapply(ctx) {\n\t\t\t\t\t\tunproxy(ctx, client);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// i don't think we have to care about value but it's worth looking into\n\n\t\t\tctx.return(desc);\n\t\t},\n\t});\n\tclient.Proxy(\"Function.prototype.bind\", {\n\t\tapply(ctx) {\n\t\t\tif (\n\t\t\t\t(ctx.args[0] instanceof Window && ctx.args[0] !== client.globalProxy) ||\n\t\t\t\t(ctx.args[0] instanceof Document &&\n\t\t\t\t\tctx.args[0] !== client.documentProxy)\n\t\t\t) {\n\t\t\t\tconst client = ctx.args[0][SCRAMJETCLIENT];\n\t\t\t\tconsole.log(ctx.this);\n\t\t\t\tctx.this = new Proxy(ctx.this, {\n\t\t\t\t\tapply(target, that, args) {\n\t\t\t\t\t\tif (that === client.globalProxy) that = client.global;\n\t\t\t\t\t\tif (that === client.documentProxy) that = client.global.document;\n\n\t\t\t\t\t\tfor (const i in args) {\n\t\t\t\t\t\t\tif (args[i] === client.globalProxy) args[i] = client.global;\n\t\t\t\t\t\t\tif (args[i] === client.documentProxy)\n\t\t\t\t\t\t\t\targs[i] = client.global.document;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn Reflect.apply(target, that, args);\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t});\n}\n\nexport function unproxy(ctx: ProxyCtx, client: ScramjetClient) {\n\tconst self = client.global;\n\tif (ctx.this === client.globalProxy) ctx.this = self;\n\tif (ctx.this === client.documentProxy) ctx.this = self.document;\n\n\tfor (const i in ctx.args) {\n\t\tif (ctx.args[i] === client.globalProxy) ctx.args[i] = self;\n\t\tif (ctx.args[i] === client.documentProxy) ctx.args[i] = self.document;\n\t}\n}\n","import { BareMuxConnection } from \"../../shared\";\nimport { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient, _self: typeof globalThis) {\n\tclient.Proxy(\"Worker\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta) + \"?dest=worker\";\n\n\t\t\tif (ctx.args[1] && ctx.args[1].type === \"module\") {\n\t\t\t\tctx.args[0] += \"&type=module\";\n\t\t\t}\n\n\t\t\tconst worker = ctx.call();\n\t\t\tconst conn = new BareMuxConnection();\n\n\t\t\t(async () => {\n\t\t\t\tconst port = await conn.getInnerPort();\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"Worker.prototype.postMessage\",\n\t\t\t\t\tworker,\n\t\t\t\t\t{\n\t\t\t\t\t\t$scramjet$type: \"baremuxinit\",\n\t\t\t\t\t\tport,\n\t\t\t\t\t},\n\t\t\t\t\t[port]\n\t\t\t\t);\n\t\t\t})();\n\t\t},\n\t});\n\n\t// sharedworkers can only be constructed from window\n\tclient.Proxy(\"SharedWorker\", {\n\t\tconstruct(ctx) {\n\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta) + \"?dest=sharedworker\";\n\n\t\t\tif (ctx.args[1] && typeof ctx.args[1] === \"string\")\n\t\t\t\tctx.args[1] = `${client.url.origin}@${ctx.args[1]}`;\n\n\t\t\tif (ctx.args[1] && typeof ctx.args[1] === \"object\") {\n\t\t\t\tif (ctx.args[1].type === \"module\") {\n\t\t\t\t\tctx.args[0] += \"&type=module\";\n\t\t\t\t}\n\n\t\t\t\tif (ctx.args[1].name) {\n\t\t\t\t\tctx.args[1].name = `${client.url.origin}@${ctx.args[1].name}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst worker = ctx.call();\n\t\t\tconst conn = new BareMuxConnection();\n\n\t\t\t(async () => {\n\t\t\t\tconst port = await conn.getInnerPort();\n\t\t\t\tclient.natives.call(\n\t\t\t\t\t\"MessagePort.prototype.postMessage\",\n\t\t\t\t\tworker.port,\n\t\t\t\t\t{\n\t\t\t\t\t\t$scramjet$type: \"baremuxinit\",\n\t\t\t\t\t\tport,\n\t\t\t\t\t},\n\t\t\t\t\t[port]\n\t\t\t\t);\n\t\t\t})();\n\t\t},\n\t});\n\n\tclient.Proxy(\"Worklet.prototype.addModule\", {\n\t\tapply(ctx) {\n\t\t\tif (ctx.args[0])\n\t\t\t\tctx.args[0] = rewriteUrl(ctx.args[0], client.meta) + \"?dest=worklet\";\n\t\t},\n\t});\n}\n","import { iswindow } from \"..\";\nimport { SCRAMJETCLIENT } from \"../../symbols\";\nimport { ScramjetClient } from \"../client\";\nimport { config } from \"../../shared\";\n// import { argdbg } from \"./err\";\nimport { indirectEval } from \"./eval\";\n\nexport function createWrapFn(client: ScramjetClient, self: typeof globalThis) {\n\treturn function (identifier: any, strict: boolean) {\n\t\tif (identifier === self) return client.globalProxy;\n\t\tif (identifier === self.location) return client.locationProxy;\n\t\tif (identifier === eval) return indirectEval.bind(client, strict);\n\n\t\tif (iswindow) {\n\t\t\tif (identifier === self.parent) {\n\t\t\t\tif (SCRAMJETCLIENT in self.parent) {\n\t\t\t\t\t// ... then we're in a subframe, and the parent frame is also in a proxy context, so we should return its proxy\n\t\t\t\t\treturn self.parent[SCRAMJETCLIENT].globalProxy;\n\t\t\t\t} else {\n\t\t\t\t\t// ... then we should pretend we aren't nested and return the current window\n\t\t\t\t\treturn client.globalProxy;\n\t\t\t\t}\n\t\t\t} else if (identifier === self.document) {\n\t\t\t\treturn client.documentProxy;\n\t\t\t} else if (identifier === self.top) {\n\t\t\t\t// instead of returning top, we need to return the uppermost parent that's inside a scramjet context\n\t\t\t\tlet current = self;\n\n\t\t\t\tfor (;;) {\n\t\t\t\t\tconst test = current.parent.self;\n\t\t\t\t\tif (test === current) break; // there is no parent, actual or emulated.\n\n\t\t\t\t\t// ... then `test` represents a window outside of the proxy context, and therefore `current` is the topmost window in the proxy context\n\t\t\t\t\tif (!(SCRAMJETCLIENT in test)) break;\n\n\t\t\t\t\t// test is also insde a proxy, so we should continue up the chain\n\t\t\t\t\tcurrent = test;\n\t\t\t\t}\n\n\t\t\t\treturn current[SCRAMJETCLIENT].globalProxy;\n\t\t\t}\n\t\t}\n\n\t\treturn identifier;\n\t};\n}\n\nexport const order = 4;\nexport default function (client: ScramjetClient, self: typeof globalThis) {\n\t// the main magic of the proxy. all attempts to access any \"banned objects\" will be redirected here, and instead served a proxy object\n\t// this contrasts from how other proxies will leave the root object alone and instead attempt to catch every member access\n\t// this presents some issues (see element.ts), but makes us a good bit faster at runtime!\n\tObject.defineProperty(self, config.globals.wrapfn, {\n\t\tvalue: client.wrapfn,\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n\tObject.defineProperty(self, config.globals.wrapthisfn, {\n\t\tvalue: function (i) {\n\t\t\tif (i === self) return client.globalProxy;\n\n\t\t\treturn i;\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n\n\tself.$scramitize = function (v) {\n\t\tif (v === self) debugger;\n\t\tif (v === location) debugger;\n\t\tif (iswindow) {\n\t\t\tif (v === self.parent) debugger;\n\t\t\tif (v === self.document) debugger;\n\t\t\tif (v === self.top) debugger;\n\t\t}\n\n\t\tif (typeof v === \"string\" && v.includes(\"scramjet\")) debugger;\n\t\tif (typeof v === \"string\" && v.includes(location.origin)) debugger;\n\n\t\treturn v;\n\t};\n\n\t// location = \"...\" can't be rewritten as wrapfn(location) = ..., so instead it will actually be rewritten as\n\t// ((t)=>$scramjet$tryset(location,\"+=\",t)||location+=t)(...);\n\t// it has to be a discrete function because there's always the possibility that \"location\" is a local variable\n\t// we have to use an IIFE to avoid duplicating side-effects in the getter\n\tObject.defineProperty(self, config.globals.trysetfn, {\n\t\tvalue: function (lhs: any, op: string, rhs: any) {\n\t\t\tif (lhs instanceof Location) {\n\t\t\t\t// @ts-ignore\n\t\t\t\tlocationProxy.href = rhs;\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\t\twritable: false,\n\t\tconfigurable: false,\n\t});\n}\n","import { ScramjetClient } from \"./client\";\nimport { unrewriteUrl } from \"../shared\";\n\nexport class ScramjetServiceWorkerRuntime {\n\trecvport: MessagePort;\n\tconstructor(public client: ScramjetClient) {\n\t\t// @ts-ignore\n\t\tself.onconnect = (cevent: MessageEvent) => {\n\t\t\tconst port = cevent.ports[0];\n\t\t\tdbg.log(\"sw\", \"connected\");\n\n\t\t\tport.addEventListener(\"message\", (event) => {\n\t\t\t\tconsole.log(\"sw\", event.data);\n\t\t\t\tif (\"scramjet$type\" in event.data) {\n\t\t\t\t\tif (event.data.scramjet$type === \"init\") {\n\t\t\t\t\t\tthis.recvport = event.data.scramjet$port;\n\t\t\t\t\t\tthis.recvport.postMessage({ scramjet$type: \"init\" });\n\t\t\t\t\t} else {\n\t\t\t\t\t\thandleMessage.call(this, client, event.data);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tport.start();\n\t\t};\n\t}\n\n\thook() {\n\t\t// @ts-ignore\n\t\tthis.client.global.registration = {\n\t\t\t// TODO IMPLEMENT SCOPES\n\t\t\tscope: this.client.url.href,\n\t\t\tactive: {\n\t\t\t\tscriptURL: this.client.url.href,\n\t\t\t\tstate: \"activated\",\n\t\t\t\tonstatechange: null,\n\t\t\t\tonerror: null,\n\n\t\t\t\tpostMessage: () => {},\n\t\t\t\taddEventListener: () => {},\n\t\t\t\tremoveEventListener: () => {},\n\t\t\t\tdispatchEvent: (_e: Event): boolean => {\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t},\n\t\t\tshowNotification: async () => {},\n\t\t\tunregister: async () => true,\n\t\t\t//@ts-ignore\n\t\t\tupdate: async () => {},\n\t\t\tinstalling: null,\n\t\t\twaiting: null,\n\t\t};\n\n\t\t// @ts-ignore\n\t\tthis.client.global.ServiceWorkerGlobalScope = this.client.global;\n\t}\n}\n\nfunction handleMessage(\n\tthis: ScramjetServiceWorkerRuntime,\n\tclient: ScramjetClient,\n\tdata: MessageW2R\n) {\n\tconst port = this.recvport;\n\tconst type = data.scramjet$type;\n\tconst token = data.scramjet$token;\n\tconst handlers = client.eventcallbacks.get(self);\n\n\tif (type === \"fetch\") {\n\t\tdbg.log(\"ee\", data);\n\t\tconst fetchhandlers = handlers.filter((event) => event.event === \"fetch\");\n\t\tif (!fetchhandlers) return;\n\n\t\tfor (const handler of fetchhandlers) {\n\t\t\tconst request = data.scramjet$request;\n\n\t\t\tconst Request = client.natives[\"Request\"];\n\t\t\tconst fakeRequest = new Request(unrewriteUrl(request.url), {\n\t\t\t\tbody: request.body,\n\t\t\t\theaders: new Headers(request.headers),\n\t\t\t\tmethod: request.method,\n\t\t\t\tmode: \"same-origin\",\n\t\t\t});\n\n\t\t\tObject.defineProperty(fakeRequest, \"destination\", {\n\t\t\t\tvalue: request.destinitation,\n\t\t\t});\n\n\t\t\t// TODO: clean up, maybe put into a class\n\t\t\tconst fakeFetchEvent: any = new Event(\"fetch\");\n\t\t\tfakeFetchEvent.request = fakeRequest;\n\t\t\tlet responded = false;\n\t\t\tfakeFetchEvent.respondWith = (response: Response | Promise<Response>) => {\n\t\t\t\tresponded = true;\n\t\t\t\t(async () => {\n\t\t\t\t\tresponse = await response;\n\t\t\t\t\tconst message: MessageR2W = {\n\t\t\t\t\t\tscramjet$type: \"fetch\",\n\t\t\t\t\t\tscramjet$token: token,\n\t\t\t\t\t\tscramjet$response: {\n\t\t\t\t\t\t\tbody: response.body,\n\t\t\t\t\t\t\theaders: Array.from(response.headers.entries()),\n\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\n\t\t\t\t\tdbg.log(\"sw\", \"responding\", message);\n\t\t\t\t\tport.postMessage(message, [response.body]);\n\t\t\t\t})();\n\t\t\t};\n\n\t\t\tdbg.log(\"to fn\", fakeFetchEvent);\n\t\t\thandler.proxiedCallback(trustEvent(fakeFetchEvent));\n\t\t\tif (!responded) {\n\t\t\t\tconsole.log(\"sw\", \"no response\");\n\t\t\t\tport.postMessage({\n\t\t\t\t\tscramjet$type: \"fetch\",\n\t\t\t\t\tscramjet$token: token,\n\t\t\t\t\tscramjet$response: false,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction trustEvent(event: Event): Event {\n\treturn new Proxy(event, {\n\t\tget(target, prop, _reciever) {\n\t\t\tif (prop === \"isTrusted\") return true;\n\n\t\t\treturn Reflect.get(target, prop);\n\t\t},\n\t});\n}\n\nexport type TransferrableResponse = {\n\tbody: ReadableStream;\n\theaders: [string, string][];\n\tstatus: number;\n\tstatusText: string;\n};\n\nexport type TransferrableRequest = {\n\tbody: ReadableStream;\n\theaders: [string, string][];\n\tdestinitation: RequestDestination;\n\tmethod: Request[\"method\"];\n\tmode: Request[\"mode\"];\n\turl: string;\n};\n\ntype FetchResponseMessage = {\n\tscramjet$type: \"fetch\";\n\tscramjet$response: TransferrableResponse;\n};\n\ntype FetchRequestMessage = {\n\tscramjet$type: \"fetch\";\n\tscramjet$request: TransferrableRequest;\n};\n\n// r2w = runtime to (service) worker\n\ntype MessageTypeR2W = FetchResponseMessage;\ntype MessageTypeW2R = FetchRequestMessage;\n\ntype MessageCommon = {\n\tscramjet$type: string;\n\tscramjet$token: number;\n};\n\nexport type MessageR2W = MessageCommon & MessageTypeR2W;\nexport type MessageW2R = MessageCommon &\n\tMessageTypeW2R & { scramjet$port?: MessagePort };\n","import { rewriteUrl } from \"../../shared\";\nimport { ScramjetClient } from \"../client\";\n\nexport default function (client: ScramjetClient) {\n\tclient.Proxy(\"importScripts\", {\n\t\tapply(ctx) {\n\t\t\tfor (const i in ctx.args) {\n\t\t\t\tctx.args[i] = rewriteUrl(ctx.args[i], client.meta);\n\t\t\t}\n\t\t},\n\t});\n}\n","import { flagEnabled } from \"./scramjet\";\nimport type { URLMeta } from \"./shared/rewriters/url\";\n\nconst logfuncs = {\n\tlog: console.log,\n\twarn: console.warn,\n\terror: console.error,\n\tdebug: console.debug,\n\tinfo: console.info,\n};\n\nexport default {\n\tfmt: function (severity: string, message: string, ...args: any[]) {\n\t\tconst old = Error.prepareStackTrace;\n\n\t\tError.prepareStackTrace = (_, stack) => {\n\t\t\tstack.shift(); // stack();\n\t\t\tstack.shift(); // fmt();\n\t\t\tstack.shift();\n\n\t\t\tlet fmt = \"\";\n\t\t\tfor (let i = 1; i < Math.min(2, stack.length); i++) {\n\t\t\t\tif (stack[i].getFunctionName()) {\n\t\t\t\t\t// const f = stack[i].getThis()?.constructor?.name;\n\t\t\t\t\t// if (f) fmt += `${f}.`\n\t\t\t\t\tfmt += `${stack[i].getFunctionName()} -> ` + fmt;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfmt += stack[0].getFunctionName() || \"Anonymous\";\n\n\t\t\treturn fmt;\n\t\t};\n\n\t\tconst fmt = (function stack() {\n\t\t\ttry {\n\t\t\t\tthrow new Error();\n\t\t\t} catch (e) {\n\t\t\t\treturn e.stack;\n\t\t\t}\n\t\t})();\n\n\t\tError.prepareStackTrace = old;\n\n\t\tthis.print(severity, fmt, message, ...args);\n\t},\n\tprint(severity: string, tag: string, message: string, ...args: any[]) {\n\t\tconst fn = logfuncs[severity] || logfuncs.log;\n\t\tconst bg = {\n\t\t\tlog: \"#000\",\n\t\t\twarn: \"#f80\",\n\t\t\terror: \"#f00\",\n\t\t\tdebug: \"transparent\",\n\t\t}[severity];\n\t\tconst fg = {\n\t\t\tlog: \"#fff\",\n\t\t\twarn: \"#fff\",\n\t\t\terror: \"#fff\",\n\t\t\tdebug: \"gray\",\n\t\t}[severity];\n\t\tconst padding = {\n\t\t\tlog: 2,\n\t\t\twarn: 4,\n\t\t\terror: 4,\n\t\t\tdebug: 0,\n\t\t}[severity];\n\n\t\tfn(\n\t\t\t`%c${tag}%c ${message}`,\n\t\t\t`\n  \tbackground-color: ${bg};\n  \tcolor: ${fg};\n  \tpadding: ${padding}px;\n  \tfont-weight: bold;\n  \tfont-family: monospace;\n  \tfont-size: 0.9em;\n  `,\n\t\t\t`${severity === \"debug\" ? \"color: gray\" : \"\"}`,\n\t\t\t...args\n\t\t);\n\t},\n\tlog: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"log\", message, ...args);\n\t},\n\twarn: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"warn\", message, ...args);\n\t},\n\terror: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"error\", message, ...args);\n\t},\n\tdebug: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"debug\", message, ...args);\n\t},\n\ttime(meta: URLMeta, before: number, type: string) {\n\t\tif (!flagEnabled(\"rewriterLogs\", meta.base)) return;\n\t\tconst after = performance.now();\n\t\tconst duration = after - before;\n\n\t\tlet timespan: string;\n\t\tif (duration < 1) {\n\t\t\ttimespan = \"BLAZINGLY FAST\";\n\t\t} else if (duration < 500) {\n\t\t\ttimespan = \"decent speed\";\n\t\t} else {\n\t\t\ttimespan = \"really slow\";\n\t\t}\n\t\tthis.print(\n\t\t\t\"debug\",\n\t\t\t\"[time]\",\n\t\t\t`${type} was ${timespan} (${duration.toFixed(2)}ms)`\n\t\t);\n\t},\n};\n","import { ScramjetFlags } from \"./types\";\n\nif (!(\"$scramjet\" in self)) {\n\t// @ts-expect-error ts stuff\n\tself.$scramjet = {\n\t\tversion: {\n\t\t\tbuild: COMMITHASH,\n\t\t\tversion: VERSION,\n\t\t},\n\t\tcodec: {},\n\t\tflagEnabled,\n\t};\n}\n\nexport const $scramjet = self.$scramjet;\n\nconst nativeFunction = Function;\nexport function loadCodecs() {\n\t$scramjet.codec.encode = nativeFunction(\n\t\t`return ${$scramjet.config.codec.encode}`\n\t)() as any;\n\t$scramjet.codec.decode = nativeFunction(\n\t\t`return ${$scramjet.config.codec.decode}`\n\t)() as any;\n}\n\nexport function flagEnabled(flag: keyof ScramjetFlags, url: URL): boolean {\n\tconst value = $scramjet.config.flags[flag];\n\tfor (const regex in $scramjet.config.siteFlags) {\n\t\tconst partialflags = $scramjet.config.siteFlags[regex];\n\t\tif (new RegExp(regex).test(url.href) && flag in partialflags) {\n\t\t\treturn partialflags[flag];\n\t\t}\n\t}\n\n\treturn value;\n}\n","import { $scramjet } from \"./scramjet\";\n\nexport const {\n\tutil: { BareClient, ScramjetHeaders, BareMuxConnection },\n\turl: { rewriteUrl, unrewriteUrl, rewriteBlob, unrewriteBlob },\n\trewrite: {\n\t\trewriteCss,\n\t\tunrewriteCss,\n\t\trewriteHtml,\n\t\tunrewriteHtml,\n\t\trewriteSrcset,\n\t\trewriteJs,\n\t\trewriteHeaders,\n\t\trewriteWorkers,\n\t\thtmlRules,\n\t},\n\tCookieStore,\n} = $scramjet.shared;\n\nexport const config = $scramjet.config;\n","import { URLMeta } from \"./url\";\n\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\nimport { getRewriter, JsRewriterOutput } from \"./wasm\";\n\nError.stackTraceLimit = 50;\n\nconst decoder = new TextDecoder();\n\nfunction rewriteJsWasm(\n\tinput: string | Uint8Array,\n\tsource: string | null,\n\tmeta: URLMeta,\n\tmodule: boolean\n): { js: string | Uint8Array; map: Uint8Array | null; tag: string } {\n\tlet [rewriter, ret] = getRewriter(meta);\n\n\ttry {\n\t\tlet out: JsRewriterOutput;\n\t\tconst before = performance.now();\n\t\ttry {\n\t\t\tif (typeof input === \"string\") {\n\t\t\t\tout = rewriter.rewrite_js(\n\t\t\t\t\tinput,\n\t\t\t\t\tmeta.base.href,\n\t\t\t\t\tsource || \"(unknown)\",\n\t\t\t\t\tmodule\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tout = rewriter.rewrite_js_bytes(\n\t\t\t\t\tinput,\n\t\t\t\t\tmeta.base.href,\n\t\t\t\t\tsource || \"(unknown)\",\n\t\t\t\t\tmodule\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst err1 = err as Error;\n\t\t\tconsole.warn(\"failed rewriting js for\", source, err1.message, input);\n\n\t\t\treturn { js: input, tag: \"\", map: null };\n\t\t}\n\t\tdbg.time(meta, before, `oxc rewrite for \"${source || \"(unknown)\"}\"`);\n\n\t\tlet { js, map, scramtag, errors } = out;\n\n\t\tif (flagEnabled(\"sourcemaps\", meta.base) && !globalThis.clients) {\n\t\t\tglobalThis[globalThis.$scramjet.config.globals.pushsourcemapfn](\n\t\t\t\tArray.from(map),\n\t\t\t\tscramtag\n\t\t\t);\n\n\t\t\tmap = null;\n\t\t}\n\n\t\tif (flagEnabled(\"rewriterLogs\", meta.base)) {\n\t\t\tfor (const error of errors) {\n\t\t\t\tconsole.error(\"oxc parse error\", error);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tjs: typeof input === \"string\" ? decoder.decode(js) : js,\n\t\t\ttag: scramtag,\n\t\t\tmap,\n\t\t};\n\t} finally {\n\t\tret();\n\t}\n}\n\n// 1. does not work with modules\n// 2. cannot proxy import()\n// 3. disables \"use strict\" optimizations\n// 4. i think the global state can get clobbered somehow\n//\n// if you can ensure all the preconditions are met this is faster than full rewrites\nfunction rewriteJsNaiive(js: string | ArrayBuffer) {\n\tif (typeof js !== \"string\") {\n\t\tjs = new TextDecoder().decode(js);\n\t}\n\n\treturn `\n\t\twith (${$scramjet.config.globals.wrapfn}(globalThis)) {\n\n\t\t\t${js}\n\n\t\t}\n\t`;\n}\n\nfunction rewriteJsInner(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\tif (flagEnabled(\"naiiveRewriter\", meta.origin)) {\n\t\tconst text = typeof js === \"string\" ? js : new TextDecoder().decode(js);\n\t\tlet out: any = rewriteJsNaiive(text);\n\t\tif (typeof js === \"string\") out = out;\n\t\telse out = new TextEncoder().encode(out);\n\n\t\treturn { js: out, tag: \"\", map: null };\n\t}\n\n\treturn rewriteJsWasm(js, url, meta, module);\n}\n\nexport function rewriteJs(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module).js;\n}\n\nexport function rewriteJsWithMap(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module);\n}\n","import { $scramjet } from \"../../scramjet\";\nimport { rewriteJs } from \"./js\";\n\nexport type URLMeta = {\n\torigin: URL;\n\tbase: URL;\n\ttopFrameName?: string;\n\tparentFrameName?: string;\n};\n\nfunction tryCanParseURL(url: string, origin?: string | URL): URL | null {\n\ttry {\n\t\treturn new URL(url, origin);\n\t} catch {\n\t\treturn null;\n\t}\n}\n\nexport function rewriteBlob(url: string, meta: URLMeta) {\n\tconst blob = new URL(url.substring(\"blob:\".length));\n\n\treturn \"blob:\" + meta.origin.origin + blob.pathname;\n}\n\nexport function unrewriteBlob(url: string) {\n\tconst blob = new URL(url.substring(\"blob:\".length));\n\n\treturn \"blob:\" + location.origin + blob.pathname;\n}\n\nexport function rewriteUrl(url: string | URL, meta: URLMeta) {\n\tif (url instanceof URL) url = url.toString();\n\n\tif (url.startsWith(\"javascript:\")) {\n\t\treturn (\n\t\t\t\"javascript:\" +\n\t\t\trewriteJs(url.slice(\"javascript:\".length), \"(javascript: url)\", meta)\n\t\t);\n\t} else if (url.startsWith(\"blob:\")) {\n\t\treturn location.origin + $scramjet.config.prefix + url;\n\t} else if (url.startsWith(\"data:\")) {\n\t\treturn location.origin + $scramjet.config.prefix + url;\n\t} else if (url.startsWith(\"mailto:\") || url.startsWith(\"about:\")) {\n\t\treturn url;\n\t} else {\n\t\tlet base = meta.base.href;\n\n\t\tif (base.startsWith(\"about:\")) base = unrewriteUrl(self.location.href); // jank!!!!! weird jank!!!\n\t\tconst realUrl = tryCanParseURL(url, base);\n\t\tif (!realUrl) return url;\n\t\tconst encodedHash = $scramjet.codec.encode(realUrl.hash.slice(1));\n\t\tconst realHash = encodedHash ? \"#\" + encodedHash : \"\";\n\t\trealUrl.hash = \"\";\n\n\t\treturn (\n\t\t\tlocation.origin +\n\t\t\t$scramjet.config.prefix +\n\t\t\t$scramjet.codec.encode(realUrl.href) +\n\t\t\trealHash\n\t\t);\n\t}\n}\n\nexport function unrewriteUrl(url: string | URL) {\n\tif (url instanceof URL) url = url.toString();\n\t// remove query string\n\tif (url.includes(\"?\")) {\n\t\turl = url.split(\"?\")[0];\n\t}\n\n\tconst prefixed = location.origin + $scramjet.config.prefix;\n\n\tif (url.startsWith(\"javascript:\")) {\n\t\t//TODO\n\t\treturn url;\n\t} else if (url.startsWith(\"blob:\")) {\n\t\t// realistically this shouldn't happen\n\t\treturn url;\n\t} else if (url.startsWith(prefixed + \"blob:\")) {\n\t\treturn url.substring(prefixed.length);\n\t} else if (url.startsWith(prefixed + \"data:\")) {\n\t\treturn url.substring(prefixed.length);\n\t} else if (url.startsWith(\"mailto:\") || url.startsWith(\"about:\")) {\n\t\treturn url;\n\t} else {\n\t\tconst realUrl = tryCanParseURL(url);\n\t\tif (!realUrl) return url;\n\t\tconst decodedHash = $scramjet.codec.decode(realUrl.hash.slice(1));\n\t\tconst realHash = decodedHash ? \"#\" + decodedHash : \"\";\n\t\trealUrl.hash = \"\";\n\n\t\treturn $scramjet.codec.decode(\n\t\t\trealUrl.href.slice(prefixed.length) + realHash\n\t\t);\n\t}\n}\n","// i am a cat. i like to be petted. i like to be fed. i like to be\nimport { initSync, Rewriter } from \"../../../rewriter/wasm/out/wasm.js\";\nimport type { JsRewriterOutput } from \"../../../rewriter/wasm/out/wasm.js\";\n\nexport type { JsRewriterOutput, Rewriter };\n\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\nimport { URLMeta } from \"./url.js\";\n\nif (self.WASM)\n\tself.REAL_WASM = Uint8Array.from(atob(self.WASM), (c) => c.charCodeAt(0));\n\n// only use in sw\nexport async function asyncSetWasm() {\n\tconst buf = await fetch($scramjet.config.files.wasm).then((r) =>\n\t\tr.arrayBuffer()\n\t);\n\tself.REAL_WASM = new Uint8Array(buf);\n}\n\nconst decoder = new TextDecoder();\nlet MAGIC = \"\\0asm\".split(\"\").map((x) => x.charCodeAt(0));\n\nfunction initWasm() {\n\tif (!(self.REAL_WASM && self.REAL_WASM instanceof Uint8Array))\n\t\tthrow new Error(\"rewriter wasm not found (was it fetched correctly?)\");\n\n\tif (![...self.REAL_WASM.slice(0, 4)].every((x, i) => x === MAGIC[i]))\n\t\tthrow new Error(\n\t\t\t\"rewriter wasm does not have wasm magic (was it fetched correctly?)\\nrewriter wasm contents: \" +\n\t\t\t\tdecoder.decode(self.REAL_WASM)\n\t\t);\n\n\tinitSync({\n\t\tmodule: new WebAssembly.Module(self.REAL_WASM),\n\t});\n}\n\nexport function getRewriter(meta: URLMeta): [Rewriter, () => void] {\n\tinitWasm();\n\tif (!$scramjet.shared.rewriter) $scramjet.shared.rewriter = [];\n\n\tlet obj: { rewriter: Rewriter; inUse: boolean };\n\tlet index = $scramjet.shared.rewriter.findIndex((x) => !x.inUse);\n\tlet len = $scramjet.shared.rewriter.length;\n\n\tif (index === -1) {\n\t\tif (flagEnabled(\"rewriterLogs\", meta.base))\n\t\t\tconsole.log(`creating new rewriter, ${len} rewriters made already`);\n\n\t\tlet rewriter = new Rewriter($scramjet);\n\t\tobj = { rewriter, inUse: false };\n\t\t$scramjet.shared.rewriter.push(obj);\n\t} else {\n\t\tif (flagEnabled(\"rewriterLogs\", meta.base))\n\t\t\tconsole.log(\n\t\t\t\t`using cached rewriter ${index} from list of ${len} rewriters`\n\t\t\t);\n\n\t\tobj = $scramjet.shared.rewriter[index];\n\t}\n\tobj.inUse = true;\n\treturn [obj.rewriter, () => (obj.inUse = false)];\n}\n","// see types.d.ts for what these mean\nexport const SCRAMJETCLIENTNAME = \"scramjet client global\";\nexport const SCRAMJETCLIENT = Symbol.for(SCRAMJETCLIENTNAME);\nexport const SCRAMJETFRAME = Symbol.for(\"scramjet frame handle\");\n","\nexport function setMeta(meta, val) {\n\tmeta.base = new URL(val, meta.origin);\n}\nexport function base64(bytes) {\n\tconst binString = Array.from(bytes, (byte) =>\n\t\tString.fromCodePoint(byte)\n\t).join(\"\");\n\n\treturn btoa(binString);\n}\nexport function rewriteJsAttr(fn, attr, code, meta) {\n\treturn fn(code, `(inline ${attr} on element)`, meta);\n}\nexport function rewriteJsInline(fn, code, module, meta) {\n\treturn fn(code, `(inline script element)`, meta, module);\n}\nexport function rewriteCss(fn, code, meta) {\n\treturn fn(code, meta);\n}\nexport function rewriteHttpEquiv(fn, content, meta) {\n\tconst contentArray = content.split(\"url=\");\n\tif (contentArray[1])\n\t\tcontentArray[1] = fn(contentArray[1].trim(), meta);\n\treturn contentArray.join(\"url=\");\n}\nexport function log(val) { console.log(\"aaaaa\", val) }\n","\nexport function scramtag() {\n    return (\"\"+1e10).replace(/[018]/g,\n      c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n","import { base64, log, rewriteCss, rewriteHttpEquiv, rewriteJsAttr, rewriteJsInline, setMeta } from './snippets/wasm-4b0f351a8e6eeb46/inline0.js';\nimport { scramtag } from './snippets/wasm-4b0f351a8e6eeb46/inline1.js';\n\nlet wasm;\n\nlet WASM_VECTOR_LEN = 0;\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nconst cachedTextEncoder = (typeof TextEncoder !== 'undefined' ? new TextEncoder('utf-8') : { encode: () => { throw Error('TextEncoder not available') } } );\n\nconst encodeString = (typeof cachedTextEncoder.encodeInto === 'function'\n    ? function (arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n}\n    : function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n});\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || (cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer)) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nfunction addToExternrefTable0(obj) {\n    const idx = wasm.__externref_table_alloc();\n    wasm.__wbindgen_export_4.set(idx, obj);\n    return idx;\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        const idx = addToExternrefTable0(e);\n        wasm.__wbindgen_exn_store(idx);\n    }\n}\n\nconst cachedTextDecoder = (typeof TextDecoder !== 'undefined' ? new TextDecoder('utf-8', { ignoreBOM: true, fatal: true }) : { decode: () => { throw Error('TextDecoder not available') } } );\n\nif (typeof TextDecoder !== 'undefined') { cachedTextDecoder.decode(); };\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\n\nfunction isLikeNone(x) {\n    return x === undefined || x === null;\n}\n\nfunction takeFromExternrefTable0(idx) {\n    const value = wasm.__wbindgen_export_4.get(idx);\n    wasm.__externref_table_dealloc(idx);\n    return value;\n}\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nconst RewriterFinalization = (typeof FinalizationRegistry === 'undefined')\n    ? { register: () => {}, unregister: () => {} }\n    : new FinalizationRegistry(ptr => wasm.__wbg_rewriter_free(ptr >>> 0, 1));\n\nexport class Rewriter {\n\n    __destroy_into_raw() {\n        const ptr = this.__wbg_ptr;\n        this.__wbg_ptr = 0;\n        RewriterFinalization.unregister(this);\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_rewriter_free(ptr, 0);\n    }\n    /**\n     * @param {object} scramjet\n     */\n    constructor(scramjet) {\n        const ret = wasm.rewriter_new(scramjet);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        this.__wbg_ptr = ret[0] >>> 0;\n        RewriterFinalization.register(this, this.__wbg_ptr, this);\n        return this;\n    }\n    /**\n     * @param {string} js\n     * @param {string} base\n     * @param {string} url\n     * @param {boolean} module\n     * @returns {JsRewriterOutput}\n     */\n    rewrite_js(js, base, url, module) {\n        const ptr0 = passStringToWasm0(js, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ptr1 = passStringToWasm0(base, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        const ptr2 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len2 = WASM_VECTOR_LEN;\n        const ret = wasm.rewriter_rewrite_js(this.__wbg_ptr, ptr0, len0, ptr1, len1, ptr2, len2, module);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        return takeFromExternrefTable0(ret[0]);\n    }\n    /**\n     * @param {Uint8Array} js\n     * @param {string} base\n     * @param {string} url\n     * @param {boolean} module\n     * @returns {JsRewriterOutput}\n     */\n    rewrite_js_bytes(js, base, url, module) {\n        const ptr0 = passArray8ToWasm0(js, wasm.__wbindgen_malloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ptr1 = passStringToWasm0(base, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        const ptr2 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len2 = WASM_VECTOR_LEN;\n        const ret = wasm.rewriter_rewrite_js_bytes(this.__wbg_ptr, ptr0, len0, ptr1, len1, ptr2, len2, module);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        return takeFromExternrefTable0(ret[0]);\n    }\n    /**\n     * @param {string} html\n     * @param {object} meta\n     * @param {object} cookie\n     * @returns {HtmlRewriterOutput}\n     */\n    rewrite_html(html, meta, cookie) {\n        const ptr0 = passStringToWasm0(html, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.rewriter_rewrite_html(this.__wbg_ptr, ptr0, len0, meta, cookie);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        return takeFromExternrefTable0(ret[0]);\n    }\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_base64_115e27e69612f6f9 = function(arg0, arg1) {\n        const ret = base64(arg1);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_buffer_609cc3eee51ed158 = function(arg0) {\n        const ret = arg0.buffer;\n        return ret;\n    };\n    imports.wbg.__wbg_call_7cccdd69e0791ae2 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = arg0.call(arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_833bed5770ea2041 = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = arg0.call(arg1, arg2, arg3);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_b8adc8b1d0a0d8eb = function() { return handleError(function (arg0, arg1, arg2, arg3, arg4) {\n        const ret = arg0.call(arg1, arg2, arg3, arg4);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_entries_3265d4158b33e5dc = function(arg0) {\n        const ret = Object.entries(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_get_67b2ba62fc30de12 = function() { return handleError(function (arg0, arg1) {\n        const ret = Reflect.get(arg0, arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_get_b9b93047fe3cf45b = function(arg0, arg1) {\n        const ret = arg0[arg1 >>> 0];\n        return ret;\n    };\n    imports.wbg.__wbg_isArray_a1eab7e0d067391b = function(arg0) {\n        const ret = Array.isArray(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_length_e2d2a49132c1b256 = function(arg0) {\n        const ret = arg0.length;\n        return ret;\n    };\n    imports.wbg.__wbg_log_2f70bc68044d6f60 = function(arg0, arg1) {\n        log(getStringFromWasm0(arg0, arg1));\n    };\n    imports.wbg.__wbg_new_405e22f390576ce2 = function() {\n        const ret = new Object();\n        return ret;\n    };\n    imports.wbg.__wbg_new_78feb108b6472713 = function() {\n        const ret = new Array();\n        return ret;\n    };\n    imports.wbg.__wbg_new_9ffbe0a71eff35e3 = function() { return handleError(function (arg0, arg1) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_new_a12002a7f91c75be = function(arg0) {\n        const ret = new Uint8Array(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_newwithbase_161c299e7a34e2eb = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1), getStringFromWasm0(arg2, arg3));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function(arg0, arg1, arg2) {\n        const ret = new Uint8Array(arg0, arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_rewriteCss_9baf28b92206542e = function(arg0, arg1, arg2, arg3, arg4) {\n        const ret = rewriteCss(arg1, getStringFromWasm0(arg2, arg3), arg4);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_rewriteHttpEquiv_36d627bb1aa1662f = function(arg0, arg1, arg2, arg3, arg4) {\n        const ret = rewriteHttpEquiv(arg1, getStringFromWasm0(arg2, arg3), arg4);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_rewriteJsAttr_0a16ff7c17c72f0f = function(arg0, arg1, arg2, arg3, arg4, arg5, arg6) {\n        const ret = rewriteJsAttr(arg1, getStringFromWasm0(arg2, arg3), getStringFromWasm0(arg4, arg5), arg6);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_rewriteJsInline_8094bffe5a91c442 = function(arg0, arg1, arg2, arg3, arg4, arg5) {\n        const ret = rewriteJsInline(arg1, getStringFromWasm0(arg2, arg3), arg4 !== 0, arg5);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_scramtag_3a255d78b157986d = function(arg0) {\n        const ret = scramtag();\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_setMeta_159129a766e5aee1 = function(arg0, arg1, arg2) {\n        setMeta(arg0, getStringFromWasm0(arg1, arg2));\n    };\n    imports.wbg.__wbg_set_bb8cecf6a62b9f46 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = Reflect.set(arg0, arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_toString_5285597960676b7b = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbg_toString_c813bbd34d063839 = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbindgen_boolean_get = function(arg0) {\n        const v = arg0;\n        const ret = typeof(v) === 'boolean' ? (v ? 1 : 0) : 2;\n        return ret;\n    };\n    imports.wbg.__wbindgen_error_new = function(arg0, arg1) {\n        const ret = new Error(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_4;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n    imports.wbg.__wbindgen_is_function = function(arg0) {\n        const ret = typeof(arg0) === 'function';\n        return ret;\n    };\n    imports.wbg.__wbindgen_memory = function() {\n        const ret = wasm.memory;\n        return ret;\n    };\n    imports.wbg.__wbindgen_string_get = function(arg0, arg1) {\n        const obj = arg1;\n        const ret = typeof(obj) === 'string' ? obj : undefined;\n        var ptr1 = isLikeNone(ret) ? 0 : passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbindgen_string_new = function(arg0, arg1) {\n        const ret = getStringFromWasm0(arg0, arg1);\n        return ret;\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n\n}\n\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\n\n    wasm.__wbindgen_start();\n    return wasm;\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('wasm_bg.wasm', \"\");\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync };\nexport default __wbg_init;\n","__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["Error","Object","ScramjetClient","CookieStore","Map","global","SCRAMJETCLIENT","console","iswindow","BareClient","Promise","resolve","addEventListener","data","createDocumentProxy","createLocationProxy","createGlobalProxy","createWrapFn","Proxy","target","prop","split","realProp","realTarget","a","b","original","Reflect","args","that","nativeGetOwnPropertyDescriptor","value","client","base","url","frag","undefined","URL","currentWin","frame","curclient","parentWin","parentClient","sframe","SCRAMJETFRAME","currentwin","currentFrame","currentclient","cookiestr","context","modules","key","module","aorder","unrewriteUrl","ev","NavigateEvent","rewriteUrl","name","handler","Array","n","h","constructor","newTarget","returnValue","earlyreturn","ctx","r","fn","pst","err","s","location","config","getOwnPropertyDescriptorHandler","descriptor","oldDescriptor","v","desc","self","newValue","_self","map","proxy","_receiver","namespace","NamedNodeMap","isNaN","Number","keys","msg","controller","rewriteCss","unrewriteCss","style","CSSStyleDeclaration","rewriteHtml","encoder","TextEncoder","attrObject","urlinterfaces","originalhrefs","attr","element","i","href","node","Document","attrib","cleaned","attrNames","ruleList","htmlRules","rule","_ctx","_namespace","newval","rewriteJs","btoa","byte","String","scriptSource","atob","unrewriteHtml","realwin","newclient","doc","scram","UrlChangeEvent","f","win","order","enabled","flagEnabled","disabled","_client","Navigator","registrationmap","WeakMap","registration","fakeRegistration","EventTarget","handle","worker","state","index","realLocalStorage","property","attributes","localStorageProxy","sessionStorageProxy","Event","ScramjetContextEvent","window","UNSAFE_GLOBALS","Window","isworker","issw","isdedicated","isshared","isemulatedsw","dbg","loadCodecs","Math","runtime","ScramjetServiceWorkerRuntime","contextev","urlchangeev","document","Location","fakeLocation","descriptorSource","native","nativeFunction","log","_v","rewriteBlob","unrewriteBlob","argdbg","arg","recurse","Symbol","ar","e","t","closure","error","stack","newstack","lines","line","l","_value","js","indirectEval","strict","indirection","Function","realOnEvent","handlers","wraplistener","listener","realEvent","type","reciever","unproxy","origlistener","proxylistener","arr","targets","rewriteFunction","stringifiedFunction","content","resolved","rootPromise","root","directory","POLLUTANT","callerClient","callerGlobalThisProxied","wrappedPostMessage","toproxy","pollution","socketmap","socketstreammap","fakeWebSocket","barews","fakeEventSend","fakeev","CloseEvent","payload","Blob","ArrayBuffer","MessageEvent","ws","openResolver","closeResolver","openRejector","reject","ReadableStream","WritableStream","chunk","ARGS","HEADERS","headers","sab","SharedArrayBuffer","view","DataView","now","performance","status","headersLength","headersab","Uint8Array","TextDecoder","bodyLength","bodyab","body","parser","DOMParser","header","match","re","RegExp","self1","globalThis","buf","tag","before","registerRewrites","sourcemap","decoder","rewrites","rewritelen","cursor","start","size","end","oldLen","oldStr","doUnrewrite","stringified","extracted","extractTag","tagOffset","tagStart","fnStart","fnEnd","searchRewrites","searchFrame","globalThis1","SCRAMJETCLIENTNAME","getEnd","rewrite","fnrewrites","newString","lastpos","conn","BareMuxConnection","port","identifier","eval","current","test","lhs","op","rhs","locationProxy","cevent","event","handleMessage","_e","token","fetchhandlers","request","fakeRequest","Headers","fakeFetchEvent","responded","response","message","_reciever","logfuncs","severity","old","_","fmt","meta","timespan","duration","after","COMMITHASH","VERSION","$scramjet","flag","regex","partialflags","ScramjetHeaders","rewriteSrcset","rewriteHeaders","rewriteWorkers","rewriteJsInner","out","rewriteJsWasm","input","source","rewriter","ret","getRewriter","err1","scramtag","errors","tryCanParseURL","origin","prefixed","realUrl","decodedHash","encodedHash","c","MAGIC","x","obj","initSync","WebAssembly","len","Rewriter","crypto","FinalizationRegistry","p","Response","arguments","Request","fetch"],"mappings":"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"}