{"version":3,"file":"scramjet.worker.js","sources":["webpack://@mercuryworkshop/scramjet/./src/log.ts","webpack://@mercuryworkshop/scramjet/./src/scramjet.ts","webpack://@mercuryworkshop/scramjet/./src/shared.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/js.ts","webpack://@mercuryworkshop/scramjet/./src/shared/rewriters/wasm.ts","webpack://@mercuryworkshop/scramjet/./src/shared/security/forceReferrer.ts","webpack://@mercuryworkshop/scramjet/./src/shared/security/siteTests.ts","webpack://@mercuryworkshop/scramjet/./src/worker/error.ts","webpack://@mercuryworkshop/scramjet/./src/worker/fakesw.ts","webpack://@mercuryworkshop/scramjet/./src/worker/fetch.ts","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/snippets/wasm-4b0f351a8e6eeb46/inline0.js","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/snippets/wasm-4b0f351a8e6eeb46/inline1.js","webpack://@mercuryworkshop/scramjet/./rewriter/wasm/out/wasm.js","webpack://@mercuryworkshop/scramjet/webpack/runtime/define_property_getters","webpack://@mercuryworkshop/scramjet/webpack/runtime/has_own_property","webpack://@mercuryworkshop/scramjet/./src/worker/index.ts"],"sourcesContent":["import { flagEnabled } from \"./scramjet\";\nimport type { URLMeta } from \"./shared/rewriters/url\";\n\nconst logfuncs = {\n\tlog: console.log,\n\twarn: console.warn,\n\terror: console.error,\n\tdebug: console.debug,\n\tinfo: console.info,\n};\n\nexport default {\n\tfmt: function (severity: string, message: string, ...args: any[]) {\n\t\tconst old = Error.prepareStackTrace;\n\n\t\tError.prepareStackTrace = (_, stack) => {\n\t\t\tstack.shift(); // stack();\n\t\t\tstack.shift(); // fmt();\n\t\t\tstack.shift();\n\n\t\t\tlet fmt = \"\";\n\t\t\tfor (let i = 1; i < Math.min(2, stack.length); i++) {\n\t\t\t\tif (stack[i].getFunctionName()) {\n\t\t\t\t\t// const f = stack[i].getThis()?.constructor?.name;\n\t\t\t\t\t// if (f) fmt += `${f}.`\n\t\t\t\t\tfmt += `${stack[i].getFunctionName()} -> ` + fmt;\n\t\t\t\t}\n\t\t\t}\n\t\t\tfmt += stack[0].getFunctionName() || \"Anonymous\";\n\n\t\t\treturn fmt;\n\t\t};\n\n\t\tconst fmt = (function stack() {\n\t\t\ttry {\n\t\t\t\tthrow new Error();\n\t\t\t} catch (e) {\n\t\t\t\treturn e.stack;\n\t\t\t}\n\t\t})();\n\n\t\tError.prepareStackTrace = old;\n\n\t\tthis.print(severity, fmt, message, ...args);\n\t},\n\tprint(severity: string, tag: string, message: string, ...args: any[]) {\n\t\tconst fn = logfuncs[severity] || logfuncs.log;\n\t\tconst bg = {\n\t\t\tlog: \"#000\",\n\t\t\twarn: \"#f80\",\n\t\t\terror: \"#f00\",\n\t\t\tdebug: \"transparent\",\n\t\t}[severity];\n\t\tconst fg = {\n\t\t\tlog: \"#fff\",\n\t\t\twarn: \"#fff\",\n\t\t\terror: \"#fff\",\n\t\t\tdebug: \"gray\",\n\t\t}[severity];\n\t\tconst padding = {\n\t\t\tlog: 2,\n\t\t\twarn: 4,\n\t\t\terror: 4,\n\t\t\tdebug: 0,\n\t\t}[severity];\n\n\t\tfn(\n\t\t\t`%c${tag}%c ${message}`,\n\t\t\t`\n  \tbackground-color: ${bg};\n  \tcolor: ${fg};\n  \tpadding: ${padding}px;\n  \tfont-weight: bold;\n  \tfont-family: monospace;\n  \tfont-size: 0.9em;\n  `,\n\t\t\t`${severity === \"debug\" ? \"color: gray\" : \"\"}`,\n\t\t\t...args\n\t\t);\n\t},\n\tlog: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"log\", message, ...args);\n\t},\n\twarn: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"warn\", message, ...args);\n\t},\n\terror: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"error\", message, ...args);\n\t},\n\tdebug: function (message: string, ...args: any[]) {\n\t\tthis.fmt(\"debug\", message, ...args);\n\t},\n\ttime(meta: URLMeta, before: number, type: string) {\n\t\tif (!flagEnabled(\"rewriterLogs\", meta.base)) return;\n\t\tconst after = performance.now();\n\t\tconst duration = after - before;\n\n\t\tlet timespan: string;\n\t\tif (duration < 1) {\n\t\t\ttimespan = \"BLAZINGLY FAST\";\n\t\t} else if (duration < 500) {\n\t\t\ttimespan = \"decent speed\";\n\t\t} else {\n\t\t\ttimespan = \"really slow\";\n\t\t}\n\t\tthis.print(\n\t\t\t\"debug\",\n\t\t\t\"[time]\",\n\t\t\t`${type} was ${timespan} (${duration.toFixed(2)}ms)`\n\t\t);\n\t},\n};\n","import { ScramjetFlags } from \"./types\";\n\nif (!(\"$scramjet\" in self)) {\n\t// @ts-expect-error ts stuff\n\tself.$scramjet = {\n\t\tversion: {\n\t\t\tbuild: COMMITHASH,\n\t\t\tversion: VERSION,\n\t\t},\n\t\tcodec: {},\n\t\tflagEnabled,\n\t};\n}\n\nexport const $scramjet = self.$scramjet;\n\nconst nativeFunction = Function;\nexport function loadCodecs() {\n\t$scramjet.codec.encode = nativeFunction(\n\t\t`return ${$scramjet.config.codec.encode}`\n\t)() as any;\n\t$scramjet.codec.decode = nativeFunction(\n\t\t`return ${$scramjet.config.codec.decode}`\n\t)() as any;\n}\n\nexport function flagEnabled(flag: keyof ScramjetFlags, url: URL): boolean {\n\tconst value = $scramjet.config.flags[flag];\n\tfor (const regex in $scramjet.config.siteFlags) {\n\t\tconst partialflags = $scramjet.config.siteFlags[regex];\n\t\tif (new RegExp(regex).test(url.href) && flag in partialflags) {\n\t\t\treturn partialflags[flag];\n\t\t}\n\t}\n\n\treturn value;\n}\n","import { $scramjet } from \"./scramjet\";\n\nexport const {\n\tutil: { BareClient, ScramjetHeaders, BareMuxConnection },\n\turl: { rewriteUrl, unrewriteUrl, rewriteBlob, unrewriteBlob },\n\trewrite: {\n\t\trewriteCss,\n\t\tunrewriteCss,\n\t\trewriteHtml,\n\t\tunrewriteHtml,\n\t\trewriteSrcset,\n\t\trewriteJs,\n\t\trewriteHeaders,\n\t\trewriteWorkers,\n\t\thtmlRules,\n\t},\n\tCookieStore,\n} = $scramjet.shared;\n\nexport const config = $scramjet.config;\n","import { URLMeta } from \"./url\";\n\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\nimport { getRewriter, JsRewriterOutput } from \"./wasm\";\n\nError.stackTraceLimit = 50;\n\nconst decoder = new TextDecoder();\n\nfunction rewriteJsWasm(\n\tinput: string | Uint8Array,\n\tsource: string | null,\n\tmeta: URLMeta,\n\tmodule: boolean\n): { js: string | Uint8Array; map: Uint8Array | null; tag: string } {\n\tlet [rewriter, ret] = getRewriter(meta);\n\n\ttry {\n\t\tlet out: JsRewriterOutput;\n\t\tconst before = performance.now();\n\t\ttry {\n\t\t\tif (typeof input === \"string\") {\n\t\t\t\tout = rewriter.rewrite_js(\n\t\t\t\t\tinput,\n\t\t\t\t\tmeta.base.href,\n\t\t\t\t\tsource || \"(unknown)\",\n\t\t\t\t\tmodule\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tout = rewriter.rewrite_js_bytes(\n\t\t\t\t\tinput,\n\t\t\t\t\tmeta.base.href,\n\t\t\t\t\tsource || \"(unknown)\",\n\t\t\t\t\tmodule\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconst err1 = err as Error;\n\t\t\tconsole.warn(\"failed rewriting js for\", source, err1.message, input);\n\n\t\t\treturn { js: input, tag: \"\", map: null };\n\t\t}\n\t\tdbg.time(meta, before, `oxc rewrite for \"${source || \"(unknown)\"}\"`);\n\n\t\tlet { js, map, scramtag, errors } = out;\n\n\t\tif (flagEnabled(\"sourcemaps\", meta.base) && !globalThis.clients) {\n\t\t\tglobalThis[globalThis.$scramjet.config.globals.pushsourcemapfn](\n\t\t\t\tArray.from(map),\n\t\t\t\tscramtag\n\t\t\t);\n\n\t\t\tmap = null;\n\t\t}\n\n\t\tif (flagEnabled(\"rewriterLogs\", meta.base)) {\n\t\t\tfor (const error of errors) {\n\t\t\t\tconsole.error(\"oxc parse error\", error);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tjs: typeof input === \"string\" ? decoder.decode(js) : js,\n\t\t\ttag: scramtag,\n\t\t\tmap,\n\t\t};\n\t} finally {\n\t\tret();\n\t}\n}\n\n// 1. does not work with modules\n// 2. cannot proxy import()\n// 3. disables \"use strict\" optimizations\n// 4. i think the global state can get clobbered somehow\n//\n// if you can ensure all the preconditions are met this is faster than full rewrites\nfunction rewriteJsNaiive(js: string | ArrayBuffer) {\n\tif (typeof js !== \"string\") {\n\t\tjs = new TextDecoder().decode(js);\n\t}\n\n\treturn `\n\t\twith (${$scramjet.config.globals.wrapfn}(globalThis)) {\n\n\t\t\t${js}\n\n\t\t}\n\t`;\n}\n\nfunction rewriteJsInner(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\tif (flagEnabled(\"naiiveRewriter\", meta.origin)) {\n\t\tconst text = typeof js === \"string\" ? js : new TextDecoder().decode(js);\n\t\tlet out: any = rewriteJsNaiive(text);\n\t\tif (typeof js === \"string\") out = out;\n\t\telse out = new TextEncoder().encode(out);\n\n\t\treturn { js: out, tag: \"\", map: null };\n\t}\n\n\treturn rewriteJsWasm(js, url, meta, module);\n}\n\nexport function rewriteJs(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module).js;\n}\n\nexport function rewriteJsWithMap(\n\tjs: string | Uint8Array,\n\turl: string | null,\n\tmeta: URLMeta,\n\tmodule = false\n) {\n\treturn rewriteJsInner(js, url, meta, module);\n}\n","// i am a cat. i like to be petted. i like to be fed. i like to be\nimport { initSync, Rewriter } from \"../../../rewriter/wasm/out/wasm.js\";\nimport type { JsRewriterOutput } from \"../../../rewriter/wasm/out/wasm.js\";\n\nexport type { JsRewriterOutput, Rewriter };\n\nimport { $scramjet, flagEnabled } from \"../../scramjet\";\nimport { URLMeta } from \"./url.js\";\n\nif (self.WASM)\n\tself.REAL_WASM = Uint8Array.from(atob(self.WASM), (c) => c.charCodeAt(0));\n\n// only use in sw\nexport async function asyncSetWasm() {\n\tconst buf = await fetch($scramjet.config.files.wasm).then((r) =>\n\t\tr.arrayBuffer()\n\t);\n\tself.REAL_WASM = new Uint8Array(buf);\n}\n\nconst decoder = new TextDecoder();\nlet MAGIC = \"\\0asm\".split(\"\").map((x) => x.charCodeAt(0));\n\nfunction initWasm() {\n\tif (!(self.REAL_WASM && self.REAL_WASM instanceof Uint8Array))\n\t\tthrow new Error(\"rewriter wasm not found (was it fetched correctly?)\");\n\n\tif (![...self.REAL_WASM.slice(0, 4)].every((x, i) => x === MAGIC[i]))\n\t\tthrow new Error(\n\t\t\t\"rewriter wasm does not have wasm magic (was it fetched correctly?)\\nrewriter wasm contents: \" +\n\t\t\t\tdecoder.decode(self.REAL_WASM)\n\t\t);\n\n\tinitSync({\n\t\tmodule: new WebAssembly.Module(self.REAL_WASM),\n\t});\n}\n\nexport function getRewriter(meta: URLMeta): [Rewriter, () => void] {\n\tinitWasm();\n\tif (!$scramjet.shared.rewriter) $scramjet.shared.rewriter = [];\n\n\tlet obj: { rewriter: Rewriter; inUse: boolean };\n\tlet index = $scramjet.shared.rewriter.findIndex((x) => !x.inUse);\n\tlet len = $scramjet.shared.rewriter.length;\n\n\tif (index === -1) {\n\t\tif (flagEnabled(\"rewriterLogs\", meta.base))\n\t\t\tconsole.log(`creating new rewriter, ${len} rewriters made already`);\n\n\t\tlet rewriter = new Rewriter($scramjet);\n\t\tobj = { rewriter, inUse: false };\n\t\t$scramjet.shared.rewriter.push(obj);\n\t} else {\n\t\tif (flagEnabled(\"rewriterLogs\", meta.base))\n\t\t\tconsole.log(\n\t\t\t\t`using cached rewriter ${index} from list of ${len} rewriters`\n\t\t\t);\n\n\t\tobj = $scramjet.shared.rewriter[index];\n\t}\n\tobj.inUse = true;\n\treturn [obj.rewriter, () => (obj.inUse = false)];\n}\n","/**\n * IDB is used to persist rather than using a `Map`, because SWs are suicidal\n */\n\ntype SiteDirective = \"same-origin\" | \"same-site\" | \"cross-site\" | \"none\";\ninterface RedirectTracker {\n\toriginalReferrer: string;\n\tmostRestrictiveSite: SiteDirective;\n\treferrerPolicy: string;\n\tchainStarted: number;\n}\ninterface ReferrerPolicyData {\n\tpolicy: string;\n\treferrer: string;\n}\n\n// Persist the redirect trackers for an hour\nconst TRACKER_EXPIRY = 60 * 60 * 1000;\nconst SITE_HIERARCHY: Record<SiteDirective, number> = {\n\tnone: 0,\n\t\"same-origin\": 1,\n\t\"same-site\": 2,\n\t\"cross-site\": 3,\n};\n\n/**\n * Gets a connection to the IndexedDB database\n *\n * @returns Promise that resolves to the database connection\n */\nasync function getDB(): Promise<IDBDatabase> {\n\tconst request = indexedDB.open(\"$scramjet\", 1);\n\n\treturn new Promise((resolve, reject) => {\n\t\trequest.onerror = () => reject(request.error);\n\t\trequest.onsuccess = () => resolve(request.result);\n\t});\n}\n\n/**\n * Retrieves a redirect tracker for a given URL\n *\n * @param url The URL to look up\n * @returns Redirect tracker if found, or `null`\n */\nasync function getTracker(url: string): Promise<RedirectTracker | null> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"redirectTrackers\", \"readonly\");\n\tconst store = tx.objectStore(\"redirectTrackers\");\n\n\treturn new Promise((resolve) => {\n\t\tconst request = store.get(url);\n\t\trequest.onsuccess = () => resolve(request.result || null);\n\t\trequest.onerror = () => resolve(null);\n\t});\n}\n\n/**\n * Store or update a redirect tracker for a given URL\n *\n * @param url URL to store the tracker for\n * @param tracker Redirect tracker data to store\n */\nasync function setTracker(\n\turl: string,\n\ttracker: RedirectTracker\n): Promise<void> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"redirectTrackers\", \"readwrite\");\n\tconst store = tx.objectStore(\"redirectTrackers\");\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = store.put(tracker, url);\n\t\trequest.onsuccess = () => resolve();\n\t\trequest.onerror = () => reject(request.error);\n\t});\n}\n\n/**\n * Delete a redirect tracker for a given URL\n *\n * @param url URL whose tracker should be deleted\n */\nasync function deleteTracker(url: string): Promise<void> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"redirectTrackers\", \"readwrite\");\n\tconst store = tx.objectStore(\"redirectTrackers\");\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = store.delete(url);\n\t\trequest.onsuccess = () => resolve();\n\t\trequest.onerror = () => reject(request.error);\n\t});\n}\n\n/**\n * Initialize tracking for a new request that might redirect\n *\n * @param requestUrl URL of the request being made\n * @param referrer Referrer URL of the request, or `null`\n * @param initialSite Initial Sec-Fetch-Site directive\n */\nexport async function initializeTracker(\n\trequestUrl: string,\n\treferrer: string | null,\n\tinitialSite: string\n): Promise<void> {\n\tconst existing = await getTracker(requestUrl);\n\tif (existing) {\n\t\treturn;\n\t}\n\n\tawait setTracker(requestUrl, {\n\t\toriginalReferrer: referrer || \"\",\n\t\tmostRestrictiveSite: initialSite as SiteDirective,\n\t\treferrerPolicy: \"\",\n\t\tchainStarted: Date.now(),\n\t});\n}\n\n/**\n * Update tracker when a redirect is encountered\n *\n * @param originalUrl URL that is redirecting\n * @param redirectUrl URL being redirected to\n * @param newReferrerPolicy Referrer Policy from the redirect response\n */\nexport async function updateTracker(\n\toriginalUrl: string,\n\tredirectUrl: string,\n\tnewReferrerPolicy?: string\n): Promise<void> {\n\tconst tracker = await getTracker(originalUrl);\n\tif (!tracker) return;\n\n\tawait deleteTracker(originalUrl);\n\tif (newReferrerPolicy) {\n\t\ttracker.referrerPolicy = newReferrerPolicy;\n\t}\n\tawait setTracker(redirectUrl, tracker);\n}\n\n/**\n * Get most restrictive site value for a request\n *\n * @param requestUrl The URL of the current request\n * @param currentSite The current `Sec-Fetch-Site` directive for this request\n * @returns Most restrictive `Sec-Fetch-Site` directive from the redirect chain\n */\nexport async function getMostRestrictiveSite(\n\trequestUrl: string,\n\tcurrentSite: string\n): Promise<string> {\n\tconst tracker = await getTracker(requestUrl);\n\tif (!tracker) return currentSite;\n\n\tconst trackedValue = SITE_HIERARCHY[tracker.mostRestrictiveSite];\n\tconst currentValue = SITE_HIERARCHY[currentSite as SiteDirective] ?? 0;\n\n\tif (currentValue > trackedValue) {\n\t\ttracker.mostRestrictiveSite = currentSite as SiteDirective;\n\t\tawait setTracker(requestUrl, tracker);\n\n\t\treturn currentSite;\n\t}\n\n\treturn tracker.mostRestrictiveSite;\n}\n\n/**\n * Clean up tracker after request completes\n * @param requestUrl URL of the completed request\n */\nexport async function cleanTracker(requestUrl: string): Promise<void> {\n\tawait deleteTracker(requestUrl);\n}\n\n/**\n * Clean up expired trackers\n */\nexport async function cleanExpiredTrackers(): Promise<void> {\n\tconst now = Date.now();\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"redirectTrackers\", \"readwrite\");\n\tconst store = tx.objectStore(\"redirectTrackers\");\n\n\tconst request = store.openCursor();\n\n\trequest.onsuccess = (event) => {\n\t\tconst cursor = (event.target as IDBRequest).result;\n\t\tif (cursor) {\n\t\t\tconst tracker = cursor.value as RedirectTracker;\n\t\t\tif (now - tracker.chainStarted > TRACKER_EXPIRY) {\n\t\t\t\tcursor.delete();\n\t\t\t}\n\t\t\tcursor.continue();\n\t\t}\n\t};\n}\n\n/**\n * Store referrer policy for a URL\n *\n * @param url URL to store the policy for\n * @param policy Referrer policy to store\n * @param referrer The referrer URL that set this policy\n */\nexport async function storeReferrerPolicy(\n\turl: string,\n\tpolicy: string,\n\treferrer: string\n): Promise<void> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"referrerPolicies\", \"readwrite\");\n\tconst store = tx.objectStore(\"referrerPolicies\");\n\n\tconst data: ReferrerPolicyData = { policy, referrer };\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = store.put(data, url);\n\t\trequest.onsuccess = () => resolve();\n\t\trequest.onerror = () => reject(request.error);\n\t});\n}\n\n/**\n * Get referrer policy data for a URL\n *\n * @param url URL to get the policy for\n * @returns Referrer policy data if found, or `null`\n */\nexport async function getReferrerPolicy(\n\turl: string\n): Promise<ReferrerPolicyData | null> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"referrerPolicies\", \"readonly\");\n\tconst store = tx.objectStore(\"referrerPolicies\");\n\n\treturn new Promise((resolve) => {\n\t\tconst request = store.get(url);\n\t\trequest.onsuccess = () => resolve(request.result || null);\n\t\trequest.onerror = () => resolve(null);\n\t});\n}\n","import { type URLMeta } from \"../rewriters/url\";\n\nimport type {\n\tdefault as BareClient,\n\tBareResponseFetch,\n} from \"@mercuryworkshop/bare-mux\";\n\n// Cache every hour\nconst CACHE_DURATION_MINUTES = 60;\nconst CACHE_KEY = \"publicSuffixList\";\n\n/**\n * Gets a connection to the IndexedDB database\n *\n * @returns Resolves to the database connection\n */\nasync function getDB(): Promise<IDBDatabase> {\n\tconst request = indexedDB.open(\"$scramjet\", 1);\n\n\treturn new Promise((resolve, reject) => {\n\t\trequest.onerror = () => reject(request.error);\n\t\trequest.onsuccess = () => resolve(request.result);\n\t});\n}\n\n/**\n * Gets cached Public Suffix List\n *\n * @returns Cached Public Suffix List data if not expired, or `null`\n */\nasync function getCachedSuffixList(): Promise<{\n\tdata: string[];\n\texpiry: number;\n} | null> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(CACHE_KEY, \"readonly\");\n\tconst store = tx.objectStore(CACHE_KEY);\n\n\treturn new Promise((resolve) => {\n\t\tconst request = store.get(CACHE_KEY);\n\t\trequest.onsuccess = () => resolve(request.result || null);\n\t\trequest.onerror = () => resolve(null);\n\t});\n}\n\n/**\n * Stores public suffix list\n *\n * @param data Public Suffix list data to cache\n */\nasync function setCachedSuffixList(data: string[]): Promise<void> {\n\tconst db = await getDB();\n\tconst tx = db.transaction(\"publicSuffixList\", \"readwrite\");\n\tconst store = tx.objectStore(\"publicSuffixList\");\n\n\treturn new Promise((resolve, reject) => {\n\t\tconst request = store.put(\n\t\t\t{\n\t\t\t\tdata,\n\t\t\t\texpiry: Date.now() + CACHE_DURATION_MINUTES * 60 * 1000,\n\t\t\t},\n\t\t\tCACHE_KEY\n\t\t);\n\t\trequest.onsuccess = () => resolve();\n\t\trequest.onerror = () => reject(request.error);\n\t});\n}\n\n/**\n * Emulate `Sec-Fetch-Site` header using the referrer (another reason why Force Referrer is now a needed SJ feature)\n */\nexport async function getSiteDirective(\n\tmeta: URLMeta,\n\treferrerURL: URL,\n\tclient: BareClient\n): Promise<string> {\n\tif (!referrerURL) {\n\t\treturn \"none\";\n\t}\n\n\tif (meta.origin.origin === referrerURL.origin) {\n\t\treturn \"same-origin\";\n\t}\n\n\tconst sameSite = await isSameSite(meta.origin, referrerURL, client);\n\tif (sameSite) {\n\t\treturn \"same-site\";\n\t}\n\n\treturn \"cross-site\";\n}\n\n/**\n * Tests if the two URLs are from the same site.\n * This will be used in the response header rewriter.\n *\n * @see https://developer.mozilla.org/en-US/docs/Glossary/Site\n * @see https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-Fetch-Site#directives\n *\n * @param url1 First URL to compare\n * @param url2 Second URL to compare\n * @param client `BareClient` instance used for fetching\n * @returns Whether the two URLs are from the same site\n *\n * @throws {Error} If an error occurs while getting the Public Suffix List\n */\nexport async function isSameSite(\n\turl1: URL,\n\turl2: URL,\n\tclient: BareClient\n): Promise<boolean> {\n\tconst registrableDomain1 = await getRegistrableDomain(url1, client);\n\tconst registrableDomain2 = await getRegistrableDomain(url2, client);\n\n\treturn registrableDomain1 === registrableDomain2;\n}\n\n/**\n * Gets the registrable domain (eTLD+1) for a URL\n * @param url URL to get registrable domain for\n * @param client `BareClient` instance for fetching public suffix list\n * @returns Registrable domain\n */\nasync function getRegistrableDomain(\n\turl: URL,\n\tclient: BareClient\n): Promise<string> {\n\tconst publicSuffixes = await getPublicSuffixList(client);\n\n\tconst hostname = url.hostname.toLowerCase();\n\tconst labels = hostname.split(\".\");\n\tlet matchedSuffix = \"\";\n\n\tlet isException = false;\n\tfor (const suffix of publicSuffixes) {\n\t\tconst actualSuffix = suffix.startsWith(\"!\") ? suffix.substring(1) : suffix;\n\t\tconst suffixLabels = actualSuffix.split(\".\");\n\n\t\tif (matchesSuffix(labels, suffixLabels)) {\n\t\t\tif (suffix.startsWith(\"!\")) {\n\t\t\t\tmatchedSuffix = actualSuffix;\n\t\t\t\tisException = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!isException && actualSuffix.length > matchedSuffix.length) {\n\t\t\t\tmatchedSuffix = actualSuffix;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!matchedSuffix) {\n\t\treturn labels.slice(-2).join(\".\");\n\t}\n\n\tconst suffixLabelCount = matchedSuffix.split(\".\").length;\n\tconst domainLabelCount = isException\n\t\t? suffixLabelCount\n\t\t: suffixLabelCount + 1;\n\n\treturn labels.slice(-domainLabelCount).join(\".\");\n}\n\n/**\n * Checks if hostname labels match a suffix pattern\n * @param hostnameLabels Labels of the hostname (split by `.`)\n * @param suffixLabels Labels of the suffix pattern (split by `.`)\n * @returns Whether the hostname matches the suffix\n */\nfunction matchesSuffix(\n\thostnameLabels: string[],\n\tsuffixLabels: string[]\n): boolean {\n\tif (hostnameLabels.length < suffixLabels.length) {\n\t\treturn false;\n\t}\n\n\tconst offset = hostnameLabels.length - suffixLabels.length;\n\tfor (let i = 0; i < suffixLabels.length; i++) {\n\t\tconst hostLabel = hostnameLabels[offset + i];\n\t\tconst suffixLabel = suffixLabels[i];\n\n\t\tif (suffixLabel === \"*\") {\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (hostLabel !== suffixLabel) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\treturn true;\n}\n\n/**\n * Gets parsed Public Suffix list from the API.\n *\n * Complies with the standard format.\n * @see https://github.com/publicsuffix/list/wiki/Format#format\n *\n * @param {BareClient} client `BareClient` instance used for fetching\n * @returns {Promise<string[]>} Parsed Public Suffix list\n *\n * @throws {Error} If an error occurs while fetching from the Public Suffix List\n */\nexport async function getPublicSuffixList(\n\tclient: BareClient\n): Promise<string[]> {\n\tconst cached = await getCachedSuffixList();\n\tif (cached && Date.now() < cached.expiry) {\n\t\treturn cached.data;\n\t}\n\n\tlet publicSuffixesResponse: BareResponseFetch;\n\ttry {\n\t\tpublicSuffixesResponse = await client.fetch(\n\t\t\t\"https://publicsuffix.org/list/public_suffix_list.dat\"\n\t\t);\n\t} catch (err) {\n\t\tthrow new Error(`Failed to fetch public suffix list: ${err}`);\n\t}\n\tconst publicSuffixesRaw = await publicSuffixesResponse.text();\n\n\tconst publicSuffixes = publicSuffixesRaw\n\t\t.split(\"\\n\")\n\t\t.map((line) => {\n\t\t\tconst trimmed = line.trim();\n\t\t\tconst spaceIndex = trimmed.indexOf(\" \");\n\n\t\t\treturn spaceIndex > -1 ? trimmed.substring(0, spaceIndex) : trimmed;\n\t\t})\n\t\t.filter((line) => line && !line.startsWith(\"//\"));\n\n\tawait setCachedSuffixList(publicSuffixes);\n\n\treturn publicSuffixes;\n}\n","import { $scramjet } from \"../scramjet\";\n\nexport function errorTemplate(trace: string, fetchedURL: string) {\n\t// turn script into a data URI so we don\"t have to escape any HTML values\n\tconst script = `\n                errorTrace.value = ${JSON.stringify(trace)};\n                fetchedURL.textContent = ${JSON.stringify(fetchedURL)};\n                for (const node of document.querySelectorAll(\"#hostname\")) node.textContent = ${JSON.stringify(location.hostname)};\n                reload.addEventListener(\"click\", () => location.reload());\n                version.textContent = ${JSON.stringify($scramjet.version.version)};\n                build.textContent = ${JSON.stringify($scramjet.version.build)};\n                \n                document.getElementById('copy-button').addEventListener('click', async () => {\n                    const text = document.getElementById('errorTrace').value;\n                    await navigator.clipboard.writeText(text);\n                    const btn = document.getElementById('copy-button');\n                    btn.textContent = 'Copied!';\n                    setTimeout(() => btn.textContent = 'Copy', 2000);\n                });\n        `;\n\n\treturn `<!DOCTYPE html>\n            <html>\n                <head>\n                    <meta charset=\"utf-8\" />\n                    <title>Scramjet</title>\n                    <style>\n                    :root {\n                        --deep: #080602;\n                        --shallow: #181412;\n                        --beach: #f1e8e1;\n                        --shore: #b1a8a1;\n                        --accent: #ffa938;\n                        --font-sans: -apple-system, system-ui, BlinkMacSystemFont, sans-serif;\n                        --font-monospace: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \"Liberation Mono\", \"Courier New\", monospace;\n                    }\n\n                    *:not(div,p,span,ul,li,i,span) {\n                        background-color: var(--deep);\n                        color: var(--beach);\n                        font-family: var(--font-sans);\n                    }\n\n                    textarea,\n                    button {\n                        background-color: var(--shallow);\n                        border-radius: 0.6em;\n                        padding: 0.6em;\n                        border: none;\n                        appearance: none;\n                        font-family: var(--font-sans);\n                        color: var(--beach);\n                    }\n\n                    button.primary {\n                        background-color: var(--accent);\n                        color: var(--deep);\n                        font-weight: bold;\n                    }\n\n                    textarea {\n                        resize: none;\n                        height: 20em;\n                        text-align: left;\n                        font-family: var(--font-monospace);\n                    }\n\n                    body {\n                        width: 100vw;\n                        height: 100vh;\n                        justify-content: center;\n                        align-items: center;\n                    }\n\n                    body,\n                    html,\n                    #inner {\n                        display: flex;\n                        align-items: center;\n                        flex-direction: column;\n                        gap: 0.5em;\n                        overflow: hidden;\n                    }\n\n                    #inner {\n                        z-index: 100;\n                    }\n\n                    #cover {\n                        position: absolute;\n                        width: 100%;\n                        height: 100%;\n                        background-color: color-mix(in srgb, var(--deep) 70%, transparent);\n                        z-index: 99;\n                    }\n\n                    #info {\n                        display: flex;\n                        flex-direction: row;\n                        align-items: flex-start;\n                        gap: 1em;\n                    }\n\n                    #version-wrapper {\n                        width: auto;\n                        text-align: right;\n                        position: absolute;\n                        top: 0.5rem;\n                        right: 0.5rem;\n                        font-size: 0.8rem;\n                        color: var(--shore)!important;\n                        i {\n                            background-color: color-mix(in srgb, var(--deep), transparent 50%);\n                            border-radius: 9999px;\n                            padding: 0.2em 0.5em;\n                        }\n                        z-index: 101;\n                    }\n\n                    #errorTrace-wrapper {\n                        position: relative;\n                        width: fit-content;\n                    }\n\n                    #copy-button {\n                        position: absolute;\n                        top: 0.5em;\n                        right: 0.5em;\n                        padding: 0.23em;\n                        cursor: pointer;\n                        opacity: 0;\n                        transition: opacity 0.4s;\n                        font-size: 0.9em;\n                    }\n\n                    #errorTrace-wrapper:hover #copy-button {\n                        opacity: 1;\n                    }\n                    </style>\n                </head>\n                <body>\n                    <div id=\"cover\"></div>\n                    <div id=\"inner\">\n                        <h1 id=\"errorTitle\">Uh oh!</h1>\n                        <p>There was an error loading <b id=\"fetchedURL\"></b></p>\n                        <!-- <p id=\"errorMessage\">Internal Server Error</p> -->\n\n                        <div id=\"info\">\n                            <div id=\"errorTrace-wrapper\">\n                                <textarea id=\"errorTrace\" cols=\"40\" rows=\"10\" readonly></textarea>\n                                <button id=\"copy-button\" class=\"primary\">Copy</button>\n                            </div>\n                            <div id=\"troubleshooting\">\n                                <p>Try:</p>\n                                <ul>\n                                    <li>Checking your internet connection</li>\n                                    <li>Verifying you entered the correct address</li>\n                                    <li>Clearing the site data</li>\n                                    <li>Contacting <b id=\"hostname\"></b>'s administrator</li>\n                                    <li>Verify the server isn't censored</li>\n                                </ul>\n                                <p>If you're the administrator of <b id=\"hostname\"></b>, try:</p>\n                                    <ul>\n                                    <li>Restarting your server</li>\n                                    <li>Updating Scramjet</li>\n                                    <li>Troubleshooting the error on the <a href=\"https://github.com/MercuryWorkshop/scramjet\" target=\"_blank\">GitHub repository</a></li>\n                                </ul>\n                            </div>\n                        </div>\n                        <br>\n                        <button id=\"reload\" class=\"primary\">Reload</button>\n                    </div>\n                    <p id=\"version-wrapper\"><i>Scramjet v<span id=\"version\"></span> (build <span id=\"build\"></span>)</i></p>\n                    <script src=\"${\"data:application/javascript,\" + encodeURIComponent(script)}\"></script>\n                </body>\n            </html>\n        `;\n}\n\nexport function renderError(err: unknown, fetchedURL: string) {\n\tconst headers = {\n\t\t\"content-type\": \"text/html\",\n\t};\n\tif (crossOriginIsolated) {\n\t\theaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\n\t}\n\n\treturn new Response(errorTemplate(String(err), fetchedURL), {\n\t\tstatus: 500,\n\t\theaders: headers,\n\t});\n}\n","import { type MessageW2R, type MessageR2W } from \"../client/swruntime\";\n\nexport class FakeServiceWorker {\n\tsyncToken = 0;\n\tpromises: Record<number, (val?: MessageR2W) => void> = {};\n\tmessageChannel = new MessageChannel();\n\tconnected = false;\n\n\tconstructor(\n\t\tpublic handle: MessagePort,\n\t\tpublic origin: string\n\t) {\n\t\tthis.messageChannel.port1.addEventListener(\"message\", (event) => {\n\t\t\tif (\"scramjet$type\" in event.data) {\n\t\t\t\tif (event.data.scramjet$type === \"init\") {\n\t\t\t\t\tthis.connected = true;\n\t\t\t\t} else {\n\t\t\t\t\tthis.handleMessage(event.data);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.messageChannel.port1.start();\n\n\t\tthis.handle.postMessage(\n\t\t\t{\n\t\t\t\tscramjet$type: \"init\",\n\t\t\t\tscramjet$port: this.messageChannel.port2,\n\t\t\t},\n\t\t\t[this.messageChannel.port2]\n\t\t);\n\t}\n\n\thandleMessage(data: MessageR2W) {\n\t\tconst cb = this.promises[data.scramjet$token];\n\t\tif (cb) {\n\t\t\tcb(data);\n\t\t\tdelete this.promises[data.scramjet$token];\n\t\t}\n\t}\n\n\tasync fetch(request: Request): Promise<Response | false> {\n\t\tconst token = this.syncToken++;\n\n\t\tconst message: MessageW2R = {\n\t\t\tscramjet$type: \"fetch\",\n\t\t\tscramjet$token: token,\n\t\t\tscramjet$request: {\n\t\t\t\turl: request.url,\n\t\t\t\tbody: request.body,\n\t\t\t\theaders: Array.from(request.headers.entries()),\n\t\t\t\tmethod: request.method,\n\t\t\t\tmode: request.mode,\n\t\t\t\tdestinitation: request.destination,\n\t\t\t},\n\t\t};\n\n\t\tconst transfer = request.body ? [request.body] : [];\n\n\t\tthis.handle.postMessage(message, transfer);\n\n\t\tconst { scramjet$response: r } = (await new Promise((resolve) => {\n\t\t\tthis.promises[token] = resolve;\n\t\t})) as MessageR2W;\n\n\t\tif (!r) return false;\n\n\t\treturn new Response(r.body, {\n\t\t\theaders: r.headers,\n\t\t\tstatus: r.status,\n\t\t\tstatusText: r.statusText,\n\t\t});\n\t}\n}\n","import BareClient, { BareResponseFetch } from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetServiceWorker } from \".\";\nimport { renderError } from \"./error\";\nimport { FakeServiceWorker } from \"./fakesw\";\nimport { CookieStore } from \"../shared/cookie\";\nimport {\n\tScramjetHeaders,\n\tunrewriteUrl,\n\trewriteCss,\n\trewriteHeaders,\n\trewriteHtml,\n\trewriteWorkers,\n\tunrewriteBlob,\n} from \"../shared\";\nimport { getSiteDirective } from \"../shared/security/siteTests\";\nimport {\n\tinitializeTracker,\n\tupdateTracker,\n\tcleanTracker,\n\tgetMostRestrictiveSite,\n\tstoreReferrerPolicy,\n\tgetReferrerPolicy,\n} from \"../shared/security/forceReferrer\";\n\nimport type { URLMeta } from \"../shared/rewriters/url\";\nimport { $scramjet, flagEnabled } from \"../scramjet\";\nimport { rewriteJsWithMap } from \"../shared/rewriters/js\";\n\nfunction newMeta(url: URL): URLMeta {\n\treturn {\n\t\torigin: url,\n\t\tbase: url,\n\t};\n}\n\nexport async function handleFetch(\n\tthis: ScramjetServiceWorker,\n\trequest: Request,\n\tclient: Client | null\n) {\n\ttry {\n\t\tconst requestUrl = new URL(request.url);\n\t\tlet workerType = \"\";\n\t\tif (requestUrl.searchParams.has(\"type\")) {\n\t\t\tworkerType = requestUrl.searchParams.get(\"type\") as string;\n\t\t\trequestUrl.searchParams.delete(\"type\");\n\t\t}\n\t\tif (requestUrl.searchParams.has(\"dest\")) {\n\t\t\trequestUrl.searchParams.delete(\"dest\");\n\t\t}\n\n\t\tif (requestUrl.pathname === this.config.files.wasm) {\n\t\t\treturn fetch(this.config.files.wasm).then(async (x) => {\n\t\t\t\tconst buf = await x.arrayBuffer();\n\t\t\t\tconst b64 = btoa(\n\t\t\t\t\tnew Uint8Array(buf)\n\t\t\t\t\t\t.reduce(\n\t\t\t\t\t\t\t(data, byte) => (data.push(String.fromCharCode(byte)), data),\n\t\t\t\t\t\t\t[]\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.join(\"\")\n\t\t\t\t);\n\n\t\t\t\tlet payload = \"\";\n\t\t\t\tpayload +=\n\t\t\t\t\t\"if ('document' in self && document.currentScript) { document.currentScript.remove(); }\\n\";\n\t\t\t\tpayload += `self.WASM = '${b64}';`;\n\n\t\t\t\treturn new Response(payload, {\n\t\t\t\t\theaders: { \"content-type\": \"text/javascript\" },\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (\n\t\t\trequestUrl.pathname.startsWith(`${this.config.prefix}blob:`) ||\n\t\t\trequestUrl.pathname.startsWith(`${this.config.prefix}data:`)\n\t\t) {\n\t\t\tlet dataUrl = requestUrl.pathname.substring(this.config.prefix.length);\n\t\t\tif (dataUrl.startsWith(\"blob:\")) {\n\t\t\t\tdataUrl = unrewriteBlob(dataUrl);\n\t\t\t}\n\n\t\t\tconst response: Partial<BareResponseFetch> = await fetch(dataUrl, {});\n\t\t\tconst url = dataUrl.startsWith(\"blob:\") ? dataUrl : \"(data url)\";\n\t\t\tresponse.finalURL = url;\n\t\t\tlet body: BodyType;\n\n\t\t\tif (response.body) {\n\t\t\t\tbody = await rewriteBody(\n\t\t\t\t\tresponse as BareResponseFetch,\n\t\t\t\t\tclient\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tbase: new URL(new URL(client.url).origin),\n\t\t\t\t\t\t\t\torigin: new URL(new URL(client.url).origin),\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: newMeta(new URL(unrewriteUrl(request.referrer))),\n\t\t\t\t\trequest.destination,\n\t\t\t\t\tworkerType,\n\t\t\t\t\tthis.cookieStore\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst headers = Object.fromEntries(response.headers.entries());\n\n\t\t\tif (crossOriginIsolated) {\n\t\t\t\theaders[\"Cross-Origin-Opener-Policy\"] = \"same-origin\";\n\t\t\t\theaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\n\t\t\t}\n\n\t\t\treturn new Response(body, {\n\t\t\t\tstatus: response.status,\n\t\t\t\tstatusText: response.statusText,\n\t\t\t\theaders: headers,\n\t\t\t});\n\t\t}\n\n\t\tconst url = new URL(unrewriteUrl(requestUrl));\n\n\t\tconst activeWorker: FakeServiceWorker | null = this.serviceWorkers.find(\n\t\t\t(w) => w.origin === url.origin\n\t\t);\n\n\t\tif (\n\t\t\tactiveWorker?.connected &&\n\t\t\trequestUrl.searchParams.get(\"from\") !== \"swruntime\"\n\t\t) {\n\t\t\t// TODO: check scope\n\t\t\tconst r = await activeWorker.fetch(request);\n\t\t\tif (r) return r;\n\t\t}\n\t\tif (url.origin === new URL(request.url).origin) {\n\t\t\tthrow new Error(\n\t\t\t\t\"attempted to fetch from same origin - this means the site has obtained a reference to the real origin, aborting\"\n\t\t\t);\n\t\t}\n\n\t\tconst headers = new ScramjetHeaders();\n\t\tfor (const [key, value] of request.headers.entries()) {\n\t\t\theaders.set(key, value);\n\t\t}\n\n\t\tif (\n\t\t\tclient &&\n\t\t\tnew URL(client.url).pathname.startsWith($scramjet.config.prefix)\n\t\t) {\n\t\t\t// TODO: i was against cors emulation but we might actually break stuff if we send full origin/referrer always\n\t\t\tconst clientURL = new URL(unrewriteUrl(client.url));\n\t\t\tif (clientURL.toString().includes(\"youtube.com\")) {\n\t\t\t\t// console.log(headers);\n\t\t\t} else {\n\t\t\t\t// Force referrer to unsafe-url for all requests\n\t\t\t\theaders.set(\"Referer\", clientURL.href);\n\t\t\t\theaders.set(\"Origin\", clientURL.origin);\n\t\t\t}\n\t\t}\n\n\t\tconst cookies = this.cookieStore.getCookies(url, false);\n\n\t\tif (cookies.length) {\n\t\t\theaders.set(\"Cookie\", cookies);\n\t\t}\n\n\t\t// Check if we should emulate a top-level navigation\n\t\tlet isTopLevelProxyNavigation = false;\n\t\tif (\n\t\t\trequest.destination === \"iframe\" &&\n\t\t\trequest.mode === \"navigate\" &&\n\t\t\trequest.referrer &&\n\t\t\trequest.referrer !== \"no-referrer\"\n\t\t) {\n\t\t\t// Trace back through the referrer chain, checking if each was an iframe navigation using the clients, until we find a non-iframe parent on a non-proxy page\n\t\t\tlet currentReferrer = request.referrer;\n\t\t\tconst allClients = await self.clients.matchAll({ type: \"window\" });\n\n\t\t\t// Trace backwards\n\t\t\twhile (currentReferrer) {\n\t\t\t\tif (!currentReferrer.includes($scramjet.config.prefix)) {\n\t\t\t\t\tisTopLevelProxyNavigation = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Find the parent for this iteration\n\t\t\t\tconst parentChainClient = allClients.find(\n\t\t\t\t\t(c) => c.url === currentReferrer\n\t\t\t\t);\n\n\t\t\t\t// Get the next referrer policy that applies to this parent\n\t\t\t\t// eslint-disable-next-line no-await-in-loop\n\t\t\t\tconst parentPolicyData = await getReferrerPolicy(currentReferrer);\n\n\t\t\t\tif (!parentPolicyData || !parentPolicyData.referrer) {\n\t\t\t\t\t// Check if this ends at the proxy origin\n\t\t\t\t\tif (\n\t\t\t\t\t\tparentChainClient &&\n\t\t\t\t\t\tcurrentReferrer.startsWith(location.origin)\n\t\t\t\t\t) {\n\t\t\t\t\t\tisTopLevelProxyNavigation = true;\n\t\t\t\t\t}\n\t\t\t\t\t// Results are inclusive\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t// Check if this was an iframe navigation by looking at the client\n\t\t\t\tif (parentChainClient && parentChainClient.frameType === \"nested\") {\n\t\t\t\t\t// Continue checking the chain\n\t\t\t\t\tcurrentReferrer = parentPolicyData.referrer;\n\t\t\t\t} else {\n\t\t\t\t\t// Results are inclusive\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (isTopLevelProxyNavigation) {\n\t\t\theaders.set(\"Sec-Fetch-Dest\", \"document\");\n\t\t\theaders.set(\"Sec-Fetch-Mode\", \"navigate\");\n\t\t} else {\n\t\t\t// Convert empty destination to \"empty\" string per spec\n\t\t\theaders.set(\"Sec-Fetch-Dest\", request.destination || \"empty\");\n\t\t\theaders.set(\"Sec-Fetch-Mode\", request.mode);\n\t\t}\n\n\t\tlet siteDirective = \"none\";\n\t\tif (\n\t\t\trequest.referrer &&\n\t\t\trequest.referrer !== \"\" &&\n\t\t\trequest.referrer !== \"no-referrer\"\n\t\t) {\n\t\t\tif (request.referrer.includes($scramjet.config.prefix)) {\n\t\t\t\tconst unrewrittenReferrer = unrewriteUrl(request.referrer);\n\t\t\t\tif (unrewrittenReferrer) {\n\t\t\t\t\tconst referrerUrl = new URL(unrewrittenReferrer);\n\t\t\t\t\tconst meta = newMeta(url);\n\t\t\t\t\tsiteDirective = await getSiteDirective(\n\t\t\t\t\t\tmeta,\n\t\t\t\t\t\treferrerUrl,\n\t\t\t\t\t\tthis.client\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tawait initializeTracker(\n\t\t\turl.toString(),\n\t\t\trequest.referrer ? unrewriteUrl(request.referrer) : null,\n\t\t\tsiteDirective\n\t\t);\n\n\t\theaders.set(\n\t\t\t\"Sec-Fetch-Site\",\n\t\t\tawait getMostRestrictiveSite(url.toString(), siteDirective)\n\t\t);\n\n\t\tconst ev = new ScramjetRequestEvent(\n\t\t\turl,\n\t\t\theaders.headers,\n\t\t\trequest.body,\n\t\t\trequest.method,\n\t\t\trequest.destination,\n\t\t\tclient\n\t\t);\n\t\tthis.dispatchEvent(ev);\n\n\t\tconst response: BareResponseFetch =\n\t\t\tev.response ||\n\t\t\t(await this.client.fetch(ev.url, {\n\t\t\t\tmethod: ev.method,\n\t\t\t\tbody: ev.body,\n\t\t\t\theaders: ev.requestHeaders,\n\t\t\t\tcredentials: \"omit\",\n\t\t\t\tmode: request.mode === \"cors\" ? request.mode : \"same-origin\",\n\t\t\t\tcache: request.cache,\n\t\t\t\tredirect: \"manual\",\n\t\t\t\t// @ts-ignore why the fuck is this not typed microsoft\n\t\t\t\tduplex: \"half\",\n\t\t\t}));\n\n\t\treturn await handleResponse(\n\t\t\turl,\n\t\t\tworkerType,\n\t\t\trequest.destination,\n\t\t\trequest.mode,\n\t\t\tresponse,\n\t\t\tthis.cookieStore,\n\t\t\tclient,\n\t\t\tthis.client,\n\t\t\tthis,\n\t\t\trequest.referrer\n\t\t);\n\t} catch (err) {\n\t\tconst errorDetails = {\n\t\t\tmessage: err.message,\n\t\t\turl: request.url,\n\t\t\tdestination: request.destination,\n\t\t\ttimestamp: new Date().toISOString(),\n\t\t};\n\t\tif (err.stack) {\n\t\t\terrorDetails[\"stack\"] = err.stack;\n\t\t}\n\n\t\tconsole.error(\"ERROR FROM SERVICE WORKER FETCH: \", errorDetails);\n\n\t\tif (![\"document\", \"iframe\"].includes(request.destination))\n\t\t\treturn new Response(undefined, { status: 500 });\n\n\t\tconst formattedError = Object.entries(errorDetails)\n\t\t\t.map(\n\t\t\t\t([key, value]) =>\n\t\t\t\t\t`${key.charAt(0).toUpperCase() + key.slice(1)}: ${value}`\n\t\t\t)\n\t\t\t.join(\"\\n\\n\");\n\n\t\treturn renderError(formattedError, unrewriteUrl(request.url));\n\t}\n}\n\nasync function handleResponse(\n\turl: URL,\n\tworkertype: string,\n\tdestination: RequestDestination,\n\tmode: RequestMode,\n\tresponse: BareResponseFetch,\n\tcookieStore: CookieStore,\n\tclient: Client,\n\tbareClient: BareClient,\n\tswtarget: ScramjetServiceWorker,\n\treferrer: string\n): Promise<Response> {\n\tlet responseBody: BodyType;\n\tconst isNavigationRequest =\n\t\tmode === \"navigate\" && [\"document\", \"iframe\"].includes(destination);\n\tconst responseHeaders = await rewriteHeaders(\n\t\tresponse.rawHeaders,\n\t\tnewMeta(url),\n\t\tbareClient,\n\t\t{ get: getReferrerPolicy, set: storeReferrerPolicy }\n\t);\n\n\t// Store referrer policy from navigation responses for Force Referrer\n\tif (isNavigationRequest && responseHeaders[\"referrer-policy\"] && referrer) {\n\t\tawait storeReferrerPolicy(\n\t\t\turl.href,\n\t\t\tresponseHeaders[\"referrer-policy\"],\n\t\t\treferrer\n\t\t);\n\t}\n\n\tif (\n\t\tresponse.status >= 300 &&\n\t\tresponse.status < 400 &&\n\t\tresponseHeaders[\"location\"]\n\t) {\n\t\tconst redirectUrl = new URL(unrewriteUrl(responseHeaders[\"location\"]));\n\n\t\tawait updateTracker(\n\t\t\turl.toString(),\n\t\t\tredirectUrl.toString(),\n\t\t\tresponseHeaders[\"referrer-policy\"]\n\t\t);\n\n\t\tconst redirectMeta = newMeta(redirectUrl);\n\t\tconst newSiteDirective = await getSiteDirective(\n\t\t\tredirectMeta,\n\t\t\turl,\n\t\t\tbareClient\n\t\t);\n\t\tawait getMostRestrictiveSite(redirectUrl.toString(), newSiteDirective);\n\t}\n\n\tconst maybeHeaders = responseHeaders[\"set-cookie\"] || [];\n\tfor (const cookie in maybeHeaders) {\n\t\tif (client) {\n\t\t\tconst promise = swtarget.dispatch(client, {\n\t\t\t\tscramjet$type: \"cookie\",\n\t\t\t\tcookie,\n\t\t\t\turl: url.href,\n\t\t\t});\n\t\t\tif (destination !== \"document\" && destination !== \"iframe\") {\n\t\t\t\tawait promise;\n\t\t\t}\n\t\t}\n\t}\n\n\tawait cookieStore.setCookies(\n\t\tmaybeHeaders instanceof Array ? maybeHeaders : [maybeHeaders],\n\t\turl\n\t);\n\n\tfor (const header in responseHeaders) {\n\t\t// flatten everything past here\n\t\tif (Array.isArray(responseHeaders[header]))\n\t\t\tresponseHeaders[header] = responseHeaders[header][0];\n\t}\n\n\tif (response.body) {\n\t\tresponseBody = await rewriteBody(\n\t\t\tresponse,\n\t\t\tnewMeta(url),\n\t\t\tdestination,\n\t\t\tworkertype,\n\t\t\tcookieStore\n\t\t);\n\t}\n\n\t// downloads\n\tif ([\"document\", \"iframe\"].includes(destination)) {\n\t\tconst header = responseHeaders[\"content-disposition\"];\n\n\t\t// validate header and test for filename\n\t\tif (!/\\s*?((inline|attachment);\\s*?)filename=/i.test(header)) {\n\t\t\t// if filename= wasn\"t specified then maybe the remote specified to download this as an attachment?\n\t\t\t// if it\"s invalid then we can still possibly test for the attachment/inline type\n\t\t\tconst type = /^\\s*?attachment/i.test(header) ? \"attachment\" : \"inline\";\n\n\t\t\t// set the filename\n\t\t\tconst [filename] = new URL(response.finalURL).pathname\n\t\t\t\t.split(\"/\")\n\t\t\t\t.slice(-1);\n\n\t\t\tresponseHeaders[\"content-disposition\"] =\n\t\t\t\t`${type}; filename=${JSON.stringify(filename)}`;\n\t\t}\n\t}\n\tif (responseHeaders[\"accept\"] === \"text/event-stream\") {\n\t\tresponseHeaders[\"content-type\"] = \"text/event-stream\";\n\t}\n\n\t// scramjet runtime can use features that permissions-policy blocks\n\tdelete responseHeaders[\"permissions-policy\"];\n\n\tif (\n\t\tcrossOriginIsolated &&\n\t\t[\n\t\t\t\"document\",\n\t\t\t\"iframe\",\n\t\t\t\"worker\",\n\t\t\t\"sharedworker\",\n\t\t\t\"style\",\n\t\t\t\"script\",\n\t\t].includes(destination)\n\t) {\n\t\tresponseHeaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\n\t\tresponseHeaders[\"Cross-Origin-Opener-Policy\"] = \"same-origin\";\n\t}\n\n\tconst ev = new ScramjetHandleResponseEvent(\n\t\tresponseBody,\n\t\tresponseHeaders,\n\t\tresponse.status,\n\t\tresponse.statusText,\n\t\tdestination,\n\t\turl,\n\t\tresponse,\n\t\tclient\n\t);\n\tswtarget.dispatchEvent(ev);\n\n\t// Clean up tracker if not a redirect\n\tif (!(response.status >= 300 && response.status < 400)) {\n\t\tawait cleanTracker(url.toString());\n\t}\n\n\treturn new Response(ev.responseBody, {\n\t\theaders: ev.responseHeaders as HeadersInit,\n\t\tstatus: ev.status,\n\t\tstatusText: ev.statusText,\n\t});\n}\n\nasync function rewriteBody(\n\tresponse: BareResponseFetch,\n\tmeta: URLMeta,\n\tdestination: RequestDestination,\n\tworkertype: string,\n\tcookieStore: CookieStore\n): Promise<BodyType> {\n\tswitch (destination) {\n\t\tcase \"iframe\":\n\t\tcase \"document\":\n\t\t\tif (response.headers.get(\"content-type\")?.startsWith(\"text/html\")) {\n\t\t\t\t// note from percs: i think this has the potential to be slow asf, but for right now its fine (we should probably look for a better solution)\n\t\t\t\t// another note from percs: regex seems to be broken, gonna comment this out\n\t\t\t\t/*\n        const buf = await response.arrayBuffer();\n        const decode = new TextDecoder(\"utf-8\").decode(buf);\n        const charsetHeader = response.headers.get(\"content-type\");\n        const charset =\n          charsetHeader?.split(\"charset=\")[1] ||\n          decode.match(/charset=([^\"]+)/)?.[1] ||\n          \"utf-8\";\n        const htmlContent = charset\n          ? new TextDecoder(charset).decode(buf)\n          : decode;\n        */\n\t\t\t\treturn rewriteHtml(await response.text(), cookieStore, meta, true);\n\t\t\t} else {\n\t\t\t\treturn response.body;\n\t\t\t}\n\t\tcase \"script\": {\n\t\t\tlet { js, tag, map } = rewriteJsWithMap(\n\t\t\t\tnew Uint8Array(await response.arrayBuffer()),\n\t\t\t\tresponse.finalURL,\n\t\t\t\tmeta,\n\t\t\t\tworkertype === \"module\"\n\t\t\t);\n\t\t\tif (flagEnabled(\"sourcemaps\", meta.base) && map) {\n\t\t\t\tif (js instanceof Uint8Array) {\n\t\t\t\t\tjs = new TextDecoder().decode(js);\n\t\t\t\t}\n\t\t\t\tconst sourcemapfn = `${globalThis.$scramjet.config.globals.pushsourcemapfn}([${map.join(\",\")}], \"${tag}\");`;\n\t\t\t\tconst strictMode = /^\\s*(['\"])use strict\\1;?/;\n\t\t\t\tif (strictMode.test(js)) {\n\t\t\t\t\tjs = js.replace(strictMode, `$&\\n${sourcemapfn}`);\n\t\t\t\t} else {\n\t\t\t\t\tjs = `${sourcemapfn}\\n${js}`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn js as unknown as ArrayBuffer;\n\t\t}\n\t\tcase \"style\":\n\t\t\treturn rewriteCss(await response.text(), meta);\n\t\tcase \"sharedworker\":\n\t\tcase \"worker\":\n\t\t\treturn rewriteWorkers(\n\t\t\t\tnew Uint8Array(await response.arrayBuffer()),\n\t\t\t\tworkertype,\n\t\t\t\tresponse.finalURL,\n\t\t\t\tmeta\n\t\t\t);\n\t\tdefault:\n\t\t\treturn response.body;\n\t}\n}\n\ntype BodyType = string | ArrayBuffer | Blob | ReadableStream<any>;\n\nexport class ScramjetHandleResponseEvent extends Event {\n\tconstructor(\n\t\tpublic responseBody: BodyType,\n\t\tpublic responseHeaders: Record<string, string>,\n\t\tpublic status: number,\n\t\tpublic statusText: string,\n\t\tpublic destination: string,\n\t\tpublic url: URL,\n\t\tpublic rawResponse: BareResponseFetch,\n\t\tpublic client: Client\n\t) {\n\t\tsuper(\"handleResponse\");\n\t}\n}\n\nexport class ScramjetRequestEvent extends Event {\n\tconstructor(\n\t\tpublic url: URL,\n\t\tpublic requestHeaders: Record<string, string>,\n\t\tpublic body: BodyType,\n\t\tpublic method: string,\n\t\tpublic destination: string,\n\t\tpublic client: Client\n\t) {\n\t\tsuper(\"request\");\n\t}\n\tpublic response?: BareResponseFetch;\n}\n","\nexport function setMeta(meta, val) {\n\tmeta.base = new URL(val, meta.origin);\n}\nexport function base64(bytes) {\n\tconst binString = Array.from(bytes, (byte) =>\n\t\tString.fromCodePoint(byte)\n\t).join(\"\");\n\n\treturn btoa(binString);\n}\nexport function rewriteJsAttr(fn, attr, code, meta) {\n\treturn fn(code, `(inline ${attr} on element)`, meta);\n}\nexport function rewriteJsInline(fn, code, module, meta) {\n\treturn fn(code, `(inline script element)`, meta, module);\n}\nexport function rewriteCss(fn, code, meta) {\n\treturn fn(code, meta);\n}\nexport function rewriteHttpEquiv(fn, content, meta) {\n\tconst contentArray = content.split(\"url=\");\n\tif (contentArray[1])\n\t\tcontentArray[1] = fn(contentArray[1].trim(), meta);\n\treturn contentArray.join(\"url=\");\n}\nexport function log(val) { console.log(\"aaaaa\", val) }\n","\nexport function scramtag() {\n    return (\"\"+1e10).replace(/[018]/g,\n      c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n    );\n}\n","import { base64, log, rewriteCss, rewriteHttpEquiv, rewriteJsAttr, rewriteJsInline, setMeta } from './snippets/wasm-4b0f351a8e6eeb46/inline0.js';\nimport { scramtag } from './snippets/wasm-4b0f351a8e6eeb46/inline1.js';\n\nlet wasm;\n\nlet WASM_VECTOR_LEN = 0;\n\nlet cachedUint8ArrayMemory0 = null;\n\nfunction getUint8ArrayMemory0() {\n    if (cachedUint8ArrayMemory0 === null || cachedUint8ArrayMemory0.byteLength === 0) {\n        cachedUint8ArrayMemory0 = new Uint8Array(wasm.memory.buffer);\n    }\n    return cachedUint8ArrayMemory0;\n}\n\nconst cachedTextEncoder = (typeof TextEncoder !== 'undefined' ? new TextEncoder('utf-8') : { encode: () => { throw Error('TextEncoder not available') } } );\n\nconst encodeString = (typeof cachedTextEncoder.encodeInto === 'function'\n    ? function (arg, view) {\n    return cachedTextEncoder.encodeInto(arg, view);\n}\n    : function (arg, view) {\n    const buf = cachedTextEncoder.encode(arg);\n    view.set(buf);\n    return {\n        read: arg.length,\n        written: buf.length\n    };\n});\n\nfunction passStringToWasm0(arg, malloc, realloc) {\n\n    if (realloc === undefined) {\n        const buf = cachedTextEncoder.encode(arg);\n        const ptr = malloc(buf.length, 1) >>> 0;\n        getUint8ArrayMemory0().subarray(ptr, ptr + buf.length).set(buf);\n        WASM_VECTOR_LEN = buf.length;\n        return ptr;\n    }\n\n    let len = arg.length;\n    let ptr = malloc(len, 1) >>> 0;\n\n    const mem = getUint8ArrayMemory0();\n\n    let offset = 0;\n\n    for (; offset < len; offset++) {\n        const code = arg.charCodeAt(offset);\n        if (code > 0x7F) break;\n        mem[ptr + offset] = code;\n    }\n\n    if (offset !== len) {\n        if (offset !== 0) {\n            arg = arg.slice(offset);\n        }\n        ptr = realloc(ptr, len, len = offset + arg.length * 3, 1) >>> 0;\n        const view = getUint8ArrayMemory0().subarray(ptr + offset, ptr + len);\n        const ret = encodeString(arg, view);\n\n        offset += ret.written;\n        ptr = realloc(ptr, len, offset, 1) >>> 0;\n    }\n\n    WASM_VECTOR_LEN = offset;\n    return ptr;\n}\n\nlet cachedDataViewMemory0 = null;\n\nfunction getDataViewMemory0() {\n    if (cachedDataViewMemory0 === null || cachedDataViewMemory0.buffer.detached === true || (cachedDataViewMemory0.buffer.detached === undefined && cachedDataViewMemory0.buffer !== wasm.memory.buffer)) {\n        cachedDataViewMemory0 = new DataView(wasm.memory.buffer);\n    }\n    return cachedDataViewMemory0;\n}\n\nfunction addToExternrefTable0(obj) {\n    const idx = wasm.__externref_table_alloc();\n    wasm.__wbindgen_export_4.set(idx, obj);\n    return idx;\n}\n\nfunction handleError(f, args) {\n    try {\n        return f.apply(this, args);\n    } catch (e) {\n        const idx = addToExternrefTable0(e);\n        wasm.__wbindgen_exn_store(idx);\n    }\n}\n\nconst cachedTextDecoder = (typeof TextDecoder !== 'undefined' ? new TextDecoder('utf-8', { ignoreBOM: true, fatal: true }) : { decode: () => { throw Error('TextDecoder not available') } } );\n\nif (typeof TextDecoder !== 'undefined') { cachedTextDecoder.decode(); };\n\nfunction getStringFromWasm0(ptr, len) {\n    ptr = ptr >>> 0;\n    return cachedTextDecoder.decode(getUint8ArrayMemory0().subarray(ptr, ptr + len));\n}\n\nfunction isLikeNone(x) {\n    return x === undefined || x === null;\n}\n\nfunction takeFromExternrefTable0(idx) {\n    const value = wasm.__wbindgen_export_4.get(idx);\n    wasm.__externref_table_dealloc(idx);\n    return value;\n}\n\nfunction passArray8ToWasm0(arg, malloc) {\n    const ptr = malloc(arg.length * 1, 1) >>> 0;\n    getUint8ArrayMemory0().set(arg, ptr / 1);\n    WASM_VECTOR_LEN = arg.length;\n    return ptr;\n}\n\nconst RewriterFinalization = (typeof FinalizationRegistry === 'undefined')\n    ? { register: () => {}, unregister: () => {} }\n    : new FinalizationRegistry(ptr => wasm.__wbg_rewriter_free(ptr >>> 0, 1));\n\nexport class Rewriter {\n\n    __destroy_into_raw() {\n        const ptr = this.__wbg_ptr;\n        this.__wbg_ptr = 0;\n        RewriterFinalization.unregister(this);\n        return ptr;\n    }\n\n    free() {\n        const ptr = this.__destroy_into_raw();\n        wasm.__wbg_rewriter_free(ptr, 0);\n    }\n    /**\n     * @param {object} scramjet\n     */\n    constructor(scramjet) {\n        const ret = wasm.rewriter_new(scramjet);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        this.__wbg_ptr = ret[0] >>> 0;\n        RewriterFinalization.register(this, this.__wbg_ptr, this);\n        return this;\n    }\n    /**\n     * @param {string} js\n     * @param {string} base\n     * @param {string} url\n     * @param {boolean} module\n     * @returns {JsRewriterOutput}\n     */\n    rewrite_js(js, base, url, module) {\n        const ptr0 = passStringToWasm0(js, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ptr1 = passStringToWasm0(base, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        const ptr2 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len2 = WASM_VECTOR_LEN;\n        const ret = wasm.rewriter_rewrite_js(this.__wbg_ptr, ptr0, len0, ptr1, len1, ptr2, len2, module);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        return takeFromExternrefTable0(ret[0]);\n    }\n    /**\n     * @param {Uint8Array} js\n     * @param {string} base\n     * @param {string} url\n     * @param {boolean} module\n     * @returns {JsRewriterOutput}\n     */\n    rewrite_js_bytes(js, base, url, module) {\n        const ptr0 = passArray8ToWasm0(js, wasm.__wbindgen_malloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ptr1 = passStringToWasm0(base, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        const ptr2 = passStringToWasm0(url, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len2 = WASM_VECTOR_LEN;\n        const ret = wasm.rewriter_rewrite_js_bytes(this.__wbg_ptr, ptr0, len0, ptr1, len1, ptr2, len2, module);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        return takeFromExternrefTable0(ret[0]);\n    }\n    /**\n     * @param {string} html\n     * @param {object} meta\n     * @param {object} cookie\n     * @returns {HtmlRewriterOutput}\n     */\n    rewrite_html(html, meta, cookie) {\n        const ptr0 = passStringToWasm0(html, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len0 = WASM_VECTOR_LEN;\n        const ret = wasm.rewriter_rewrite_html(this.__wbg_ptr, ptr0, len0, meta, cookie);\n        if (ret[2]) {\n            throw takeFromExternrefTable0(ret[1]);\n        }\n        return takeFromExternrefTable0(ret[0]);\n    }\n}\n\nasync function __wbg_load(module, imports) {\n    if (typeof Response === 'function' && module instanceof Response) {\n        if (typeof WebAssembly.instantiateStreaming === 'function') {\n            try {\n                return await WebAssembly.instantiateStreaming(module, imports);\n\n            } catch (e) {\n                if (module.headers.get('Content-Type') != 'application/wasm') {\n                    console.warn(\"`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\\n\", e);\n\n                } else {\n                    throw e;\n                }\n            }\n        }\n\n        const bytes = await module.arrayBuffer();\n        return await WebAssembly.instantiate(bytes, imports);\n\n    } else {\n        const instance = await WebAssembly.instantiate(module, imports);\n\n        if (instance instanceof WebAssembly.Instance) {\n            return { instance, module };\n\n        } else {\n            return instance;\n        }\n    }\n}\n\nfunction __wbg_get_imports() {\n    const imports = {};\n    imports.wbg = {};\n    imports.wbg.__wbg_base64_115e27e69612f6f9 = function(arg0, arg1) {\n        const ret = base64(arg1);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_buffer_609cc3eee51ed158 = function(arg0) {\n        const ret = arg0.buffer;\n        return ret;\n    };\n    imports.wbg.__wbg_call_7cccdd69e0791ae2 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = arg0.call(arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_833bed5770ea2041 = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = arg0.call(arg1, arg2, arg3);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_call_b8adc8b1d0a0d8eb = function() { return handleError(function (arg0, arg1, arg2, arg3, arg4) {\n        const ret = arg0.call(arg1, arg2, arg3, arg4);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_entries_3265d4158b33e5dc = function(arg0) {\n        const ret = Object.entries(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_get_67b2ba62fc30de12 = function() { return handleError(function (arg0, arg1) {\n        const ret = Reflect.get(arg0, arg1);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_get_b9b93047fe3cf45b = function(arg0, arg1) {\n        const ret = arg0[arg1 >>> 0];\n        return ret;\n    };\n    imports.wbg.__wbg_isArray_a1eab7e0d067391b = function(arg0) {\n        const ret = Array.isArray(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_length_e2d2a49132c1b256 = function(arg0) {\n        const ret = arg0.length;\n        return ret;\n    };\n    imports.wbg.__wbg_log_2f70bc68044d6f60 = function(arg0, arg1) {\n        log(getStringFromWasm0(arg0, arg1));\n    };\n    imports.wbg.__wbg_new_405e22f390576ce2 = function() {\n        const ret = new Object();\n        return ret;\n    };\n    imports.wbg.__wbg_new_78feb108b6472713 = function() {\n        const ret = new Array();\n        return ret;\n    };\n    imports.wbg.__wbg_new_9ffbe0a71eff35e3 = function() { return handleError(function (arg0, arg1) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_new_a12002a7f91c75be = function(arg0) {\n        const ret = new Uint8Array(arg0);\n        return ret;\n    };\n    imports.wbg.__wbg_newwithbase_161c299e7a34e2eb = function() { return handleError(function (arg0, arg1, arg2, arg3) {\n        const ret = new URL(getStringFromWasm0(arg0, arg1), getStringFromWasm0(arg2, arg3));\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a = function(arg0, arg1, arg2) {\n        const ret = new Uint8Array(arg0, arg1 >>> 0, arg2 >>> 0);\n        return ret;\n    };\n    imports.wbg.__wbg_rewriteCss_9baf28b92206542e = function(arg0, arg1, arg2, arg3, arg4) {\n        const ret = rewriteCss(arg1, getStringFromWasm0(arg2, arg3), arg4);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_rewriteHttpEquiv_36d627bb1aa1662f = function(arg0, arg1, arg2, arg3, arg4) {\n        const ret = rewriteHttpEquiv(arg1, getStringFromWasm0(arg2, arg3), arg4);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_rewriteJsAttr_0a16ff7c17c72f0f = function(arg0, arg1, arg2, arg3, arg4, arg5, arg6) {\n        const ret = rewriteJsAttr(arg1, getStringFromWasm0(arg2, arg3), getStringFromWasm0(arg4, arg5), arg6);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_rewriteJsInline_8094bffe5a91c442 = function(arg0, arg1, arg2, arg3, arg4, arg5) {\n        const ret = rewriteJsInline(arg1, getStringFromWasm0(arg2, arg3), arg4 !== 0, arg5);\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_scramtag_3a255d78b157986d = function(arg0) {\n        const ret = scramtag();\n        const ptr1 = passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        const len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbg_setMeta_159129a766e5aee1 = function(arg0, arg1, arg2) {\n        setMeta(arg0, getStringFromWasm0(arg1, arg2));\n    };\n    imports.wbg.__wbg_set_bb8cecf6a62b9f46 = function() { return handleError(function (arg0, arg1, arg2) {\n        const ret = Reflect.set(arg0, arg1, arg2);\n        return ret;\n    }, arguments) };\n    imports.wbg.__wbg_toString_5285597960676b7b = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbg_toString_c813bbd34d063839 = function(arg0) {\n        const ret = arg0.toString();\n        return ret;\n    };\n    imports.wbg.__wbindgen_boolean_get = function(arg0) {\n        const v = arg0;\n        const ret = typeof(v) === 'boolean' ? (v ? 1 : 0) : 2;\n        return ret;\n    };\n    imports.wbg.__wbindgen_error_new = function(arg0, arg1) {\n        const ret = new Error(getStringFromWasm0(arg0, arg1));\n        return ret;\n    };\n    imports.wbg.__wbindgen_init_externref_table = function() {\n        const table = wasm.__wbindgen_export_4;\n        const offset = table.grow(4);\n        table.set(0, undefined);\n        table.set(offset + 0, undefined);\n        table.set(offset + 1, null);\n        table.set(offset + 2, true);\n        table.set(offset + 3, false);\n        ;\n    };\n    imports.wbg.__wbindgen_is_function = function(arg0) {\n        const ret = typeof(arg0) === 'function';\n        return ret;\n    };\n    imports.wbg.__wbindgen_memory = function() {\n        const ret = wasm.memory;\n        return ret;\n    };\n    imports.wbg.__wbindgen_string_get = function(arg0, arg1) {\n        const obj = arg1;\n        const ret = typeof(obj) === 'string' ? obj : undefined;\n        var ptr1 = isLikeNone(ret) ? 0 : passStringToWasm0(ret, wasm.__wbindgen_malloc, wasm.__wbindgen_realloc);\n        var len1 = WASM_VECTOR_LEN;\n        getDataViewMemory0().setInt32(arg0 + 4 * 1, len1, true);\n        getDataViewMemory0().setInt32(arg0 + 4 * 0, ptr1, true);\n    };\n    imports.wbg.__wbindgen_string_new = function(arg0, arg1) {\n        const ret = getStringFromWasm0(arg0, arg1);\n        return ret;\n    };\n    imports.wbg.__wbindgen_throw = function(arg0, arg1) {\n        throw new Error(getStringFromWasm0(arg0, arg1));\n    };\n\n    return imports;\n}\n\nfunction __wbg_init_memory(imports, memory) {\n\n}\n\nfunction __wbg_finalize_init(instance, module) {\n    wasm = instance.exports;\n    __wbg_init.__wbindgen_wasm_module = module;\n    cachedDataViewMemory0 = null;\n    cachedUint8ArrayMemory0 = null;\n\n\n    wasm.__wbindgen_start();\n    return wasm;\n}\n\nfunction initSync(module) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module !== 'undefined') {\n        if (Object.getPrototypeOf(module) === Object.prototype) {\n            ({module} = module)\n        } else {\n            console.warn('using deprecated parameters for `initSync()`; pass a single object instead')\n        }\n    }\n\n    const imports = __wbg_get_imports();\n\n    __wbg_init_memory(imports);\n\n    if (!(module instanceof WebAssembly.Module)) {\n        module = new WebAssembly.Module(module);\n    }\n\n    const instance = new WebAssembly.Instance(module, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nasync function __wbg_init(module_or_path) {\n    if (wasm !== undefined) return wasm;\n\n\n    if (typeof module_or_path !== 'undefined') {\n        if (Object.getPrototypeOf(module_or_path) === Object.prototype) {\n            ({module_or_path} = module_or_path)\n        } else {\n            console.warn('using deprecated parameters for the initialization function; pass a single object instead')\n        }\n    }\n\n    if (typeof module_or_path === 'undefined') {\n        module_or_path = new URL('wasm_bg.wasm', \"\");\n    }\n    const imports = __wbg_get_imports();\n\n    if (typeof module_or_path === 'string' || (typeof Request === 'function' && module_or_path instanceof Request) || (typeof URL === 'function' && module_or_path instanceof URL)) {\n        module_or_path = fetch(module_or_path);\n    }\n\n    __wbg_init_memory(imports);\n\n    const { instance, module } = await __wbg_load(await module_or_path, imports);\n\n    return __wbg_finalize_init(instance, module);\n}\n\nexport { initSync };\nexport default __wbg_init;\n","__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n        if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n            Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n        }\n    }\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { FakeServiceWorker } from \"./fakesw\";\nimport { handleFetch } from \"./fetch\";\nimport type BareClient from \"@mercuryworkshop/bare-mux\";\nimport { ScramjetConfig } from \"../types\";\nimport { $scramjet, loadCodecs } from \"../scramjet\";\nimport { asyncSetWasm } from \"../shared/rewriters/wasm\";\n\nexport class ScramjetServiceWorker extends EventTarget {\n\tclient: BareClient;\n\tconfig: ScramjetConfig;\n\n\tsyncPool: Record<number, (val?: any) => void> = {};\n\tsynctoken = 0;\n\n\tcookieStore = new $scramjet.shared.CookieStore();\n\n\tserviceWorkers: FakeServiceWorker[] = [];\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis.client = new $scramjet.shared.util.BareClient();\n\n\t\tconst db = indexedDB.open(\"$scramjet\", 1);\n\n\t\tdb.onsuccess = () => {\n\t\t\tconst res = db.result;\n\t\t\tconst tx = res.transaction(\"cookies\", \"readonly\");\n\t\t\tconst store = tx.objectStore(\"cookies\");\n\t\t\tconst cookies = store.get(\"cookies\");\n\n\t\t\tcookies.onsuccess = () => {\n\t\t\t\tif (cookies.result) {\n\t\t\t\t\tthis.cookieStore.load(cookies.result);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\n\t\taddEventListener(\"message\", async ({ data }: { data: MessageC2W }) => {\n\t\t\tif (!(\"scramjet$type\" in data)) return;\n\n\t\t\tif (\"scramjet$token\" in data) {\n\t\t\t\t// (ack message)\n\t\t\t\tconst cb = this.syncPool[data.scramjet$token];\n\t\t\t\tdelete this.syncPool[data.scramjet$token];\n\t\t\t\tcb(data);\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data.scramjet$type === \"registerServiceWorker\") {\n\t\t\t\tthis.serviceWorkers.push(new FakeServiceWorker(data.port, data.origin));\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (data.scramjet$type === \"cookie\") {\n\t\t\t\tthis.cookieStore.setCookies([data.cookie], new URL(data.url));\n\t\t\t\tconst res = db.result;\n\t\t\t\tconst tx = res.transaction(\"cookies\", \"readwrite\");\n\t\t\t\tconst store = tx.objectStore(\"cookies\");\n\t\t\t\tstore.put(JSON.parse(this.cookieStore.dump()), \"cookies\");\n\t\t\t}\n\n\t\t\tif (data.scramjet$type === \"loadConfig\") {\n\t\t\t\tthis.config = data.config;\n\t\t\t}\n\t\t});\n\t}\n\n\tasync dispatch(client: Client, data: MessageW2C): Promise<MessageC2W> {\n\t\tconst token = this.synctoken++;\n\t\tlet cb: (val: MessageC2W) => void;\n\t\tconst promise: Promise<MessageC2W> = new Promise((r) => (cb = r));\n\t\tthis.syncPool[token] = cb;\n\t\tdata.scramjet$token = token;\n\n\t\tclient.postMessage(data);\n\n\t\treturn await promise;\n\t}\n\n\tasync loadConfig() {\n\t\tif (this.config) return;\n\n\t\tconst request = indexedDB.open(\"$scramjet\", 1);\n\n\t\treturn new Promise<void>((resolve, reject) => {\n\t\t\trequest.onsuccess = async () => {\n\t\t\t\tconst db = request.result;\n\t\t\t\tconst tx = db.transaction(\"config\", \"readonly\");\n\t\t\t\tconst store = tx.objectStore(\"config\");\n\t\t\t\tconst config = store.get(\"config\");\n\n\t\t\t\tconfig.onsuccess = async () => {\n\t\t\t\t\tthis.config = config.result;\n\t\t\t\t\t$scramjet.config = config.result;\n\n\t\t\t\t\tloadCodecs();\n\n\t\t\t\t\tawait asyncSetWasm();\n\n\t\t\t\t\tresolve();\n\t\t\t\t};\n\t\t\t\tconfig.onerror = () => reject(config.error);\n\t\t\t};\n\n\t\t\trequest.onerror = () => reject(request.error);\n\t\t});\n\t}\n\n\troute({ request }: FetchEvent) {\n\t\tif (request.url.startsWith(location.origin + this.config.prefix))\n\t\t\treturn true;\n\t\telse if (request.url.startsWith(location.origin + this.config.files.wasm))\n\t\t\treturn true;\n\t\telse return false;\n\t}\n\n\tasync fetch({ request, clientId }: FetchEvent) {\n\t\tif (!this.config) await this.loadConfig();\n\n\t\tconst client = await self.clients.get(clientId);\n\n\t\treturn handleFetch.call(this, request, client);\n\t}\n}\n\n// @ts-ignore\nself.ScramjetServiceWorker = ScramjetServiceWorker;\n\ntype RegisterServiceWorkerMessage = {\n\tscramjet$type: \"registerServiceWorker\";\n\tport: MessagePort;\n\torigin: string;\n};\n\ntype CookieMessage = {\n\tscramjet$type: \"cookie\";\n\tcookie: string;\n\turl: string;\n};\n\ntype ConfigMessage = {\n\tscramjet$type: \"loadConfig\";\n\tconfig: ScramjetConfig;\n};\n\ntype MessageCommon = {\n\tscramjet$type: string;\n\tscramjet$token?: number;\n};\n\ntype MessageTypeC2W =\n\t| RegisterServiceWorkerMessage\n\t| CookieMessage\n\t| ConfigMessage;\ntype MessageTypeW2C = CookieMessage;\n\n// c2w: client to (service) worker\nexport type MessageC2W = MessageCommon & MessageTypeC2W;\nexport type MessageW2C = MessageCommon & MessageTypeW2C;\n"],"names":["logfuncs","console","severity","message","args","old","Error","_","stack","fmt","i","Math","e","tag","fn","meta","before","type","timespan","flagEnabled","duration","after","performance","self","COMMITHASH","VERSION","$scramjet","nativeFunction","Function","loadCodecs","flag","url","value","regex","partialflags","RegExp","BareClient","ScramjetHeaders","BareMuxConnection","rewriteUrl","unrewriteUrl","rewriteBlob","unrewriteBlob","rewriteCss","unrewriteCss","rewriteHtml","unrewriteHtml","rewriteSrcset","rewriteJs","rewriteHeaders","rewriteWorkers","htmlRules","CookieStore","decoder","TextDecoder","rewriteJsWithMap","js","module","rewriteJsInner","out","TextEncoder","rewriteJsWasm","input","source","rewriter","ret","getRewriter","err","err1","dbg","map","scramtag","errors","globalThis","Array","error","asyncSetWasm","buf","fetch","r","Uint8Array","atob","c","MAGIC","x","obj","initSync","WebAssembly","index","len","Rewriter","SITE_HIERARCHY","getDB","request","indexedDB","Promise","resolve","reject","getTracker","store","tx","db","setTracker","tracker","deleteTracker","initializeTracker","requestUrl","referrer","initialSite","Date","updateTracker","originalUrl","redirectUrl","newReferrerPolicy","getMostRestrictiveSite","currentSite","trackedValue","currentValue","cleanTracker","storeReferrerPolicy","policy","data","getReferrerPolicy","CACHE_KEY","getCachedSuffixList","setCachedSuffixList","CACHE_DURATION_MINUTES","getSiteDirective","referrerURL","client","isSameSite","url1","url2","registrableDomain1","getRegistrableDomain","publicSuffixes","getPublicSuffixList","labels","hostname","matchedSuffix","isException","suffix","actualSuffix","matchesSuffix","hostnameLabels","suffixLabels","offset","hostLabel","suffixLabel","suffixLabelCount","domainLabelCount","publicSuffixesResponse","cached","publicSuffixesRaw","line","trimmed","spaceIndex","renderError","fetchedURL","headers","crossOriginIsolated","Response","errorTemplate","trace","script","JSON","location","encodeURIComponent","String","FakeServiceWorker","MessageChannel","handle","origin","event","cb","token","transfer","newMeta","handleFetch","URL","workerType","b64","btoa","byte","payload","body","dataUrl","response","rewriteBody","Object","activeWorker","w","key","clientURL","cookies","isTopLevelProxyNavigation","currentReferrer","allClients","parentChainClient","parentPolicyData","siteDirective","unrewrittenReferrer","referrerUrl","ev","ScramjetRequestEvent","handleResponse","errorDetails","undefined","formattedError","workertype","destination","mode","cookieStore","bareClient","swtarget","responseBody","isNavigationRequest","responseHeaders","redirectMeta","newSiteDirective","maybeHeaders","cookie","promise","header","filename","ScramjetHandleResponseEvent","sourcemapfn","strictMode","Event","status","statusText","rawResponse","requestHeaders","method","l","crypto","g","DataView","FinalizationRegistry","arguments","Reflect","a","Request","ScramjetServiceWorker","EventTarget","res","addEventListener","config","clientId"],"mappings":"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"}